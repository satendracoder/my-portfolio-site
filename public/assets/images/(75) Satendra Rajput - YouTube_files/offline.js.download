(function(g){var window=this;'use strict';var vHv=function(Y){var V=new g.ZK("und",new g.kn("Default","und",!0));V.captionTracks=Y.captionTracks;return V},wHW=function(Y){return new g.xb(function(V,C){var U=Y.length,n=[];
if(U)for(var b=function(G,Z){U--;n[G]=Z;U==0&&V(n)},E=function(G){C(G)},y,X=0;X<Y.length;X++)y=Y[X],g.tBH(y,g.nN(b,X),E);
else V(n)})},$M=function(Y){this.Y=Y},Ml=function(){$M.apply(this,arguments)},lLL=function(){Ml.apply(this,arguments)},pHR=function(){Ml.apply(this,arguments)},TD8=function(){Ml.apply(this,arguments)},$7A=function(){Ml.apply(this,arguments)},M08=function(){Ml.apply(this,arguments)},aLD=function(){Ml.apply(this,arguments)},ILA=function(){$M.apply(this,arguments)},L8L=function(){Ml.apply(this,arguments)},QmD=function(){Ml.apply(this,arguments)},SLr=function(){Ml.apply(this,arguments)},m7W=function(){Ml.apply(this,
arguments)},jmL=function(){Ml.apply(this,arguments)},t0D=function(){Ml.apply(this,arguments)},eyr=function(){Ml.apply(this,arguments)},rGL=function(){Ml.apply(this,arguments)},F8J=function(){Ml.apply(this,arguments)},gHN=function(){Ml.apply(this,arguments)},K8S=function(){Ml.apply(this,arguments)},HEr=function(){Ml.apply(this,arguments)},YaJ=function(){$M.apply(this,arguments)},oPr=function(){Ml.apply(this,arguments)},VSL=function(){Ml.apply(this,arguments)},CUL=function(){Ml.apply(this,arguments)},
Uhr=function(){Ml.apply(this,arguments)},nPJ=function(){Ml.apply(this,arguments)},bgA=function(){Ml.apply(this,arguments)},EPW=function(){Ml.apply(this,arguments)},zXL=function(){Ml.apply(this,arguments)},igN=function(){Ml.apply(this,arguments)},yuT=function(){$M.apply(this,arguments)},XNT=function(){$M.apply(this,arguments)},GDv=function(){$M.apply(this,arguments)},ZgD=function(){Ml.apply(this,arguments)},Dhb=function(){Ml.apply(this,arguments)},u0N=function(){Ml.apply(this,arguments)},BTN=function(){Ml.apply(this,
arguments)},sov=function(){Ml.apply(this,arguments)},AuD=function(){Ml.apply(this,arguments)},RXR=function(){Ml.apply(this,arguments)},WoL=function(){Ml.apply(this,arguments)},NTN=function(){Ml.apply(this,arguments)},OgL=function(){Ml.apply(this,arguments)},kDA=function(){Ml.apply(this,arguments)},Jub=function(){Ml.apply(this,arguments)},dhv=function(){Ml.apply(this,arguments)},qaJ=function(){Ml.apply(this,arguments)},PUT=function(){Ml.apply(this,arguments)},xhv=function(){Ml.apply(this,arguments)},
cub=function(){Ml.apply(this,arguments)},hXS=function(){Ml.apply(this,arguments)},fuL=function(){Ml.apply(this,arguments)},vPr=function(){Ml.apply(this,arguments)},wNL=function(){Ml.apply(this,arguments)},lu8=function(){Ml.apply(this,arguments)},pNN=function(){Ml.apply(this,arguments)},TTR=function(){Ml.apply(this,arguments)},$hL=function(){Ml.apply(this,arguments)},MSD=function(){Ml.apply(this,arguments)},auJ=function(){$M.apply(this,arguments)},IuW=function(){Ml.apply(this,arguments)},LoD=function(){Ml.apply(this,
arguments)},QoD=function(){Ml.apply(this,arguments)},SaD=function(){Ml.apply(this,arguments)},mhS=function(){Ml.apply(this,arguments)},joT=function(){Ml.apply(this,arguments)},tSL=function(){Ml.apply(this,arguments)},eXv=function(){Ml.apply(this,arguments)},ruA=function(){Ml.apply(this,arguments)},Fob=function(){Ml.apply(this,arguments)},gPb=function(){Ml.apply(this,arguments)},KoJ=function(){Ml.apply(this,arguments)},Hgv=function(){Ml.apply(this,arguments)},Y6L=function(){Ml.apply(this,arguments)},
obb=function(){Ml.apply(this,arguments)},V_L=function(){Ml.apply(this,arguments)},Cdr=function(){Ml.apply(this,arguments)},UoA=function(){Ml.apply(this,arguments)},nbb=function(){Ml.apply(this,arguments)},b1v=function(){Ml.apply(this,arguments)},EbL=function(){Ml.apply(this,arguments)},z6S=function(){Ml.apply(this,arguments)},i1T=function(){Ml.apply(this,arguments)},yA8=function(){Ml.apply(this,arguments)},XrW=function(){Ml.apply(this,arguments)},GKN=function(){Ml.apply(this,arguments)},Z1r=function(){Ml.apply(this,
arguments)},DoL=function(){Ml.apply(this,arguments)},utL=function(){Ml.apply(this,arguments)},BrL=function(){Ml.apply(this,arguments)},sA8=function(){Ml.apply(this,arguments)},AAD=function(){Ml.apply(this,arguments)},R6b=function(){Ml.apply(this,arguments)},W$r=function(Y){Y=Y.key||Y.id;
if(!Y)throw Error("Entity key is missing");return Y},NrL=function(){if(a7)return a7();
var Y={};a7=g.CI("PersistentEntityStoreDb",{yA:(Y.EntityStore={JJ:1},Y.EntityAssociationStore={JJ:2},Y),shared:!1,upgrade:function(V,C){C(1)&&g.MK(g.ve(V,"EntityStore",{keyPath:"key"}),"entityType","entityType");C(2)&&(V=g.ve(V,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.MK(V,"byParentEntityKey","parentEntityKey"),g.MK(V,"byChildEntityKey","childEntityKey"))},
version:3});return a7()},O1T=function(Y){return g.tO(NrL(),Y)},kKb=function(Y){return g.tO((0,g.E3N)(),Y)},I7=function(Y){this.token=Y},L2=function(Y,V){V=V===void 0?{}:V;
g.g1.call(this,g.zaT[Y],Object.assign({},{name:"PESEncoderError",type:Y},V));this.type=Y;this.level="WARNING";Object.setPrototypeOf(this,L2.prototype)},JAS=function(Y){return new L2("WRONG_DATA_TYPE",{WL:Y})},dov=function(Y){return Y instanceof Error?new L2("UNKNOWN_ENCODE_ERROR",{originalMessage:Y.message}):new L2("UNKNOWN_ENCODE_ERROR")},q6b=function(Y){return Y instanceof Error?new L2("UNKNOWN_DECODE_ERROR",{originalMessage:Y.message}):new L2("UNKNOWN_DECODE_ERROR")},Pdv=function(Y,V){Y=Y instanceof
L2?Y:V(Y);
g.MR(Y);throw Y;},xoD=function(){},cAJ=function(Y,V,C){try{return Y.S(V,C)}catch(U){Pdv(U,dov)}},h6b=function(Y){Y=(new TextEncoder).encode(Y).subarray(0,16);
var V=new Uint8Array(16);V.set(Y);return V},Qc=function(Y){this.Y=Y},vbT=function(Y){var V=fkS[Y];
if(V)return V;g.ak(new g.g1("Entity model not found.",{entityType:Y}))},wrD=function(Y,V){this.Y=Y;
this.J=V;this.S={}},prJ=function(Y,V){a:{Y=lkL(Y.J,V.version);
try{var C=Y.J(V.data,V.key);break a}catch(U){Pdv(U,q6b)}C=void 0}return C},S5=function(Y,V,C){return Y.Y.objectStore("EntityStore").get(V).then(function(U){if(U){if(C&&U.entityType!==C)throw Error("Incorrect entity type");
return prJ(Y,U)}})},mU=function(Y,V,C){return C?(C=C.map(function(U){return S5(Y,U,V)}),g.Pe.all(C)):Y.Y.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(V)).then(function(U){return U.map(function(n){return prJ(Y,n)})})},tJ=function(Y,V,C){var U=W$r(V),n=lkL(Y.J,1),b=Object.assign({},V);
return Y.Y.objectStore("EntityStore").get(U).then(function(E){if(E){if(E.entityType!==C)throw Error("Incorrect entity type");b.entityMetadata||(E=prJ(Y,E),b.entityMetadata=E.entityMetadata)}}).then(function(){var E={key:U,
entityType:C,data:cAJ(n,b,U),version:1};return g.Pe.all([g.pw(Y.Y.objectStore("EntityStore"),E),TrS(Y,b,C)])}).then(function(){j5(Y,U,C);
return U})},$oN=function(Y,V,C){V=V.map(function(U){return tJ(Y,U,C)});
return g.Pe.all(V)},e5=function(Y,V,C){if(C==null?0:C.A0){var U=new Set;
return M_S(Y,V,U).then(function(){for(var b=[],E=g.N(U),y=E.next();!y.done;y=E.next())b.push(e5(Y,y.value));return g.Pe.all(b).then(function(){})})}var n=g.nV(V).entityType;
return g.Pe.all([Y.Y.objectStore("EntityStore").delete(V),akR(Y,V)]).then(function(){j5(Y,V,n)})},IkL=function(Y,V){return g.Q3(Y.Y.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(V)},function(C){return g.Pe.all([C.delete(),
akR(Y,C.cursor.primaryKey)]).then(function(){j5(Y,C.cursor.primaryKey,V);return g.I3(C)})})},L$L=function(Y,V,C,U){var n=lkL(Y.J,1);
return S5(Y,V,U).then(function(b){if(b){b=g.ku(b,C);var E={key:V,entityType:U,data:cAJ(n,b,V),version:1};return g.Pe.all([g.pw(Y.Y.objectStore("EntityStore"),E),TrS(Y,b,U)])}}).then(function(){j5(Y,V,U);
return V})},j5=function(Y,V,C){var U=Y.S[C];
U||(U=new Set,Y.S[C]=U);U.add(V)},QAJ=function(Y,V,C){var U=W$r(V);
C=vbT(C);if(!C)return g.Pe.resolve([]);C=new C(V);Y=Y.Y.objectStore("EntityAssociationStore");V=[];C=g.N(C.J());for(var n=C.next();!n.done;n=C.next())V.push(g.pw(Y,{parentEntityKey:U,childEntityKey:n.value}));return g.Pe.all(V).then(function(b){return b.map(function(E){return E[1]})})},akR=function(Y,V){return Y.Y.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(V))},TrS=function(Y,V,C){var U=W$r(V);
return akR(Y,U).then(function(){return QAJ(Y,V,C)})},M_S=function(Y,V,C){if(C.has(V))return g.Pe.resolve(void 0);
C.add(V);return S6J(Y,V).then(function(U){return Y.Y.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(V)).then(function(){return U})}).then(function(U){var n=g.Pe.resolve(void 0);
U=g.N(U);for(var b=U.next(),E={};!b.done;E={FZ:void 0},b=U.next())E.FZ=b.value,n=n.then(function(y){return function(){return M_S(Y,y.FZ,C)}}(E));
return n}).then(function(){})},S6J=function(Y,V){var C=Y.Y.objectStore("EntityAssociationStore");
return C.index("byParentEntityKey").getAll(IDBKeyRange.only(V)).then(function(U){var n=[];U=g.N(U);for(var b=U.next();!b.done;b=U.next())b=b.value,n.push(C.index("byChildEntityKey").getAll(b.childEntityKey));return g.Pe.all(n)}).then(function(U){var n=[];
U=g.N(U);for(var b=U.next();!b.done;b=U.next())b=b.value,b.length===1&&n.push(b[0].childEntityKey);return n})},r3=function(){},moW=function(){this.Y={};
this.Y[0]=new r3;if(!g.Jn("aes_pes_encoder_killswitch")){var Y=this.Y;try{var V=g.KH();var C=h6b(V);var U=new Qc(new g.fV(C),new g.h1(C))}catch(n){throw Y=n instanceof Error?new L2("KEY_CREATION_FAILED",{originalMessage:n.message}):new L2("KEY_CREATION_FAILED"),g.MR(Y),Y;}Y[1]=U}},lkL=function(Y,V){V=V===void 0?0:V;
Y=Y.Y[V];if(!Y)throw V=new L2("INVALID_ENCODER_VERSION",{WL:V}),g.MR(V),V;return Y},Fa=function(Y,V){g.T.call(this);
this.token=Y;this.Y=V;this.observers=[];Y=new g.tx.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.KH());Y.onmessage=this.J.bind(this);this.channel=Y},g3=function(Y,V,C){var U,n,b,E;
return g.l(function(y){if(y.J==1)return g.v(y,O1T(Y.token),2);if(y.J!=3)return U=y.Y,g.v(y,g.lI(U,["EntityStore","EntityAssociationStore"],V,function(X){n=new wrD(X,Y.Y);return C(n)}),3);
b=y.Y;n&&(E=n.S,Object.keys(E).length>0&&(Y.channel.postMessage(E),jAD(Y,E)));return y.return(b)})},K2=function(Y,V,C){return g3(Y,{mode:"readwrite",
cM:!0},function(U){return tJ(U,V,C)})},t_L=function(Y,V){return g3(Y,{mode:"readwrite",
cM:!0},function(C){return $oN(C,V,"offlineOrchestrationActionWrapperEntity")})},e6A=function(Y,V){return g3(Y,{mode:"readwrite",
cM:!0},function(C){return e5(C,V)})},rAv=function(Y){return g3(Y,{mode:"readwrite",
cM:!0},function(V){return IkL(V,"videoPlaybackPositionEntity")})},Hn=function(Y,V,C){return g3(Y,{mode:"readonly",
cM:!0},function(U){return S5(U,V,C)})},YR=function(Y,V,C){return g3(Y,{mode:"readonly",
cM:!0},function(U){return mU(U,V,C)})},jAD=function(Y,V){Y=g.N(Y.observers);
for(var C=Y.next();!C.done;C=Y.next())C=C.value,C(V)},F$b=function(){var Y,V,C;
return g.l(function(U){if(U.J==1)return g.Na(U,2),g.v(U,g.oU(),4);if(U.J!=2){Y=U.Y;if(!Y||!g.H8()||typeof g.tx.BroadcastChannel==="undefined")return U.return();V=new moW;return U.return(new Fa(Y,V))}C=g.Po(U);C instanceof Error&&g.MR(C);return U.return()})},oF=function(){gbJ||(gbJ=F$b());
return gbJ},K$r=function(Y){var V;
Y=(V=Y.options)==null?void 0:V.persistenceOption;return Y==="ENTITY_PERSISTENCE_OPTION_PERSIST"||Y==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},H1W=function(Y){var V;
return g.l(function(C){return C.J==1?g.v(C,oF(),2):(V=C.Y)?g.v(C,g3(V,"readwrite",function(U){for(var n={},b=g.N(Y),E=b.next(),y={};!E.done;y={e9:void 0,fP:void 0},E=b.next())y.e9=E.value,y.e9.entityKey&&K$r(y.e9)&&(y.fP=g.SJ(y.e9.payload),E=void 0,y.e9.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(E=function(X){return function(){return tJ(U,X.e9.payload[X.fP],X.fP)}}(y)),y.e9.type==="ENTITY_MUTATION_TYPE_DELETE"&&(E=function(X){return function(){return e5(U,X.e9.entityKey)}}(y)),y.e9.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(E=function(X){return function(){return L$L(U,X.e9.entityKey,X.e9.payload[X.fP],X.fP)}}(y)),E&&(n[y.e9.entityKey]=n[y.e9.entityKey]?n[y.e9.entityKey].then(E):E()));
return g.Pe.all(Object.values(n))}),0):C.return()})},Y4W=function(Y){var V;
return g.l(function(C){if(C.J==1){V=Y.mutations;if(!V||V.length<=0)return C.return();if(g.iO){var U={type:"ENTITY_LOADED"};V!==void 0&&(U.payload=V);g.iO.dispatch(U)}return g.v(C,H1W(V),2)}V.length=0;g.Wo(C)})},oZL=function(Y){return Y!==void 0},VmN=function(Y){var V=g.T5();
V=Object.assign({},V);Y=Object.assign({},Y);for(var C in V)Y[C]?(V[C]!==4&&(V[C]=Y[C]),delete Y[C]):V[C]!==2&&(V[C]=4);Object.assign(V,Y);g.WeR(V);JSON.stringify(V);return V},CsW=function(Y){var V,C;
return g.l(function(U){if(U.J==1)return g.v(U,g.oU(),2);if(U.J!=3)return(V=U.Y)?g.v(U,g.aO(V),3):U.return();C=U.Y;return U.return(g.lI(C,["index","media","captions"],{mode:"readwrite",cM:!0},function(n){var b=IDBKeyRange.bound(Y+"|",Y+"~");n=[n.objectStore("index").delete(b),n.objectStore("media").delete(b),n.objectStore("captions").delete(b)];return g.Pe.all(n).then(function(){})}))})},U$J=function(){var Y,V;
return g.l(function(C){if(C.J==1)return g.v(C,g.oU(),2);if(C.J!=3){Y=C.Y;if(!Y)throw g.dK("rvdfd");return g.v(C,g.aO(Y),3)}V=C.Y;return C.return(g.lI(V,["index","media"],{mode:"readwrite",cM:!0},function(U){var n={};return g.a3(U.objectStore("index"),{},function(b){var E=b.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),y=g.Pe.resolve(void 0);if(E){var X=E[1];E=E[2];n[X]=n[X]||{};var G;n[X][E]=g.d2S((G=b.getValue())==null?void 0:G.fmts)}else y=b.delete().then(function(){});
return g.Pe.all([g.I3(b),y]).then(function(Z){return g.N(Z).next().value})}).then(function(){for(var b={},E=g.N(Object.keys(n)),y=E.next();!y.done;y=E.next()){y=y.value;
var X=n[y].v;b[y]=n[y].a&&X?1:2}var G=VmN(b);return g.cFo(U.objectStore("media"),{},function(Z){var D=Z.cursor.key.match(g.cMR);D&&b[D[1]]||U.objectStore("media").delete(Z.cursor.key);return g.Wio(Z)}).then(function(){return G})})}))})},nZL=function(Y,V){var C,U;
return g.l(function(n){if(n.J==1)return g.v(n,g.oU(),2);if(n.J!=3){C=n.Y;if(!C)throw g.dK("wct");return g.v(n,g.aO(C),3)}U=n.Y;return g.v(n,g.lI(U,["captions"],{mode:"readwrite",cM:!0},function(b){var E=[];b=b.objectStore("captions");for(var y=0;y<V.length;y++){var X=g.pw(b,V[y],Y+"|"+V[y].metadata.vss_id);E.push(X)}return g.Pe.all(E)}),0)})},b7A=function(Y){var V,C,U;
return g.l(function(n){if(n.J==1)return V=IDBKeyRange.bound(Y+"|",Y+"~"),g.v(n,g.oU(),2);if(n.J!=3){C=n.Y;if(!C)throw g.dK("gactfv");return g.v(n,g.aO(C),3)}U=n.Y;return n.return(U.getAll("captions",V))})},EZr=function(Y){return g.l(function(V){g.MN(Y,0);
return V.return(CsW(Y))})},zKv=function(Y){return{context:g.Ux(),
videoIds:Y}},i7W=function(Y){return{context:g.Ux(),
playlistIds:Y}},yzv=function(Y){return{context:g.Ux(),
offlinePlaylistSyncChecks:Y}},XtJ=function(){this.Y=new Map},Z7J=function(){Gmr||(Gmr=new XtJ);
return Gmr},D$R=function(Y,V){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:Y},metadata:V,statusCode:void 0,csn:void 0,can:void 0}},uBT=function(Y,V,C){if(!C){var U=U===void 0?!1:U;
C=Y.Y.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!C||U)C=g.qP(16),Y.Y.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",C)}Y={flowNonce:C,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:V.eventType};V.metadata&&(Y.flowMetadata=V.metadata);V.statusCode!==void 0&&(Y.flowEventStatus=V.statusCode);V.csn&&(Y.csn=V.csn);V.can&&(Y.can=V.can);g.ZX("flowEvent",Y,void 0)},B7v=function(Y){var V,C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv,xE,qa,US,J,zT,jJ,NH;
return g.l(function(cv){if(cv.J==1)return g.v(cv,g3(Y,{mode:"readonly",cM:!0},function(Gv){return mU(Gv,"playbackData").then(function(Iv){var lb=Iv.map(function(f){return f.transfer}).filter(function(f){return!!f}),hT=Iv.map(function(f){return f.offlineVideoPolicy}).filter(function(f){return!!f}),x=Iv.filter(function(f){return!!f.key}).map(function(f){return g.bu(g.nV(f.key).entityId,"downloadStatusEntity")});
lb=mU(Gv,"transfer",lb);hT=mU(Gv,"offlineVideoPolicy",hT);x=mU(Gv,"downloadStatusEntity",x);var h=lb.then(function(f){f=f.reduce(function(p,L){(L==null?0:L.offlineVideoStreams)&&p.push.apply(p,g.P(L.offlineVideoStreams));return p},[]).filter(function(p){return!!p});
return mU(Gv,"offlineVideoStreams",f)});
return g.Pe.all([lb,hT,h,x]).then(function(f){var p=g.N(f);f=p.next().value;var L=p.next().value;var kE=p.next().value;p=p.next().value;return[Iv,f,L,kE,p]})})}),2);
if(cv.J!=3)return V=cv.Y,g.v(cv,g3(Y,{mode:"readonly",cM:!0},function(Gv){return mU(Gv,"mainDownloadsListEntity").then(function(Iv){var lb,hT;return(hT=(lb=Iv[0])==null?void 0:lb.downloads)!=null?hT:[]})}),3);
C=cv.Y;U=g.N(V);n=U.next().value;b=U.next().value;E=U.next().value;y=U.next().value;X=U.next().value;G=n;Z=b;D=E;u=y;B=X;A={};O={};k={};q={};d={};c=[];w=g.N(Z);for(a=w.next();!a.done;a=w.next())(t=a.value)&&(A[t.key]=t);S=g.N(D);for(H=S.next();!H.done;H=S.next())(UP=H.value)&&(O[UP.key]=UP);ov=g.N(B);for(bZ=ov.next();!bZ.done;bZ=ov.next())(F=bZ.value)&&(k[F.key]=F);Bo=g.N(u);for(dH=Bo.next();!dH.done;dH=Bo.next())(lZ=dH.value)&&(q[lZ.key]=lZ);Wv=g.N(C);for(zv=Wv.next();!zv.done;zv=Wv.next())xE=zv.value,
qa=void 0,d[(qa=xE.videoItem)!=null?qa:""]=!0,xE.videoItem&&(J=US=void 0,zT=(J=(US=g.nV(xE.videoItem))==null?void 0:US.entityId)!=null?J:"",c.push({externalVideoId:zT}));jJ=G.filter(function(Gv){if(!Gv||!Gv.key||!Gv.offlineVideoPolicy)return!1;Gv=g.nV(Gv.key).entityId;Gv=g.bu(Gv,"downloadStatusEntity");var Iv;return!(Gv&&((Iv=k[Gv])==null?void 0:Iv.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
NH=jJ.map(function(Gv){var Iv=A[Gv.transfer],lb=[];if(Iv==null?0:Iv.offlineVideoStreams)for(var hT=g.N(Iv.offlineVideoStreams),x=hT.next();!x.done;x=hT.next())(x=q[x.value])&&lb.push(x);hT=O[Gv.offlineVideoPolicy];x=d;var h=Gv==null?void 0:Gv.playerResponseTimestamp,f=g.nV(hT.key).entityId;Gv=g.bu(f,"mainVideoEntity");if(hT.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var p="OFFLINE_VIDEO_STATE_DISABLED";hT.expirationTimestamp&&Number(hT.expirationTimestamp)<Date.now()/1E3&&(p="OFFLINE_VIDEO_STATE_EXPIRED")}else if(hT.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")p="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Iv==null?void 0:Iv.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":p="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":p="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":p="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":p="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":p="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":p="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:p="OFFLINE_VIDEO_STATE_UNKNOWN"}if(p==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Iv==null?void 0:Iv.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":p="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":p="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":p=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}f={id:f,videoState:p};if(Iv==null?0:Iv.cotn)f.cotn=Iv.cotn;if(Iv==null?0:Iv.maximumDownloadQuality)f.selectedVideoQuality=Iv==null?void 0:Iv.maximumDownloadQuality;if(Iv==null?0:Iv.lastProgressTimeMs)f.lastProgressTimeMs=Iv.lastProgressTimeMs;h&&(f.playerResponseSavedTimeMs=String(Number(h)*1E3));Iv=String;h=0;lb=g.N(lb);for(p=lb.next();!p.done;p=lb.next())if(p=p.value,p.streamsProgress){p=g.N(p.streamsProgress);for(var L=p.next();!L.done;L=p.next()){var kE=void 0;
h+=Number((kE=L.value.numBytesDownloaded)!=null?kE:0)}}f.downloadedBytes=Iv(h);f.selectedOfflineMode=x[Gv]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";hT.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(f.offlinePlaybackDisabledReason=hT.offlinePlaybackDisabledReason);return f});
return cv.return({offlineVideos:NH,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:c}}})})},s9W=function(){this.locks=navigator.locks},AzD=function(){try{var Y=g.rH("ytglobal.locks_");
if(Y)return Y;var V;if(V=navigator){var C=navigator;V="locks"in C&&!!C.locks}if(V)return g.tx.localStorage&&g.tx.localStorage.getItem("noop"),Y=new s9W,g.e2("ytglobal.locks_",Y),Y}catch(U){}},Vu=function(){},RKS=function(){},WBr=function(Y){if(Y.includes(":"))throw Error("Invalid user cache name: "+Y);
return Y+":"+g.KH("CacheStorage get")},N7D=function(){return g.l(function(Y){if(Cl!==void 0)return Y.return(Cl);
Cl=new Promise(function(V){var C;return g.l(function(U){switch(U.J){case 1:return g.Na(U,2),g.v(U,U1.open("test-only"),4);case 4:return g.v(U,U1.delete("test-only"),5);case 5:g.Jx(U,3);break;case 2:if(C=g.Po(U),C instanceof Error&&C.name==="SecurityError")return V(!1),U.return();case 3:V("caches"in window),g.Wo(U)}})});
return Y.return(Cl)})},kmr=function(){return g.l(function(Y){if(Y.J==1)return g.v(Y,N7D(),2);
if(!Y.Y)return Y.return(void 0);O78||(O78=new RKS);return Y.return(O78)})},nl=function(Y,V,C){g.ak(new g.g1("Woffle: "+Y,C?{cotn:C}:""));
V instanceof Error&&g.ak(V)},JzW=function(Y){var V;
return g.l(function(C){if(C.J==1)return g.v(C,B7v(Y),2);V=C.Y;g.ZX("offlineStateSnapshot",V);g.Wo(C)})},bt=function(Y){g.T.call(this);
var V=this;this.api=Y;this.BC={q4T:function(){return V.Y},
IJL:function(){return V.J}};
typeof g.tx.BroadcastChannel!=="undefined"&&(this.Y=new g.tx.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.KH()),this.Y.onmessage=this.S.bind(this),this.J=new g.tx.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.KH()),this.J.onmessage=this.W.bind(this))},E1=function(Y,V){Y.api.rT("onOfflineOperationFailure",V);
var C;(C=Y.Y)==null||C.postMessage(V)},d$D=function(Y,V,C,U){var n=this;
this.X=Y;this.L=V;this.visibility=C;this.K=U;this.V=this.C=this.D=this.S=this.Y=!1;this.W=new g.KK(function(){n.Kj()});
this.BC={j8:function(){return n.J},
Kj:function(){n.Kj()},
Oyx:function(){return n.W}};
this.visibility.subscribe("visibilitystatechange",function(){n.tB()})},q4R=function(Y){if(!Y.S&&!Y.Y){var V=AzD();
if(V){Y.S=!0;var C=g.KH("OfflineLockManager");V.request("woffle_orchestration_leader:"+C,{},function(){var U,n,b,E;return g.l(function(y){switch(y.J){case 1:return g.Na(y,2),Y.J=new g.Bt,Y.Y=!0,Y.S=!1,g.v(y,Y.X(),4);case 4:return g.v(y,Y.J.promise,5);case 5:g.Jx(y,0);break;case 2:U=g.Po(y),((b=(n=Y).K)==null?0:b.call(n,"wo_relinquish_leadership_on_lock_request_error"))||Y.Kj(),U instanceof Error&&(E=U,E.args=[{name:"WoLockManagerError",zG:U.name}],g.MR(E)),g.Wo(y)}})})}}},PsD=function(Y){Y.Y&&(Y.V=
!0,zP(Y))},x$v=function(Y,V){Y.Y&&(Y.D=V,zP(Y))},czb=function(Y,V){Y.Y&&(Y.C=V,zP(Y))},zP=function(Y){Y.C&&Y.D&&Y.V&&Y.visibility.isBackground()?g.Hh(Y.W,6E4):Y.W.stop()},it=function(Y){var V;
Y.offlineDeleteReason=(V=Y.offlineDeleteReason)!=null?V:"OFFLINE_DELETE_REASON_UNKNOWN";var C;Y.offlineModeType=(C=Y.offlineModeType)!=null?C:"OFFLINE_NOW";g.ZX("offlineDeleteEvent",Y)},yu=function(Y,V){var C=V.videoId;
var U=V.ZD;V=V.offlineModeType;Y.encryptedVideoId=C;Y.cotn=U==null?void 0:U.cotn;Y.offlineabilityFormatType=U==null?void 0:U.maximumDownloadQuality;var n;Y.isRefresh=(n=U==null?void 0:U.isRefresh)!=null?n:!1;var b;Y.softErrorCount=(b=U==null?void 0:U.transferRetryCount)!=null?b:0;Y.offlineModeType=V!=null?V:"OFFLINE_NOW";(Y.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&Y.statusType==="UNKNOWN_STATUS_TYPE"||!Y.transferStatusType&&!Y.statusType)&&g.ak(Error("Woffle unknown transfer status"));
g.ZX("offlineTransferStatusChanged",Y)},hKR=function(Y){yu({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},Y)},fzW=function(Y,V,C,U){U={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!U};V&&C&&(V=Math.floor(V/1024).toFixed(),C=Math.floor(C/1024).toFixed(),U.alreadyDownloadedKbytes=V,U.totalFetchedKbytes=V,U.totalContentKbytes=C);yu(U,Y)},vZD=function(Y){yu({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},Y)},wtv=function(Y){yu({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},Y)},lzv=function(Y){switch(Y){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
XX=function(Y){var V,C,U;
return((U=(V=Y.actionMetadata)==null?void 0:(C=V.retryScheduleIntervalsInSeconds)==null?void 0:C.length)!=null?U:0)>0},GP=function(Y){return Y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!Y.entityKey},Zo=function(Y){return Y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!Y.entityKey},Do=function(Y){return Y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!Y.entityKey},ptL=function(Y){return Y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!Y.entityKey},
ut=function(Y,V,C,U,n){n=n===void 0?!1:n;
var b,E,y,X,G,Z;return g.l(function(D){if(D.J==1)return b=g.bu(Y,V),E=g.bu(Y,"downloadStatusEntity"),g.v(D,g3(C,{mode:"readonly",cM:!0},function(u){return g.Pe.all([S5(u,b,V),S5(u,E,"downloadStatusEntity")])}),2);
y=D.Y;X=y.length?y[0]:void 0;if(!X)return D.OE(0);G=T7v;if(Z=y.length>1?y[1]:void 0){if(Z.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!n)return D.return();Z.downloadState=U}else Z={key:E,downloadState:U};g.mu(X,G,Z);return g.v(D,g3(C,{mode:"readwrite",cM:!0},function(u){return g.Pe.all([tJ(u,X,V),tJ(u,Z,"downloadStatusEntity")])}),0)})},BT=function(Y,V){return Y.actionType===V.actionType&&Y.entityKey===V.entityKey},s1=function(Y,V){if(Y&&Y.transferState!=="TRANSFER_STATE_COMPLETE"&&Y.transferState!==
"TRANSFER_STATE_FAILED"){var C=g.nV(Y.key).entityId;
yu({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:C,ZD:Y,offlineModeType:V})}},Ak=function(Y){if(!Y||!Y.thumbnails)return[];
var V=[];Y=g.N(Y.thumbnails);for(var C=Y.next();!C.done;C=Y.next())C=C.value,C.url&&V.push(C.url);return V},$$L=function(Y,V,C){C=C===void 0?[]:C;
var U,n,b,E,y,X,G,Z,D,u,B,A,O;return g.l(function(k){if(k.J==1)return C.length?g.v(k,YR(Y,V),2):k.return([]);U=k.Y;n=new Set;b=g.N(U);for(E=b.next();!E.done;E=b.next())if(y=E.value,X=y.id||y.key)G=g.nV(X).entityId,n.add(G);Z=[];D=g.N(C);for(u=D.next();!u.done;u=D.next())B=u.value,A=B.offlineVideoData,O=void 0,((O=A)==null?0:O.videoId)&&!n.has(A.videoId)&&Z.push(B);return k.return(Z)})},MmW=function(Y,V,C){return new g.Kr(Y,{cotn:V,
raw_player_response:C,download_media:!0,start:Infinity,disable_watch_next:!0})},azW=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},RF=function(Y,V,C,U,n,b,E,y,X,G,Z){this.entityType=Y;
this.actionId=V;this.action=C;this.parentActionId=U;this.rootActionId=n===void 0?V:n;this.childActionIds=b;this.prereqActionId=E;this.postreqActionIds=y;this.hasChildActionFailed=G;this.retryScheduleIndex=0;this.Y=Z||Date.now();this.retryScheduleIndex=X||0},WT=function(Y){if(!Y.key)throw Error("Entity key is required.");
if(!Y.actionProto)throw Error("OfflineOrchestrationAction is required.");var V=g.nV(Y.key),C=g.nV(Y.actionProto.entityKey);return new RF(C.entityType,V.entityId,Y.actionProto,Y.parentActionId,Y.rootActionId,Y.childActionIds,Y.prereqActionId,Y.postreqActionIds,Y.retryScheduleIndex,Y.hasChildActionFailed,Number(Y.enqueueTimeSec)*1E3)},N6=function(Y){return{key:g.bu(Y.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:Y.action,parentActionId:Y.parentActionId,rootActionId:Y.rootActionId,childActionIds:Y.childActionIds,prereqActionId:Y.prereqActionId,postreqActionIds:Y.postreqActionIds,retryScheduleIndex:Y.retryScheduleIndex,hasChildActionFailed:Y.hasChildActionFailed,enqueueTimeSec:(Y.Y/1E3).toFixed()}},Izv=function(){var Y;
return g.l(function(V){return V.J==1?g.v(V,kmr(),2):(Y=V.Y)?V.return(Y.delete("yt-player-local-img")):V.return(!0)})},O1=function(Y){var V,C;
return g.l(function(U){if(U.J==1)return g.v(U,kmr(),2);if(U.J!=3){V=U.Y;if(!V)throw Error("Cache API not supported");return Y.length?g.v(U,V.open("yt-player-local-img"),3):U.return()}C=U.Y;return g.v(U,Promise.all(Y.map(function(n){return C.delete(n)})),0)})},kR=function(Y){var V,C;
return g.l(function(U){if(U.J==1)return g.v(U,kmr(),2);if(U.J!=3){V=U.Y;if(!V)throw Error("Cache API not supported");return Y.length?g.v(U,V.open("yt-player-local-img"),3):U.return()}C=U.Y;return g.v(U,C.addAll(Y),0)})},Jk=function(Y,V,C,U,n){var b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv,xE,qa;
return g.l(function(US){switch(US.J){case 1:return b=g.bu(Y,"mainVideoEntity"),E=g.bu(Y,"ytMainChannelEntity"),y=g.bu(Y,"transfer"),X=g.bu(Y,"videoDownloadContextEntity"),g.v(US,g3(V,{mode:"readonly",cM:!0},function(J){return g.Pe.all([S5(J,b,"mainVideoEntity"),S5(J,E,"ytMainChannelEntity"),S5(J,y,"transfer"),S5(J,X,"videoDownloadContextEntity"),mU(J,"ytMainChannelEntity"),mU(J,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=US.Y;Z=g.N(G);D=Z.next().value;u=Z.next().value;B=Z.next().value;A=Z.next().value;O=Z.next().value;k=Z.next().value;q=D;d=u;c=B;w=A;a=O;t=k;if(!q&&!d){US.OE(3);break}S=q?Ak(q.thumbnail):[];if(!d){H=[];US.OE(4);break}return g.v(US,LBJ(d,a),5);case 5:H=US.Y;case 4:return UP=H,g.v(US,O1(S.concat(UP)),3);case 3:ov=[];bZ=g.bu(Y,"downloadStatusEntity");F=g.N(t);for(Bo=F.next();!Bo.done;Bo=F.next())dH=Bo.value,lZ=g.nV(dH.key).entityId,Wv=WT(dH),zv=g.nV(Wv.action.entityKey).entityId,lZ!==Y&&zv!==
Y||BT(C,dH.actionProto)||ov.push(dH.key);return g.v(US,g3(V,{mode:"readwrite",cM:!0},function(J){var zT=ov.map(function(jJ){return e5(J,jJ)});
zT.push(e5(J,b,{A0:!0}));zT.push(e5(J,bZ,{A0:!0}));return g.Pe.all(zT)}),7);
case 7:qa=(xE=w)==null?void 0:xE.offlineModeType,n&&(it(n),n.offlineModeType&&(qa=n.offlineModeType)),s1(c,qa),E1(U,{entityKey:b,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Wo(US)}})},m$D=function(Y,V,C,U){var n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv,xE,qa,US,J,zT,jJ,NH,cv,Gv,Iv,lb,hT,x,h,f,p,L,kE,VK,Ax;
return g.l(function(C0){switch(C0.J){case 1:return n=g.bu(Y,"mainPlaylistEntity"),b=g.bu(Y,"ytMainChannelEntity"),g.v(C0,g3(V,{mode:"readonly",cM:!0},function(hx){return g.Pe.all([S5(hx,n,"mainPlaylistEntity"),S5(hx,b,"ytMainChannelEntity"),mU(hx,"mainPlaylistEntity"),mU(hx,"mainDownloadsListEntity"),mU(hx,"ytMainChannelEntity"),mU(hx,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=C0.Y;y=g.N(E);X=y.next().value;G=y.next().value;Z=y.next().value;D=y.next().value;u=y.next().value;B=y.next().value;A=X;O=G;k=Z;q=D;d=u;c=B;if(!A&&!O){C0.OE(3);break}w=A?Q9v(A):[];if(!O){a=[];C0.OE(4);break}return g.v(C0,LBJ(O,d),5);case 5:a=C0.Y;case 4:return t=a,g.v(C0,O1(w.concat(t)),3);case 3:S=[];H=new Map;if(!A){C0.OE(7);break}return g.v(C0,S4W(A,k,q),8);case 8:S=C0.Y;UP=g.N(S);for(ov=UP.next();!ov.done;ov=UP.next())bZ=ov.value,H.set(bZ,{videoId:bZ,playlistId:Y,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.v(C0,g3(V,{mode:"readonly",cM:!0},function(hx){return g.Pe.all([mU(hx,"transfer"),mU(hx,"videoDownloadContextEntity")])}),9);
case 9:F=C0.Y;Bo=g.N(F);dH=Bo.next().value;lZ=Bo.next().value;Wv=dH;zv=lZ;xE=g.N(Wv);for(qa=xE.next();!qa.done;qa=xE.next())US=qa.value,J=g.nV(US.key).entityId,(zT=H.get(J))&&US&&(zT.cotn=US.cotn);jJ=g.N(zv);for(NH=jJ.next();!NH.done;NH=jJ.next())cv=NH.value,Gv=g.nV(cv.key).entityId,(Iv=H.get(Gv))&&cv&&(Iv.offlineModeType=cv.offlineModeType);case 7:lb=[];hT=g.N(c);for(x=hT.next();!x.done;x=hT.next())h=x.value,f=g.nV(h.key).entityId,p=WT(h),f!==Y&&p.rootActionId!==Y||BT(C,h.actionProto)||lb.push(h.key);
L=g.bu(Y,"mainPlaylistEntity");return g.v(C0,g3(V,{mode:"readwrite",cM:!0},function(hx){var FS=lb.map(function(kL){return e5(hx,kL)});
FS.push(e5(hx,L,{A0:!0}));return g.Pe.all(FS)}),10);
case 10:if(!A){C0.OE(0);break}S.reverse();if(!S){C0.OE(0);break}kE=g.N(S);VK=kE.next();case 13:if(VK.done){C0.OE(0);break}Ax=VK.value;return g.v(C0,Jk(Ax,V,C,U,H.get(Ax)),14);case 14:VK=kE.next(),C0.OE(13)}})},tmD=function(Y,V,C,U){var n,b,E,y,X,G,Z,D,u;
return g.l(function(B){if(B.J==1)return n=g.bu("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),b=new Map,g.v(B,g3(Y,{mode:"readwrite",cM:!0},function(A){var O=mU(A,"transfer"),k=mU(A,"offlineOrchestrationActionWrapperEntity"),q=mU(A,"videoDownloadContextEntity"),d=S5(A,n,"mainDownloadsListEntity");return g.Pe.all([O,k,q,d]).then(function(c){c=g.N(c);var w=c.next().value;var a=c.next().value;var t=c.next().value;var S=c.next().value;c=j9W.map(function(UP){return IkL(A,UP)});
a=g.N(a);for(var H=a.next();!H.done;H=a.next())H=H.value,BT(V,H.actionProto)||c.push(e5(A,H.key,{A0:!0}));S&&(S.downloads=[],c.push(tJ(A,S,"mainDownloadsListEntity")));if(t)for(t=g.N(t),S=t.next();!S.done;S=t.next())S=S.value,a=g.nV(S.key).entityId,a=g.bu(a,"transfer"),b.set(a,S.offlineModeType);return g.Pe.all(c).then(function(){return w})})}),2);
E=B.Y;y=g.N(E);for(X=y.next();!X.done;X=y.next())G=X.value,s1(G,b.get(G.key)),Z=g.nV(G.key).entityId,D={videoId:Z,offlineDeleteReason:U,cotn:G.cotn,offlineModeType:b.get(G.key)},it(D),u=g.bu(Z,"mainVideoEntity"),E1(C,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.v(B,Izv(),0)})},Q9v=function(Y,V){var C=[];
if(Y.thumbnailStyleData){Y=g.N(Y.thumbnailStyleData);for(var U=Y.next();!U.done;U=Y.next()){var n=void 0,b=void 0,E=void 0;C=C.concat(Ak((n=U.value)==null?void 0:(b=n.value)==null?void 0:(E=b.collageThumbnail)==null?void 0:E.coverThumbnail))}}V=Ak(V);return C.concat(V)},S4W=function(Y,V,C){var U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP;
return g.l(function(ov){U=[];n=new Set;if(C.length)for(b=g.N(C),E=b.next();!E.done;E=b.next())if(y=E.value,X=void 0,(X=y.downloads)==null?0:X.length)for(G=g.N(y.downloads),Z=G.next();!Z.done;Z=G.next())D=Z.value,D.videoItem&&(u=g.nV(D.videoItem).entityId,n.add(u));if(Y.videos){B=g.N(Y.videos);for(A=B.next();!A.done;A=B.next())O=A.value,k=JSON.parse(g.nV(O).entityId),k.videoId&&!n.has(k.videoId)&&U.push(k.videoId);q=g.N(V);for(d=q.next();!d.done;d=q.next())if(c=d.value,c.key!==Y.key&&(w=c.videos))for(a=
g.N(w),t=a.next();!t.done;t=a.next())S=t.value,H=JSON.parse(g.nV(S).entityId),H.videoId&&(UP=U.indexOf(H.videoId),UP!==-1&&U.splice(UP,1))}return ov.return(U)})},LBJ=function(Y,V){var C,U,n,b,E,y,X,G;
return g.l(function(Z){C=Ak(Y.avatar);U=g.N(V);for(n=U.next();!n.done;n=U.next())if(b=n.value,b.id!==Y.id)for(E=g.N(Ak(b.avatar)),y=E.next();!y.done;y=E.next())X=y.value,G=C.indexOf(X),G!==-1&&C.splice(G,1);return Z.return(C)})},eKD=function(Y){var V;
return g.l(function(C){V=g.I(Y.frameworkUpdates,dy);return Y.frameworkUpdates&&V?g.v(C,Y4W(V),0):C.return()})},FBJ=function(Y){var V;
if((V=Y.onResponseReceivedActions)!=null&&V.length){var C;Y=(C=g.I(g.I(Y.onResponseReceivedActions[0],rzS),g.ntL))==null?void 0:C.actions;if(Y!=null&&Y.length)return Y}},gZR=function(Y){var V,C,U;
return g.l(function(n){if(n.J==1)return Y?g.v(n,Hn(Y,g.$z,"mainDownloadsListEntity"),2):n.return([]);V=n.Y;return((C=V)==null?0:(U=C.downloads)==null?0:U.length)?n.return(V.downloads.map(function(b){var E;return(E=b.videoItem)!=null?E:""})):n.return([])})},H7r=function(Y,V){var C;
return g.l(function(U){return U.J==1?g.v(U,KBD(Y,V),2):(C=U.Y)?g.v(U,g3(Y,{mode:"readwrite",cM:!0},function(n){var b=[tJ(n,C.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];C.mainDownloadsListEntity&&b.push(tJ(n,C.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Pe.all(b)}),0):U.OE(0)})},KBD=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c;
return g.l(function(w){if(w.J==1)return C=g.bu("main_downloads_library_id","mainDownloadsLibraryEntity"),U=g.bu("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.v(w,g3(Y,{mode:"readonly",cM:!0},function(a){return g.Pe.all([S5(a,C,"mainDownloadsLibraryEntity"),S5(a,U,"mainDownloadsListEntity")])}),2);
n=w.Y;b=g.N(n);E=b.next().value;y=b.next().value;X=E;G=y;X||(X={id:C});Z=g.N(V);for(D=Z.next();!D.done;D=Z.next())if(u=D.value,u===g.$z){if(X.smartDownloadsList)return w.return();X.smartDownloadsList=u}else if(B=g.nV(u).entityType,A={},B==="mainPlaylistEntity"?A.playlistItem=u:B==="mainVideoEntity"&&(A.videoItem=u),!g.gR(A)){O=void 0;if((O=G)==null?0:O.downloads){k=!1;q=g.N(G.downloads);for(d=q.next();!d.done;d=q.next())if(c=d.value,c.playlistItem===u||c.videoItem===u){k=!0;break}k||G.downloads.push(A)}else G=
{id:U,downloads:[A]};X.downloadsList=U}return w.return({mainDownloadsLibraryEntity:X,mainDownloadsListEntity:G})})},YyA=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k;
return g.l(function(q){if(q.J==1)return C=g.bu("main_downloads_library_id","mainDownloadsLibraryEntity"),U=g.bu("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.v(q,g3(Y,{mode:"readonly",cM:!0},function(d){return g.Pe.all([S5(d,C,"mainDownloadsLibraryEntity"),S5(d,U,"mainDownloadsListEntity"),S5(d,g.$z,"mainDownloadsListEntity")])}),2);
n=q.Y;b=g.N(n);E=b.next().value;y=b.next().value;X=b.next().value;G=E;Z=y;D=X;if(!G)return q.OE(0);if(V===g.$z&&((u=D)==null?0:u.downloads))D.downloads=[];else if((B=Z)==null?0:B.downloads)for(A=g.nV(V).entityType,O=0;O<Z.downloads.length;O++)if(k=Z.downloads[O],A==="mainVideoEntity"&&k.videoItem===V){Z.downloads.splice(O,1);break}else if(A==="mainPlaylistEntity"&&k.playlistItem===V){Z.downloads.splice(O,1);break}return g.v(q,g3(Y,{mode:"readwrite",cM:!0},function(d){var c=[tJ(d,G,"mainDownloadsLibraryEntity")];
Z&&c.push(tJ(d,Z,"mainDownloadsListEntity"));D&&c.push(tJ(d,D,"mainDownloadsListEntity"));return g.Pe.all(c)}),0)})},q6=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u;
return g.l(function(B){if(B.J==1)return C=g.bu(V,"transfer"),U=g.bu(V,"videoDownloadContextEntity"),g.v(B,g3(Y,{mode:"readonly",cM:!0},function(A){return g.Pe.all([S5(A,C,"transfer"),S5(A,U,"videoDownloadContextEntity")])}),2);
n=B.Y;b=g.N(n);E=b.next().value;y=b.next().value;X=E;G=y;u={videoId:V,cotn:(Z=X)==null?void 0:Z.cotn,offlineModeType:(D=G)==null?void 0:D.offlineModeType};return B.return(u)})},PT=function(Y,V,C,U,n){var b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H;
return g.l(function(UP){switch(UP.J){case 1:return b=g.bu(Y,"musicTrack"),E=g.bu(Y,"transfer"),g.v(UP,g3(V,{mode:"readonly",cM:!0},function(ov){return g.Pe.all([S5(ov,b,"musicTrack"),S5(ov,E,"transfer"),mU(ov,"musicTrack"),mU(ov,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:y=UP.Y;X=g.N(y);G=X.next().value;Z=X.next().value;D=X.next().value;u=X.next().value;B=G;A=Z;O=D;k=u;if(!B){UP.OE(3);break}return g.v(UP,oBR(B,O),4);case 4:return q=UP.Y,g.v(UP,O1(q),3);case 3:d=[];c=g.N(k);for(w=c.next();!w.done;w=c.next())a=w.value,t=g.nV(a.key).entityId,S=WT(a),H=g.nV(S.action.entityKey).entityId,t!==Y&&H!==Y||BT(C,a.actionProto)||d.push(a.key);return g.v(UP,g3(V,{mode:"readwrite",cM:!0},function(ov){var bZ=d.map(function(F){return e5(ov,F)});
bZ.push(e5(ov,b,{A0:!0}));return g.Pe.all(bZ)}),6);
case 6:s1(A),n&&it(n),E1(U,{entityKey:b,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Wo(UP)}})},xR=function(Y,V,C,U,n){var b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv,xE,qa,US,J,zT,jJ,NH;
return g.l(function(cv){switch(cv.J){case 1:return b=g.bu(Y,V),E=g.bu("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(cv,g3(C,{mode:"readonly",cM:!0},function(Gv){return g.Pe.all([S5(Gv,b,V),S5(Gv,E,"musicDownloadsLibraryEntity"),mU(Gv,V),mU(Gv,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:y=cv.Y;X=g.N(y);G=X.next().value;Z=X.next().value;D=X.next().value;u=X.next().value;B=G;A=Z;O=D;k=u;if(!B){cv.OE(3);break}return g.v(cv,oBR(B,O),4);case 4:return q=cv.Y,g.v(cv,O1(q),3);case 3:d=[];c=new Map;if(!B){cv.OE(6);break}return g.v(cv,VCL(B,O,A),7);case 7:d=cv.Y;w=g.N(d);for(a=w.next();!a.done;a=w.next())t=a.value,S=g.nV(t).entityId,c.set(S,{videoId:S,playlistId:Y,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.v(cv,YR(C,"transfer"),8);case 8:for(H=cv.Y,UP=
g.N(H),ov=UP.next();!ov.done;ov=UP.next())bZ=ov.value,F=g.nV(bZ.key).entityId,(Bo=c.get(F))&&bZ&&(Bo.cotn=bZ.cotn);case 6:dH=[];lZ=g.N(k);for(Wv=lZ.next();!Wv.done;Wv=lZ.next())zv=Wv.value,xE=g.nV(zv.key).entityId,qa=WT(zv),xE!==Y&&qa.rootActionId!==Y||BT(U,zv.actionProto)||dH.push(zv.key);US=g.bu(Y,V);return g.v(cv,g3(C,{mode:"readwrite",cM:!0},function(Gv){var Iv=dH.map(function(lb){return e5(Gv,lb)});
Iv.push(e5(Gv,US,{A0:!0}));return g.Pe.all(Iv)}),9);
case 9:if(!B){cv.OE(0);break}d.reverse();if(!d.length){cv.OE(0);break}J=g.N(d);zT=J.next();case 12:if(zT.done){cv.OE(0);break}jJ=zT.value;NH=g.nV(jJ).entityId;if(!NH){cv.OE(13);break}return g.v(cv,PT(NH,C,U,n,c.get(NH)),13);case 13:zT=J.next(),cv.OE(12)}})},cT=function(Y,V,C){var U,n,b,E,y,X,G;
return g.l(function(Z){if(Z.J==1)return g.v(Z,g3(Y,{mode:"readwrite",cM:!0},function(D){var u=mU(D,"transfer"),B=mU(D,"offlineOrchestrationActionWrapperEntity");return g.Pe.all([u,B]).then(function(A){A=g.N(A);var O=A.next().value;var k=A.next().value;A=C4S.map(function(w){return IkL(D,w)});
k=g.N(k);for(var q=k.next();!q.done;q=k.next()){q=q.value;var d=g.nV(q.actionProto.entityKey).entityType==="musicTrack",c=q.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";BT(V,q.actionProto)||d&&(!d||c)||A.push(e5(D,q.key,{A0:!0}))}return g.Pe.all(A).then(function(){return O})})}),2);
U=Z.Y;n=g.N(U);for(b=n.next();!b.done;b=n.next())E=b.value,s1(E),y=g.nV(E.key).entityId,X={videoId:y,offlineDeleteReason:void 0,cotn:E.cotn},it(X),G=g.bu(y,"musicTrack"),E1(C,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.v(Z,Izv(),0)})},UWL=function(Y){for(var V,C=g.N(Y.additionalMetadatas),U=C.next();!U.done;U=C.next())U=U.value,U.offlineMusicVideoData&&(V=U.offlineMusicVideoData);
var n,b,E,y,X;return{id:g.bu(Y.videoId,"musicTrack"),videoId:Y.videoId,title:Y.title,thumbnailDetails:Y.thumbnail,lengthMs:String(Number(Y.lengthSeconds)*1E3),albumTitle:(n=V)==null?void 0:n.releaseTitle,musicVideoType:(b=V)==null?void 0:b.musicVideoType,contentRating:{explicitType:(E=V)==null?void 0:E.explicitType},artistNames:((y=V)==null?void 0:y.byline)||((X=V)==null?void 0:X.channelName),downloadMetadata:g.bu(Y.videoId,"musicTrackDownloadMetadataEntity")}},VCL=function(Y,V,C){var U,n,b,E,y,X,
G,Z,D,u,B,A,O,k,q,d,c,w;
return g.l(function(a){U=[];n=new Set;if((b=C)==null?0:(E=b.downloadedTracks)==null?0:E.length)for(y=g.N(C.downloadedTracks),X=y.next();!X.done;X=y.next())G=X.value,n.add(G);if(Y.tracks){Z=g.N(Y.tracks);for(D=Z.next();!D.done;D=Z.next())u=D.value,n.has(u)||U.push(u);B=g.N(V);for(A=B.next();!A.done;A=B.next())if(O=A.value,O.id!==Y.id&&(k=O.tracks))for(q=g.N(k),d=q.next();!d.done;d=q.next())c=d.value,w=U.indexOf(c),w!==-1&&U.splice(w,1)}return a.return(U)})},oBR=function(Y,V){var C,U,n,b,E,y,X,G;
return g.l(function(Z){C=Ak(Y.thumbnailDetails);U=g.N(V);for(n=U.next();!n.done;n=U.next())if(b=n.value,b.id!==Y.id)for(E=g.N(Ak(b.thumbnailDetails)),y=E.next();!y.done;y=E.next())X=y.value,G=C.indexOf(X),G!==-1&&C.splice(G,1);return Z.return(C)})},nBW=function(Y,V){var C,U,n,b,E,y,X,G,Z;
return g.l(function(D){if(D.J==1)return C=g.bu("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(D,Hn(Y,C,"musicDownloadsLibraryEntity"),2);(U=D.Y)||(U={id:C});n=g.nV(V).entityType;n==="musicTrack"?(b=U.downloadedTracks)!=null&&b.includes(V)||(U.downloadedTracks=((E=U.downloadedTracks)!=null?E:[]).concat(V)):n==="musicPlaylist"?(y=U.downloadedPlaylists)!=null&&y.includes(V)||(U.downloadedPlaylists=((X=U.downloadedPlaylists)!=null?X:[]).concat(V)):n!=="musicAlbumRelease"||(G=U.downloadedAlbumReleases)!=
null&&G.includes(V)||(U.downloadedAlbumReleases=((Z=U.downloadedAlbumReleases)!=null?Z:[]).concat(V));return g.v(D,K2(Y,U,"musicDownloadsLibraryEntity"),0)})},bKv=function(Y,V){var C,U,n,b,E,y,X;
return g.l(function(G){if(G.J==1)return C=g.bu("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(G,Hn(Y,C,"musicDownloadsLibraryEntity"),2);U=G.Y;if(!U)return G.OE(0);n=g.nV(V).entityType;n==="musicTrack"?b=U.downloadedTracks:n==="musicPlaylist"&&(b=U.downloadedPlaylists);if((E=b)==null?0:E.length)for(y=0;y<b.length;y++)if(X=b[y],X===V){b.splice(y,1);break}return g.v(G,K2(Y,U,"musicDownloadsLibraryEntity"),0)})},EBW=function(Y){var V=Y.videos;
Y=[];var C=[];if(V){V=g.N(V);for(var U=V.next();!U.done;U=V.next()){var n=U.value.offlineVideoData.videoId;U=g.bu(n,"musicTrack");n=g.bu(n,"musicTrackDownloadMetadataEntity");Y.push(U);C.push(n)}}return{Ev:Y,oB:C}},hk=function(Y,V,C){V={track:UWL(V)};
C&&(V.playlistId=C);if(Y=g.I(Y.actionMetadata,z3N))V.maximumDownloadQuality=Y.maximumDownloadQuality;return{musicTrackEntityActionMetadata:V}},y4L=function(Y){var V,C,U,n,b,E,y,X;
return g.l(function(G){switch(G.J){case 1:return V=g.Gw(),C=zKv(Y),U=g.sx(iKJ),g.Na(G,2),b={DJ:!0},g.v(G,g.Yu(V,C,U,void 0,b),4);case 4:n=G.Y;g.Jx(G,3);break;case 2:E=g.Po(G);if(E instanceof g.zw)throw y="GetOffline network manager error: "+E.message,nl(y,E),Error(y);nl("GetOffline fetch request error",E);throw Error("GetOffline fetch request error");case 3:X=fl(n);if(!n)throw nl("Network request failed"),Error("Network request failed");if(X!==void 0)vT(X);else if(!n.videos||!n.videos.length)throw nl("No data"),
Error("No data");return G.return(n.videos.map(function(Z){return Z.offlineVideoData}))}})},XhD=function(Y){var V,C,U,n,b,E,y,X;
return g.l(function(G){switch(G.J){case 1:return V=g.Gw(),C=i7W(Y),U=g.sx(iKJ),g.Na(G,2),b={DJ:!0},g.v(G,g.Yu(V,C,U,void 0,b),4);case 4:n=G.Y;g.Jx(G,3);break;case 2:E=g.Po(G);if(E instanceof g.zw)throw y="GetOffline network manager error for playlist: "+E.message,nl(y,E),Error(y);nl("GetOffline fetch request error for playlist",E);throw Error("GetOffline fetch request error for playlist");case 3:X=fl(n);if(!n)throw nl("Network request failed for playlist"),Error("Network request failed for playlist");
if(X!==void 0)vT(X,"playlist");else if(!n.playlists||!n.playlists.length)throw nl("No data for playlist"),Error("No data for playlist");return G.return(n.playlists.map(function(Z){return Z.offlinePlaylistData}))}})},ZKv=function(Y,V,C,U){var n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv;
return g.l(function(xE){switch(xE.J){case 1:return g.v(xE,oF(),2);case 2:n=xE.Y;if(!n)return xE.return([]);b=[];if((E=U)==null?0:E.length){b=U;xE.OE(3);break}return g.v(xE,YR(n,"mainPlaylistEntity"),4);case 4:b=xE.Y;case 3:if(!b.length)return xE.return([]);y=[];X=Date.now()/1E3;G=g.N(b);Z=G.next();case 5:if(Z.done)return y.length?g.v(xE,GnS(y),10):xE.return([]);D=Z.value;if(!D.downloadState){u=void 0;xE.OE(8);break}return g.v(xE,Hn(n,D.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:u=
xE.Y;case 8:B=u;A=void 0;k=(O=(A=D)==null?void 0:A.entityMetadata)&&O.nextAutoRefreshIntervalSeconds?Number(O.nextAutoRefreshIntervalSeconds):NaN;q=Number.isNaN(k)?Y:k;c=d=void 0;w=((d=B)==null?0:d.lastSyncedTimestampMillis)?Number((c=B)==null?void 0:c.lastSyncedTimestampMillis)/1E3:0;t=a=void 0;S=((a=B)==null?0:a.addedTimestampMillis)?Number((t=B)==null?void 0:t.addedTimestampMillis)/1E3:0;if(C||!O||w+q<=X){H=[];UP=void 0;if((UP=D.videos)==null?0:UP.length)for(ov=g.N(D.videos),bZ=ov.next();!bZ.done;bZ=
ov.next())F=bZ.value,Bo=JSON.parse(g.nV(F).entityId),Bo.videoId&&H.push(Bo.videoId);dH="0";O&&(lZ=void 0,dH=String(Number((lZ=O.offlineLastModifiedTimestampSeconds)!=null?lZ:0).toFixed()));Wv={playlistId:D.playlistId,videoIds:H,offlineLastModifiedTimestamp:dH,autoSync:V,offlineDateAddedTimestamp:String(S.toFixed())};y.push(Wv)}Z=G.next();xE.OE(5);break;case 10:return zv=xE.Y,xE.return(zv)}})},DWv=function(){var Y,V,C,U,n;
return g.l(function(b){if(b.J==1)return g.v(b,oF(),2);if(b.J!=3)return(Y=b.Y)?g.v(b,YR(Y,"refresh"),3):b.return(!1);V=b.Y;if((C=V[0])==null||!C.refreshTime)return b.return(!1);U=Number(V[0].refreshTime);n=Date.now()/1E3;return b.return(isFinite(U)&&n>=U)})},BYA=function(Y,V){var C,U,n;
return g.l(function(b){switch(b.J){case 1:return g.Na(b,2),g.v(b,uOL(Y,V),4);case 4:return U=b.Y,g.v(b,eKD(U),5);case 5:C=FBJ(U);g.Jx(b,3);break;case 2:n=g.Po(b),nl("getAndProcessSmartDownloadsResponse request or processing error",n);case 3:return b.return(C)}})},s5J=function(Y,V,C,U){var n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv;
return g.l(function(xE){switch(xE.J){case 1:return g.v(xE,oF(),2);case 2:n=xE.Y;if(!n)return xE.return([]);b=[];if((E=U)==null?0:E.length){b=U;xE.OE(3);break}return g.v(xE,YR(n,"musicPlaylist"),4);case 4:b=xE.Y;case 3:if(!b.length)return xE.return([]);y=[];X=Date.now()/1E3;G=g.N(b);Z=G.next();case 5:if(Z.done)return y.length?g.v(xE,GnS(y),10):xE.return([]);D=Z.value;u=void 0;A=(B=(u=D)==null?void 0:u.entityMetadata)&&B.nextAutoRefreshIntervalSeconds?Number(B.nextAutoRefreshIntervalSeconds):NaN;O=
Number.isNaN(A)?Y:A;q=k=0;d="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!D.downloadMetadata){xE.OE(8);break}return g.v(xE,Hn(n,D.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:c=xE.Y,a=w=void 0,k=Number((a=(w=c)==null?void 0:w.addedTimestampMillis)!=null?a:"0")/1E3,S=t=void 0,q=Number((S=(t=c)==null?void 0:t.lastModifiedTimestampMillis)!=null?S:"0")/1E3,UP=H=void 0,d=(UP=(H=c)==null?void 0:H.syncState)!=null?UP:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:ov=void 0;if(C||d!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!B||Number((ov=B.lastSyncedTimestampSeconds)!=null?ov:0)+O<=X){bZ=[];F=void 0;if((F=D.tracks)==null?0:F.length)for(Bo=g.N(D.tracks),dH=Bo.next();!dH.done;dH=Bo.next())lZ=dH.value,bZ.push(g.nV(lZ).entityId);Wv={playlistId:D.playlistId,videoIds:bZ,offlineLastModifiedTimestamp:String(q.toFixed()),autoSync:V,offlineDateAddedTimestamp:String(k.toFixed())};y.push(Wv)}Z=G.next();xE.OE(5);break;case 10:return zv=xE.Y,xE.return(zv)}})},uOL=function(Y,V){var C,U,n,b,E,y,X,G,Z,D;
return g.l(function(u){switch(u.J){case 1:return C=g.Gw(),g.v(u,oF(),2);case 2:U=u.Y;if(!U){u.OE(3);break}return g.v(u,B7v(U),4);case 4:n=u.Y;case 3:var B=n;b={context:g.Ux(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:Y},offlineClientState:B,clientStateRequestData:{preferredFormatType:V}}}};E=g.sx(A4b);g.Na(u,5);X={DJ:!0};return g.v(u,g.Yu(C,b,E,void 0,X),7);case 7:y=u.Y;g.Jx(u,6);break;case 5:G=g.Po(u);if(G instanceof g.zw)throw Z=
"DPS network manager error for smart downloads: "+G.message,nl(Z,G),Error(Z);nl("DPS fetch request error for smart downloads",G);throw Error("DPS fetch request error for smart downloads");case 6:D=fl(y);if(y)D!==void 0&&vT(D,"smart downloads");else throw nl("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return u.return(y)}})},Wjv=function(Y,V){var C,U,n,b,E,y,X,G;
return g.l(function(Z){switch(Z.J){case 1:return C=g.Gw(),U={context:g.Ux(),videoPlaybackPositionEntities:Y,lastSyncTimestampUsec:V},n=g.sx(R3v),g.Na(Z,2),E={DJ:!0},g.v(Z,g.Yu(C,U,n,void 0,E),4);case 4:b=Z.Y;g.Jx(Z,3);break;case 2:y=g.Po(Z);if(y instanceof g.zw)throw X="VPPS network manager error: "+y.message,nl(X,y),Error(X);nl("VPPS fetch request error",y);throw Error("VPPS fetch request error");case 3:G=fl(b);if(b)G!==void 0&&vT(G,"position sync");else throw nl("Network request failed for position sync"),
Error("Network request failed for position sync");return Z.return(b)}})},OKN=function(Y,V,C){var U,n,b,E,y,X,G,Z;
return g.l(function(D){switch(D.J){case 1:U=g.Gw();var u=C.refreshData,B=C.isEnqueuedForExpiredStreamUrlRefetch,A=C.Y_,O=C.offlineSourceData,k=C.mediaCapabilities,q={entityKey:Y};u&&(q.refreshData=u);B&&(q.isExpiredStreamUrlRefetch=B);A&&(q.downloadParameters=A);O&&(q.offlineSourceData=O);u={context:g.X6(V),signatureTimestamp:20236,videos:[q]};k&&(u.mediaCapabilities=k);n=u;b=g.sx(NYL);g.Na(D,2);y={DJ:!0};return g.v(D,g.Yu(U,n,b,void 0,y),4);case 4:E=D.Y;g.Jx(D,3);break;case 2:X=g.Po(D);if(X instanceof
g.zw)throw G="GetPDE network manager error: "+X.message,nl(G,X),Error(G);nl("GetPDE fetch request error",X);throw Error("GetPDE fetch request error");case 3:Z=fl(E);if(E)Z!==void 0&&vT(Z,"PDE");else throw nl("Network request failed for PDE"),Error("Network request failed for PDE");return D.return(E)}})},fl=function(Y){var V;
return(V=Y.errorMetadata)==null?void 0:V.status},vT=function(Y,V){V=V?" for "+V:"";
if(Y===0)throw Y="Empty response body"+V,nl(Y),Error(Y);Y="Response with error"+V;nl(Y);throw Error(Y);},GnS=function(Y){var V,C,U,n,b,E,y,X;
return g.l(function(G){switch(G.J){case 1:return V=g.Gw(),C=yzv(Y),U=g.sx(knR),g.Na(G,2),b={DJ:!0},g.v(G,g.Yu(V,C,U,void 0,b),4);case 4:n=G.Y;g.Jx(G,3);break;case 2:E=g.Po(G);if(E instanceof g.zw)throw y="offlinePlaylistSyncCheck network manager error: "+E.message,nl(y,E),Error(y);nl("offlinePlaylistSyncCheck fetch request error",E);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:X=fl(n);if(!n)throw nl("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(X!==void 0)vT(X,"playlist sync");else if(!n.offlinePlaylistSyncCheckDatas||!n.offlinePlaylistSyncCheckDatas.length)throw nl("No data for playlist sync"),Error("No data for playlist sync");return G.return(n.offlinePlaylistSyncCheckDatas.map(function(Z){return Z.offlinePlaylistSyncCheckData}))}})},wy=function(Y){this.Y=Y},J4R=function(Y,V){var C,U,n,b,E,y;
return g.l(function(X){switch(X.J){case 1:C=new Map,U=g.N(V),n=U.next();case 2:if(n.done){X.OE(4);break}b=n.value;E=C;y=E.set;return g.v(X,Y.J(b),5);case 5:y.call(E,b,X.Y);n=U.next();X.OE(2);break;case 4:return X.return(C)}})},lt=function(Y,V,C,U,n,b){V=g.bu(V,C);
U=Object.assign({},b,{priority:U,retryScheduleIntervalsInSeconds:n});return{actionType:Y,entityKey:V,actionMetadata:U}},pl=function(Y,V,C,U,n,b){this.status=Y;
this.Y=V;this.W=C;this.J=U;this.S=n;this.downloadState=b},dWD=function(Y,V,C){this.Y=Y;
this.zy=V;this.S=C},xWA=function(Y,V){var C,U,n,b,E,y,X,G,Z;
return g.l(function(D){switch(D.J){case 1:return C=V.entityKey,n=(U=g.I(V.actionMetadata,TP))==null?void 0:U.isEnqueuedForExpiredStreamUrlRefetch,g.Na(D,2),b=void 0,g.v(D,qyr(Y,V),4);case 4:b=D.Y;g.Na(D,5);var u=(u=g.I(V.actionMetadata,TP))?{maximumDownloadQuality:u.maximumDownloadQuality}:void 0;return g.v(D,OKN(C,Y.zy,{isEnqueuedForExpiredStreamUrlRefetch:n,Y_:u,offlineSourceData:b}),7);case 7:E=D.Y;g.Jx(D,6,2);break;case 5:return g.Po(D,2),y=XX(V)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",nl("PDE handleAdd error"),D.return($R(V,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",y,"DOWNLOAD_STATE_FAILED"));case 6:return g.v(D,P4D(Y,E,V),8);case 8:return D.return($R(V,!0,E.orchestrationActions));case 2:return X=g.Po(D),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.We&&X.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),nl("PDE handleAdd error"),D.return($R(V,!1,void 0,G,Z,"DOWNLOAD_STATE_FAILED"))}})},f1D=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP;
return g.l(function(ov){switch(ov.J){case 1:return C=V.entityKey,U=g.nV(C).entityId,g.v(ov,g3(Y.Y,{mode:"readonly",cM:!0},function(bZ){var F=S5(bZ,C,"playbackData"),Bo=S5(bZ,g.bu(U,"offlineVideoPolicy"),"offlineVideoPolicy");bZ=S5(bZ,g.bu(U,"transfer"),"transfer");return g.Pe.all([F,Bo,bZ])}),2);
case 2:n=ov.Y;b=g.N(n);E=b.next().value;y=b.next().value;X=b.next().value;G=E;Z=y;D=X;if(!G||!Z)return ov.return($R(V,!0));u=[];O=((A=G)==null?0:A.playerResponseJson)?JSON.parse(G.playerResponseJson):null;if(!(D&&O&&Y.zy.K("html5_refresh_deprecated_downloads"))){ov.OE(3);break}B=c4J(Y,O,D);return g.v(ov,h3r(Y,D),4);case 4:u=ov.Y;case 3:k={lastPlayerResponseTimestampSeconds:G.playerResponseTimestamp,offlineToken:Z.offlineToken,formatIds:u};q={};if((d=D)==null?0:d.maximumDownloadQuality)q.maximumDownloadQuality=
D.maximumDownloadQuality;g.Na(ov,5);c=void 0;return g.v(ov,qyr(Y,V),7);case 7:return c=ov.Y,g.Na(ov,8),g.v(ov,OKN(C,Y.zy,{refreshData:k,Y_:q,offlineSourceData:c,mediaCapabilities:B}),10);case 10:w=ov.Y;g.Jx(ov,9,5);break;case 8:return g.Po(ov,5),a=XX(V)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",nl("PDE handleRefresh error"),ov.return($R(V,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",a,
"DOWNLOAD_STATE_FAILED"));case 9:return g.v(ov,P4D(Y,w,V),11);case 11:return ov.return($R(V,!0,w.orchestrationActions));case 5:return t=g.Po(ov),S="PDE handleRefresh error",t instanceof Error&&(S="PDE handleRefresh error: "+t.message),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",UP="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.We&&t.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",UP="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
nl(S),ov.return($R(V,!1,void 0,H,UP,"DOWNLOAD_STATE_FAILED"))}})},qyr=function(Y,V){var C,U,n,b;
return g.l(function(E){if(E.J==1)return C=g.nV(V.entityKey).entityId,U=g.bu(C,"videoDownloadContextEntity"),g.v(E,Hn(Y.Y,U,"videoDownloadContextEntity"),2);n=E.Y;return(b=n)!=null&&b.offlineModeType?E.return({offlineModeType:n.offlineModeType}):E.return(void 0)})},P4D=function(Y,V,C){var U,n,b,E,y;
return g.l(function(X){if(X.J==1){if(!V.frameworkUpdates||!g.I(V.frameworkUpdates,dy))return X.return();if(!(g.I(V.frameworkUpdates,dy).mutations&&g.I(V.frameworkUpdates,dy).mutations.length>0&&g.I(V.frameworkUpdates,dy).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return X.OE(2);U=g.nV(g.I(V.frameworkUpdates,dy).mutations[0].entityKey).entityId;return g.v(X,q6(Y.Y,U),3)}if(X.J!=2){n=X.Y;b=g.I(C.actionMetadata,TP);if(y=(E=b)==null?void 0:E.playlistId)n.playlistId=y;n.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Uh(Y.zy)?g.v(X,Jk(U,Y.Y,C,Y.S,n),2):g.m3(Y.zy)?g.v(X,PT(U,Y.Y,C,Y.S),2):X.OE(2)}return g.v(X,Y4W(g.I(V.frameworkUpdates,dy)),0)})},$R=function(Y,V,C,U,n,b){return new pl(V?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",XX(Y),C,U,n,b)},c4J=function(Y,V,C){V=MmW(Y.zy,C.cotn,V);
C=g.B$(V);return g.HDS(V,C,Y.zy)},h3r=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u;
return g.l(function(B){if(B.J==1)return C=[],g.v(B,g3(Y.Y,{mode:"readonly",cM:!0},function(A){var O=[],k=V.offlineVideoStreams;if(k){k=g.N(k);for(var q=k.next();!q.done;q=k.next())O.push(S5(A,q.value,"offlineVideoStreams"))}return g.Pe.all(O)}),2);
if(U=B.Y)for(n=g.N(U),b=n.next();!b.done;b=n.next())if(E=b.value,y=void 0,(y=E)==null?0:y.streamsProgress)for(X=E.streamsProgress,G=0;G<X.length;G++)Z=X[G],D=JSON.parse(Z.formatStreamBytes),u={itag:D.itag,lmt:D.lastModified,xtags:D.xtags},C.push(u);return B.return(C)})},vBL=function(Y,V){this.Y=Y;
this.zy=V},whJ=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B;
return g.l(function(A){switch(A.J){case 1:return C=XX(V),g.v(A,YR(Y.Y,"videoPlaybackPositionEntity"),2);case 2:U=A.Y;if(U.length===0)return A.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.Na(A,3);return g.v(A,I7.getInstance(),5);case 5:n=A.Y;if(!n)throw Error("prefStorage is undefined");return g.v(A,n.get("psi"),6);case 6:return b=A.Y,X=(y=(E=b)==null?void 0:E.J3)!=null?y:"0",g.v(A,Wjv(U,X),7);case 7:return G=A.Y,Z={isPaused:G.watchHistoryPaused,J3:G.syncTimestampUsec},g.v(A,n.set("psi",
Z),8);case 8:if(Z.isPaused){A.OE(9);break}D=g.I(G.frameworkUpdates,dy);if(!G.frameworkUpdates||!D){A.OE(9);break}return g.v(A,Y4W(D),9);case 9:g.Jx(A,4);break;case 3:return u=g.Po(A),B="PPE handleRefresh error: "+(u instanceof Error?u.message:"unknown error"),nl(B),A.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return A.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},phN=function(Y,V){var C,U,n,b,E,y,X,G;
return g.l(function(Z){switch(Z.J){case 1:return C=XX(V),U=g.nV(V.entityKey).entityId,g.Na(Z,2),g.v(Z,I7.getInstance(),4);case 4:n=Z.Y;if(!n)throw Error("prefStorage is undefined");return g.v(Z,n.get("psi"),5);case 5:b=Z.Y;E=g.I(V.actionMetadata,l1L);if(((y=b)==null?void 0:y.isPaused)!==!1||(X=E)==null||!X.lastPlaybackPositionSeconds){Z.OE(6);break}G={key:g.bu(U,"videoPlaybackPositionEntity"),videoId:U,lastPlaybackPositionSeconds:E.lastPlaybackPositionSeconds};return g.v(Z,K2(Y.Y,G,"videoPlaybackPositionEntity"),
6);case 6:g.Jx(Z,3);break;case 2:return g.Po(Z),Z.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},TYT=function(Y,V){var C,U,n;
return g.l(function(b){switch(b.J){case 1:C=XX(V);g.Na(b,2);U=g.nV(V.entityKey).entityId;if(U==="!*$_ALL_ENTITIES_!*$")return g.v(b,rAv(Y.Y),5);n=g.bu(U,"videoPlaybackPositionEntity");return g.v(b,e6A(Y.Y,n),5);case 5:g.Jx(b,3);break;case 2:return g.Po(b),b.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},$W8=function(Y,V){this.api=Y;
this.Y=V;this.logger=new g.XT("woffle");this.J=!1;this.BC={Mc:this.Mc};this.logger.debug("Initialized OfflineMediaManager")},MCv=function(Y){return g.l(function(V){return V.return(EZr(Y))})},a1J=function(Y){var V;
return g.l(function(C){if(C.J==1)return g.v(C,g.qDJ(Y),2);V=C.Y;return C.return(V.filter(function(U){return!!U.url}).map(function(U){return U.url}))})},M6=function(Y,V){var C=g.$W(V);
if(C===1||C===0)return Promise.resolve();(C=I1T(Y,V))&&C.stopVideo();Y.S=0;return MCv(V)},aF=function(Y,V,C,U){C=C===void 0?!1:C;
U=U===void 0?!0:U;var n=typeof V==="string"?V:V.videoDetails.videoId;g.$W(n)===2&&((V=I1T(Y,n))?V.stopVideo():Y.logger.info(function(){return"Corresponding player for "+n+" not found. Pausing anyway"}),g.MN(n,2),Y.S=2,C?LjJ(Y.Y):U&&Q5R(Y.Y))},I1T=function(Y,V){var C;
return((C=Y.player)==null?void 0:C.getVideoData().videoId)===V?Y.player:null},SyR=function(Y,V,C){V.getPlayerResponse();
g.MN(V.videoId,2);Y.S=2;Y.J=!1;var U;(U=Y.player)==null||U.dispose();Y.player=Y.api.Ze(V);V={};Y.player.ll((V.localmediachange=Y.xs,V.signatureexpired=Y.NO,V.statechange=Y.Jfy,V),Y);var n=Y.Mc(C);Y.player.Nr(g.uX(n,n,!0,"m"),!1);Y.logger.debug(function(){return"Starting headless playback with quality: "+n});
Y.player.FO(!1)},mWr=function(Y,V){this.Y=Y;
this.zy=V},tCL=function(Y,V){var C,U;
return g.l(function(n){switch(n.J){case 1:return C=XX(V),g.v(n,Hn(Y.Y,V.entityKey,"transfer"),2);case 2:if(U=n.Y)return n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.Na(n,3);return g.v(n,j5A(Y,V),5);case 5:g.Jx(n,4);break;case 3:return g.Po(n),n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},e3R=function(Y,V){var C,U;
return g.l(function(n){switch(n.J){case 1:return C=XX(V),g.v(n,Hn(Y.Y,V.entityKey,"transfer"),2);case 2:U=n.Y;if(!U||U.transferState!=="TRANSFER_STATE_COMPLETE")return n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.Na(n,3);return g.v(n,j5A(Y,V,!0),5);case 5:g.Jx(n,4);break;case 3:return g.Po(n),n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},r4L=function(Y,V){var C,U,n,b,E,y,X,G,Z,D;
return g.l(function(u){switch(u.J){case 1:return C=XX(V),U=g.nV(V.entityKey).entityId,g.v(u,g3(Y.Y,{mode:"readonly",cM:!0},function(B){var A=S5(B,V.entityKey,"transfer");B=S5(B,g.bu(U,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Pe.all([A,B])}),2);
case 2:n=u.Y;b=g.N(n);E=b.next().value;y=b.next().value;X=E;G=y;if(!X||X.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return u.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.Na(u,3);X.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.v(u,K2(Y.Y,X,"transfer"),5);case 5:Z=g.nV(X.key).entityId;vZD({videoId:Z,ZD:X,offlineModeType:(D=G)==null?void 0:D.offlineModeType});g.Jx(u,4);break;case 3:return g.Po(u),u.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return u.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},j5A=function(Y,V,C){C=C===void 0?!1:C;
var U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q;return g.l(function(d){switch(d.J){case 1:return U=g.I(V.actionMetadata,Fjr),n=g.nV(V.entityKey).entityId,b=g.bu(n,"downloadStatusEntity"),g.v(d,g3(Y.Y,{mode:"readonly",cM:!0},function(c){var w=S5(c,b,"downloadStatusEntity");c=S5(c,g.bu(n,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Pe.all([w,c])}),2);
case 2:return E=d.Y,y=g.N(E),X=y.next().value,G=y.next().value,Z=X,D=G,u="TRANSFER_STATE_TRANSFER_IN_QUEUE",((B=Z)==null?void 0:B.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(u="TRANSFER_STATE_PAUSED_BY_USER"),k={key:V.entityKey,transferState:u,cotn:g.qP(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(A=U)==null?void 0:A.maximumDownloadQuality,preferredAudioTrack:(O=U)==null?void 0:O.preferredAudioTrack,transferRetryCount:0,isRefresh:C,hasLoggedFirstStarted:!1},g.v(d,g3(Y.Y,
{mode:"readwrite",cM:!0},function(c){var w=[];C&&w.push(e5(c,g.bu(n,"offlineVideoStreams")));w.push(tJ(c,k,"transfer"));return g.Pe.all(w)}),3);
case 3:if(!C){d.OE(4);break}return g.v(d,MCv(n),4);case 4:hKR({videoId:n,ZD:k,offlineModeType:(q=D)==null?void 0:q.offlineModeType}),g.Wo(d)}})},KjA=function(Y,V,C,U){if(!Y.action.entityKey)throw Error("entityKey is missing.");
var n=g.nV(Y.action.entityKey);n={entityType:n.OD,entityId:n.entityId,offlineOrchestrationActionType:Y.action.actionType,orchestrationAction:{orchestrationActionId:Y.actionId}};V&&(n.offlineOrchestrationActionResult=V.status,n.isRetryable=C?!1:V.Y,V.S&&(n.offlineOrchestrationFailureReason=gBR(V.S,n.isRetryable)));var b,E;if((b=Y.action.actionMetadata)==null?0:(E=b.offlineLoggingData)==null?0:E.offlineModeType)n.offlineModeType=Y.action.actionMetadata.offlineLoggingData.offlineModeType;U&&(n.additionalOrchestrationActions=
U.map(function(y){return{orchestrationActionId:y.actionId}}));
return n},gBR=function(Y,V){return Y!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||V?Y==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&V?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":Y:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},HKT=function(Y,V){var C={offlineOrchestrationContext:KjA(Y)};
V=D$R(V,C);uBT(Z7J(),V,Y.rootActionId)},Y5v=function(Y,V,C,U){U=U===void 0?[]:U;
V={offlineOrchestrationContext:KjA(Y,V,C,U)};V=D$R(3,V);uBT(Z7J(),V,Y.rootActionId)},ofD=function(){this.actions=[]},VjN=function(Y,V){V=g.N(V);
for(var C=V.next();!C.done;C=V.next())C=C.value,HKT(C,1),Y.actions.push(C);Y.actions.sort(Y.Y)},CpD=function(Y,V){if(V)for(var C=0;C<Y.actions.length;C++)if(V==="!*$_ALL_ENTITIES_!*$"&&Y.actions[C].actionId!==V||V!=="!*$_ALL_ENTITIES_!*$"&&Y.actions[C].rootActionId===V&&Y.actions[C].actionId!==V)Y.actions.splice(C,1),C--},Umb=function(Y,V){Y=g.N(Y.actions);
for(var C=Y.next();!C.done;C=Y.next())if(C.value.actionId===V)return!0;return!1},IF=function(Y,V,C,U,n){g.T.call(this);
var b=this;this.J=Y;this.jL=V;this.sE=C;this.C=U;this.zy=n;this.Y=new ofD;this.D=new g.gv;this.S=new g.KK(function(){b.retry()});
this.X=NaN;this.V=!1;this.BC={RA8:function(){return b.Y},
Or:function(){return b.D},
aJE:function(){return b.S},
retry:function(){return b.retry()}};
g.M(this,this.S);this.L=this.J.observe(this.Jn.bind(this))},EfS=function(Y,V,C,U,n){var b;
return g.l(function(E){if(E.J==1)return b=new IF(Y,V,C,U,n),g.v(E,nfb(b),2);bjR(b);return E.return(b)})},bjR=function(Y){var V=Y.Y.actions[0];
return Y.W?((V==null?void 0:V.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&Y.W[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Y.V=!0),Promise.resolve()):zEv(Y)},zEv=function(Y){var V,C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q;
return g.l(function(d){switch(d.J){case 1:if(Y.W)throw Error("Already processing an action");if(Y.Vs())return d.return();V=Y.Y.actions.shift();x$v(Y.sE,!V);if(V===void 0)return d.return();V.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&V.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&CpD(Y.Y,V.actionId);C="";V.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&V.rootActionId===V.actionId&&(C=V.actionId);U=[V];Y.W=U;if(n=Y.jL[V.entityType]){d.OE(2);break}Y.W=
void 0;return g.v(d,zEv(Y),3);case 3:return d.return();case 2:b=g.N(U);for(E=b.next();!E.done;E=b.next())y=E.value,HKT(y,2);g.Na(d,4,5);return g.v(d,J4R(n,U.map(function(c){return c.action})),7);
case 7:X=d.Y,G=g.N(U),Z=G.next();case 8:if(Z.done){d.OE(10);break}D=Z.value;u=X.get(D.action);return g.v(d,ijW(Y,D,u),9);case 9:Z=G.next();d.OE(8);break;case 10:CpD(Y.Y,C);case 5:g.co(d);Y.W=void 0;g.f0(d,6);break;case 4:return B=g.Po(d),nl("Orchestration error",B),g.Na(d,12),g.v(d,yFv(Y,U),14);case 14:g.Jx(d,5);break;case 12:A=g.Po(d);nl("Orchestration retry error",A);O=g.N(U);for(k=O.next();!k.done;k=O.next())q=k.value,q.retryScheduleIndex<3&&VjN(Y.Y,[q]);d.OE(5);break;case 6:return g.v(d,zEv(Y),
0)}})},ijW=function(Y,V,C){var U,n,b,E,y,X,G,Z,D,u,B,A;
return g.l(function(O){switch(O.J){case 1:U=V.retryScheduleIndex+2===3;if(C.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){O.OE(2);break}if(C.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){O.OE(0);break}Y5v(V,C,U);if(C.Y&&V.retryScheduleIndex+1<3)return g.v(O,yFv(Y,[V]),0);b=((n=C)==null?0:n.J)?C.J:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";E={entityKey:V.action.entityKey,failureReason:b};y=void 0;g.Uh(Y.zy)?y="mainVideoDownloadStateEntity":g.m3(Y.zy)&&(y="musicTrackDownloadMetadataEntity");
if(!y||!C.downloadState){O.OE(7);break}X=g.nV(V.action.entityKey).entityId;return g.v(O,ut(X,y,Y.J,C.downloadState),7);case 7:E1(Y.C,E);if(C.downloadState==="DOWNLOAD_STATE_FAILED"&&Y.zy.K("html5_auto_retry_failed_pde_actions")){O.OE(0);break}nl("Orchestration result is not retryable, deleting action");return g.v(O,e6A(Y.J,N6(V).key),0);case 2:G=void 0;try{G=(Z=C.W)==null?void 0:Z.map(function(k){return Y.createAction(k,V)})}catch(k){return Y5v(V,C,U),D={entityKey:V.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},E1(Y.C,D),nl("Orchestration subactions creation error",k),O.return()}Y5v(V,C,U,G);if(!G){O.OE(12);break}u=G.map(function(k){return N6(k)});
B=0;case 13:if(!(B<G.length)||Y.V){O.OE(15);break}return g.v(O,g3(Y.J,{mode:"readwrite",cM:!0},function(k){var q=[];q.push($oN(k,u.slice(B,B+10),"offlineOrchestrationActionWrapperEntity"));return g.Pe.all(q)}),16);
case 16:B+=10;O.OE(13);break;case 15:if(Y.V)return Y.V=!1,O.return();case 12:return A=N6(V),g.v(O,e6A(Y.J,A.key),17);case 17:HKT(V,4),g.Wo(O)}})},DmW=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B;
return g.l(function(A){C=[];U=Infinity;n=4E3;b=g.N(V);for(E=b.next();!E.done;E=b.next())y=E.value,X=Number(y.enqueueTimeSec),G=XDA(X),Z=y.retryScheduleIndex,D=Z!=null&&Z>0,G>0&&D?(U=Math.min(U,X),n=Math.min(G,n)):C.push(y);isFinite(U)&&(!Y.S.isActive()||U<Y.X)&&(Y.X=U,Y.S.start(n));Y.D.dV()||(u=C.length,C=C.filter(function(O){var k;O=((k=O.actionProto)==null?void 0:k.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!G7J.includes(O)}),B=C.length<u,!Y.S.isActive()&&B&&Y.S.start(1));
C.length>0&&ZjL(Y,C);return g.v(A,bjR(Y),0)})},BVJ=function(Y){var V,C,U,n,b,E,y;
return g.l(function(X){if(X.J==1)return g.v(X,ucW(Y),2);V=X.Y;C=[];U=g.N(V);for(n=U.next();!n.done;n=U.next())b=n.value,E=g.nV(b.key),y=E.entityId,Umb(Y.Y,y)||C.push(b);return g.v(X,DmW(Y,C),0)})},XDA=function(Y){Y=Y*1E3-Date.now();
return Y>4E3?4E3:Y},yFv=function(Y,V){var C,U,n;
return g.l(function(b){C=g.N(V);for(U=C.next();!U.done;U=C.next()){n=U.value;var E=void 0,y=void 0,X=((y=n.action)==null?void 0:(E=y.actionMetadata)==null?void 0:E.retryScheduleIntervalsInSeconds)||[1,2,4];E=1;n.retryScheduleIndex<X.length&&(E=X[n.retryScheduleIndex]);n.Y=E*1E3+Date.now();n.retryScheduleIndex++}return g.v(b,szD(Y,V),0)})},nfb=function(Y){var V;
return g.l(function(C){if(C.J==1)return g.v(C,YR(Y.J,"offlineOrchestrationActionWrapperEntity"),2);V=C.Y;return g.v(C,DmW(Y,V),0)})},ZjL=function(Y,V){V.length!==0&&V.forEach(function(C){C=WT(C);
C.retryScheduleIndex<3&&VjN(Y.Y,[C])})},ucW=function(Y,V){var C;
return g.l(function(U){if(U.J==1)return g.v(U,YR(Y.J,"offlineOrchestrationActionWrapperEntity",V),2);C=U.Y;return U.return(C.filter(oZL))})},szD=function(Y,V){if(V.length===0)return Promise.resolve([]);
V=V.map(function(C){return N6(C)});
return t_L(Y.J,V)},AFv=function(Y){this.Qs=Y;
this.Y=void 0},RET=function(Y,V){var C,U,n,b;
return g.l(function(E){C=V.videoId;U=!0;if(V.captionTracks.length)n=vHv(V),Y.Y=new g.Jy(Y.Qs,V,n);else if(V.Km)b=g.Tox(V),Y.Y=new g.qG(Y.Qs,V.Km,C,b,V.HJ,V.eventId),U=V.HJ;else return E.return();return E.return(new Promise(function(y){var X;(X=Y.Y)==null||X.Nf({TN:function(){return g.l(function(G){if(G.J==1)return g.v(G,Y.TN(C,U),2);y();g.Wo(G)})},
O8:function(){}})}))})},Wiv=function(Y){var V;
return g.l(function(C){if(C.J==1)return g.v(C,b7A(Y),2);V=C.Y;return C.return(!!V&&V.length>0)})},Ll=function(Y){g.T.call(this);
this.Y=Y;this.J=this.Y.observe(this.S.bind(this))},NV8=function(Y,V){var C,U,n,b,E,y,X;
return g.l(function(G){switch(G.J){case 1:if(V.length===0)return G.return([]);C=V.map(function(Z){return g.bu(Z,"transfer")});
return g.v(G,YR(Y.Y,"transfer",C),2);case 2:U=G.Y;n=U.filter(oZL).map(function(Z){return g.nV(Z.key).entityId});
b=V.filter(function(Z){return n.indexOf(Z)===-1});
if(b.length===0)return G.return([]);E=g.N(b);y=E.next();case 3:if(y.done){G.OE(5);break}X=y.value;return g.v(G,MCv(X),4);case 4:y=E.next();G.OE(3);break;case 5:return G.return(b)}})},JFv=function(Y,V,C,U,n,b){var E,y,X;
return g.l(function(G){E="STREAM_TYPE_UNKNOWN";C.video&&C.audio?(E="STREAM_TYPE_AUDIO_AND_VIDEO",nl("unexpected stream type")):C.video&&!C.audio?E="STREAM_TYPE_VIDEO":!C.video&&C.audio&&(E="STREAM_TYPE_AUDIO");y=g.bu(V,"offlineVideoStreams");X={numBytesDownloaded:n.toFixed(),numTotalBytes:b.toFixed(),streamType:E,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(U),itag:E==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(C.itag):void 0};return g.v(G,g3(Y,{mode:"readwrite",cM:!0},
function(Z){var D=S5(Z,y,"offlineVideoStreams"),u=S5(Z,g.bu(V,"transfer"),"transfer");return g.Pe.all([D,u]).then(function(B){B=g.N(B);var A=B.next().value;B=B.next().value;if(!B)return e5(Z,y).then(function(){});
var O=OjT(A);A=k7R(A,U,X,y);var k=tJ(Z,A,"offlineVideoStreams");OjT(A)>O&&(B.lastProgressTimeMs=Date.now().toString());O=[k];B.offlineVideoStreams||(B.offlineVideoStreams=[]);B.offlineVideoStreams.indexOf(y)===-1&&(B.offlineVideoStreams.push(y),O.push(tJ(Z,B,"transfer")));return g.Pe.all(O)})}),0)})},dmL=function(Y,V){var C,U,n,b,E;
return g.l(function(y){if(y.J==1)return C=g.bu(V,"offlineVideoStreams"),g.v(y,Hn(Y,C,"offlineVideoStreams"),2);U=y.Y;if(!U||!U.streamsProgress)return y.return();n=g.N(U.streamsProgress);for(b=n.next();!b.done;b=n.next())E=b.value,E.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",E.numTotalBytes!==E.numBytesDownloaded&&(E.numBytesDownloaded=E.numTotalBytes);return g.v(y,K2(Y,U,"offlineVideoStreams"),0)})},k7R=function(Y,V,C,U){if(Y&&Y.streamsProgress){U=Y;
a:{V=V.itag+";"+V.xtags;for(var n=Y.streamsProgress,b=0;b<n.length;b++){var E=JSON.parse(n[b].formatStreamBytes);if(E.itag+";"+E.xtags===V){n[b]=C;C=n;break a}}n.push(C);C=n}U.streamsProgress=C}else Y={key:U,streamsProgress:[C]};return Y},OjT=function(Y){if(Y==null?0:Y.streamsProgress){var V=0;
Y=Y.streamsProgress;for(var C=0;C<Y.length;C++){var U=Y[C];isNaN(Number(U.numBytesDownloaded))?nl("stream progress bytes number invalid"):V+=Number(U.numBytesDownloaded)}return V}return 0},q58=function(Y,V,C,U){g.T.call(this);
var n=this;this.J=Y;this.api=V;this.Ty=C;this.Jn=U;this.D=new g.gv;this.W=new g.KK(function(){n.Y&&n.Y.transferState==="TRANSFER_STATE_TRANSFERRING"&&n.D.dV()&&((n.Y.transferRetryCount||0)<3?aF(n.C,n.V,!1,!1):M6(n.C,n.V.videoDetails.videoId),n.VL("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.sE=this.vx=0;this.L=this.X=!1;this.UE=g.NQ(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.Cb=new g.QI(this);this.BC={iy8:function(){return n.W},
Ynt:function(){return n.Jn},
Or:function(){return n.D}};
this.jL=this.J.observe(this.eJ.bind(this));this.C=new $W8(V,this);this.wT=new AFv(V);this.dT=new Ll(this.J);this.eL=this.D.listen("publicytnetworkstatus-online",this.ZO.bind(this));this.F8=this.D.listen("publicytnetworkstatus-offline",this.Qmt.bind(this));this.L=this.api.U().K("html5_less_transfer_processing_logs");g.M(this,this.Cb);this.Cb.Z(V,"offlinetransferpause",this.T88);g.Uh(this.api.U())?this.S="mainVideoDownloadStateEntity":g.m3(this.api.U())&&(this.S="musicTrackDownloadMetadataEntity")},
Pp8=function(Y){return g.l(function(V){if(V.J==1)V=g.v(V,U$J(),2);
else{var C=Y.dT;var U=g.T5();U=Object.keys(U);C=NV8(C,U);V=g.v(V,C,0)}return V})},So=function(Y,V){V=V===void 0?!1:V;
var C;return g.l(function(U){if(U.J==1){if(Y.Y)throw Error("Already downloading a video");Y.sE=0;Y.X=!1;return g.v(U,xmL(Y),2)}return U.J!=4?(C=U.Y,czb(Y.Ty,!C),C&&Y.D.dV()?V?g.v(U,new Promise(function(n){g.Rj(n,1E3)}),4):U.OE(4):(!C&&Y.Y&&Qu(Y),U.OE(0))):g.v(U,cFv(Y,C),0)})},hED=function(Y){return g.l(function(V){if(V.J==1)return Y.V?g.v(V,M6(Y.C,Y.V.videoDetails.videoId),3):V.OE(0);
Qu(Y);g.Wo(V)})},f9T=function(Y,V){var C,U,n;
return g.l(function(b){switch(b.J){case 1:return g.Na(b,2),(C=!!V.captionTracks.length||!!V.Km)?g.v(b,Wiv(V.videoId),4):b.return();case 4:return(U=b.Y)?b.return():g.v(b,RET(Y.wT,V),5);case 5:g.Jx(b,0);break;case 2:n=g.Po(b),nl("Caption downloading error",n,V.cotn),g.Wo(b)}})},cFv=function(Y,V){var C,U,n,b,E,y;
return g.l(function(X){switch(X.J){case 1:if(Y.X)return X.return();Y.X=!0;Y.Y=V;C=g.nV(Y.Y.key);U=C.entityId;n=void 0;if(Y.Y.transferState==="TRANSFER_STATE_TRANSFERRING")return g.v(X,mC(Y,U),7);if(Y.Y.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||Y.Y.transferRetryCount||Y.Y.hasLoggedFirstStarted){X.OE(3);break}return g.v(X,mC(Y,U),5);case 5:return n=X.Y,Y.Y.hasLoggedFirstStarted=!0,g.v(X,vfN(Y),6);case 6:fzW({videoId:U,ZD:Y.Y,offlineModeType:n},void 0,void 0,!0);X.OE(3);break;case 7:n=X.Y,
yu({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:U,ZD:Y.Y,offlineModeType:n});case 3:return g.v(X,wDA(Y),8);case 8:return b=null,g.Na(X,9),g.v(X,l9A(Y,V),11);case 11:b=X.Y;Y.V=b;g.Jx(X,10);break;case 9:return E=g.Po(X),nl("error getting player response",E,V.cotn),g.v(X,Y.VL("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return X.return();case 10:return y=MmW(Y.api.U(),V.cotn,b),g.v(X,f9T(Y,y),13);case 13:return g.v(X,a1J(y.videoId),
14);case 14:y.AF=X.Y,SyR(Y.C,y,V.maximumDownloadQuality),Y.W.start(108E5),g.Wo(X)}})},xmL=function(Y){var V,C;
return g.l(function(U){if(U.J==1)return g.v(U,YR(Y.J,"transfer"),2);V=U.Y;C=V.filter(pDr).sort(TVL);return C.length===0?U.return():U.return(C[0])})},wDA=function(Y){var V,C,U;
return g.l(function(n){if(n.J==1){if(!Y.Y)return jo(Y,"onTransferStart"),n.return();Y.W.start(108E5);return g.v(n,tk(Y,"TRANSFER_STATE_TRANSFERRING"),2)}V=Y.Y;return(U=((C=V)==null?0:C.key)?g.nV(V.key).entityId:"")&&Y.S?g.v(n,ut(U,Y.S,Y.J,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):n.OE(0)})},LjJ=function(Y){var V,C,U,n;
g.l(function(b){switch(b.J){case 1:if(!Y.Y){jo(Y,"onTransferPausedByUser");b.OE(2);break}V=Y.Y;Y.W.stop();return g.v(b,tk(Y,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:U=((C=V)==null?0:C.key)?g.nV(V.key).entityId:"";if(!U||!Y.S){b.OE(4);break}return g.v(b,ut(U,Y.S,Y.J,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.v(b,mC(Y,U),6);case 6:n=b.Y,wtv({videoId:U,ZD:V,offlineModeType:n});case 2:Qu(Y),So(Y),g.Wo(b)}})},Q5R=function(Y){var V,C,U;
g.l(function(n){if(n.J==1){if(!Y.Y)return jo(Y,"onTransferPausedByNetwork"),n.return();Y.W.stop();return g.v(n,tk(Y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(n.J!=3)return V=Y.Y,(U=((C=V)==null?0:C.key)?g.nV(V.key).entityId:"")&&Y.S?g.v(n,ut(U,Y.S,Y.J,"DOWNLOAD_STATE_PAUSED"),3):n.OE(3);Qu(Y);g.Wo(n)})},$m8=function(Y){var V,C,U,n,b;
g.l(function(E){switch(E.J){case 1:if(!Y.Y)return jo(Y,"onTransferComplete"),E.return();V=Y.Y;Y.W.stop();if(!V||!Y.V){E.OE(2);break}C=MmW(Y.api.U(),V.cotn,Y.V);return g.v(E,f9T(Y,C),2);case 2:return g.v(E,tk(Y,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:n=((U=V)==null?0:U.key)?g.nV(V.key).entityId:"";if(!n||!Y.S){E.OE(5);break}return g.v(E,ut(n,Y.S,Y.J,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.v(E,dmL(Y.J,n),7);case 7:return g.v(E,mC(Y,n),8);case 8:b=E.Y,yu({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:n,ZD:V,offlineModeType:b}),Qu(Y),So(Y),g.Wo(E)}})},Mjv=function(Y,V,C){var U,n;
g.l(function(b){switch(b.J){case 1:if(!Y.Y)return jo(Y,"onTransferProgress: "+V),b.return();if(Y.Y.transferState==="TRANSFER_STATE_TRANSFERRING"){b.OE(2);break}return g.v(b,wDA(Y),2);case 2:U=Date.now();if(!(U-Y.vx>1E3)){b.OE(4);break}Y.vx=U;return g.v(b,JFv(Y.J,C.videoId,C.J,C.aW,C.bytesDownloaded,C.Y),5);case 5:if(Y.L&&!(Y.L&&U-Y.sE>Y.UE)){b.OE(4);break}Y.sE=U;return g.v(b,mC(Y,V),7);case 7:n=b.Y,fzW({videoId:V,ZD:Y.Y,offlineModeType:n},C.bytesDownloaded,C.Y);case 4:Y.W.start(108E5),g.Wo(b)}})},
a9R=function(Y){var V=(Y.Y.transferRetryCount||0)<3;
V&&(Y=Y.Y,Y.transferRetryCount=(Y.transferRetryCount||0)+1);return V},I9L=function(Y,V){V=V===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":V;
var C,U,n,b;return g.l(function(E){if(E.J==1)return Y.Y||jo(Y,"setTransferToFailed: "+V),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V==="TRANSFER_FAILURE_REASON_NETWORK"?C="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":V==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.v(E,tk(Y,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",V),2);if(E.J!=3)return E1(Y.Jn,{entityKey:(U=Y.Y)==null?void 0:U.key,failureReason:C}),
n=Y.Y?g.nV(Y.Y.key).entityId:"",g.v(E,mC(Y,n),3);b=E.Y;var y={videoId:n,ZD:Y.Y,offlineModeType:b},X=V,G={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};X&&(G.transferFailureReason=X,G.failureReason=lzv(X));yu(G,y);g.Wo(E)})},tk=function(Y,V,C,U){var n;
return g.l(function(b){if(b.J==1){if(!Y.Y)return jo(Y,"saveTransferState: "+V),b.return();Y.Y.transferState=V;Y.Y.failureReason=U;g.Na(b,2);return g.v(b,vfN(Y,function(E){return C?mU(E,"offlineVideoStreams",Y.Y.offlineVideoStreams).then(function(y){for(var X=g.N(y),G=X.next();!G.done;G=X.next())if((G=G.value)&&G.streamsProgress){G=g.N(G.streamsProgress);for(var Z=G.next();!Z.done;Z=G.next())Z.value.streamState=C}return $oN(E,y.filter(function(D){return!!D}),"offlineVideoStreams")}):g.Pe.resolve(void 0)}),
4)}if(b.J!=2)return g.Jx(b,0);
n=g.Po(b);return n instanceof g.We&&n.type==="QUOTA_EXCEEDED"?g.v(b,Y.VL("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):b.OE(0)})},vfN=function(Y,V){var C;
return g.l(function(U){if(!Y.Y)return U.return();C=Y.Y;return g.v(U,g3(Y.J,{mode:"readwrite",cM:!0},function(n){var b=[tJ(n,C,"transfer")];V&&b.push(V(n));return g.Pe.all(b)}),0)})},Qu=function(Y){Y.Y=void 0;
Y.V=void 0;Y.W.stop()},l9A=function(Y,V){var C,U,n,b,E;
return g.l(function(y){if(y.J==1)return C=g.nV(V.key),U=C.entityId,n=g.bu(U,"playbackData"),g.v(y,Hn(Y.J,n,"playbackData"),2);b=y.Y;if((E=b)==null?0:E.playerResponseJson)return y.return(JSON.parse(b.playerResponseJson));throw Error("No PlayerResponse found");})},jo=function(Y,V){Y.api.SL("woffle",{mcte:V});
nl("missing current transfer entity.")},mC=function(Y,V){var C,U,n;
return g.l(function(b){if(b.J==1)return g.v(b,Hn(Y.J,g.bu(V,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);C=b.Y;return b.return((n=(U=C)==null?void 0:U.offlineModeType)!=null?n:void 0)})},pDr=function(Y){return LiJ[Y.transferState]!==void 0},TVL=function(Y,V){var C=LiJ[Y.transferState],U=LiJ[V.transferState];
return C!==U?C-U:Number(Y.enqueuedTimestampMs)-Number(V.enqueuedTimestampMs)},eo=function(Y,V){var C=this;
this.zy=Y;this.api=V;this.D=new g.gv;this.V=new g.Bt;this.BC={j8:function(){return C.S.BC.j8()},
Or:function(){return C.D},
sli:function(){return C.S},
Xb:function(){return C.Xb()},
JG:function(){return C.JG()},
po:function(){return C.po()},
eQ:function(){return C.eQ()},
aU:function(){return C.aU()},
DQ:function(U){return C.DQ(U)}};
this.S=new d$D(function(){return Qz8(C)},function(){C.po()},this.api.uN(),this.api.K.bind(this.api));
this.Y=new bt(this.api);q4R(this.S)},Qz8=function(Y){return g.l(function(V){Y.api.rT("onOrchestrationBecameLeader");
return g.v(V,Y.JG(),0)})},mmJ=function(Y){var V,C;
return g.l(function(U){if(U.J==1)return g.v(U,oF(),2);if(U.J!=3){V=U.Y;if(!V)return nl("PES is undefined"),U.return();Y.J=new q58(V,Y.api,Y.S,Y.Y);C=Y.kO(V);return g.v(U,EfS(V,C,Y.S,Y.Y,Y.zy),3)}Y.C=U.Y;return g.v(U,S5L(Y),0)})},S5L=function(Y){var V;
return g.l(function(C){switch(C.J){case 1:if(!Y.J)return nl("transferManager is undefined"),C.return();if(Y.J.Y){C.OE(2);break}return g.v(C,So(Y.J),2);case 2:if(!Y.zy.K("woffle_enable_main_downloads_library")){C.OE(4);break}return g.v(C,Y.ai(),4);case 4:if(!Y.zy.K("html5_offline_playback_position_sync")){C.OE(6);break}return g.v(C,Y.Cf(),7);case 7:return g.v(C,Y.DQ(864E5),6);case 6:return g.v(C,Y.refreshAllStaleEntities(43200,!0),9);case 9:return g.v(C,Y.hL(),10);case 10:if(!Y.zy.K("html5_retry_downloads_for_expiration")){C.OE(11);
break}return g.v(C,Y.aU(),11);case 11:return Y.X=g.Ww(function(){Y.refreshAllStaleEntities(43200,!0);Y.hL()},9E5),g.V3(g.UW(),function(){return Y.eQ()}),g.v(C,oF(),13);
case 13:return V=C.Y,g.v(C,JzW(V),14);case 14:PsD(Y.S),g.Wo(C)}})},jzv=function(){var Y,V,C,U,n,b;
return g.l(function(E){switch(E.J){case 1:return g.v(E,oF(),2);case 2:Y=E.Y;if(!Y)return E.return([]);V=Date.now()/1E3;return g.v(E,YR(Y,"offlineVideoPolicy"),3);case 3:C=E.Y,U=g.N(C),n=U.next();case 4:if(n.done){E.OE(6);break}b=n.value;if(!(b.expirationTimestamp&&Number(b.expirationTimestamp)<V)){E.OE(5);break}b.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";b.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.v(E,K2(Y,b,"offlineVideoPolicy"),5);
case 5:n=U.next();E.OE(4);break;case 6:return E.return(C.map(function(y){return y.key}))}})},ry=function(Y,V,C,U,n){var b,E,y;
return g.l(function(X){if(X.J==1)return g.v(X,oF(),2);b=X.Y;if(!b)return X.return([]);E=V.map(function(G){var Z=g.bu(G,C);Z={actionType:U,entityKey:Z,actionMetadata:Object.assign({},azW(),n)};U!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(Z.actionMetadata.priority=0);G=new RF(C,G,Z);return N6(G)});
y=t_L(b,E);q4R(Y.S);return X.return(y)})},tjJ=function(Y,V,C,U){var n,b,E,y,X,G,Z,D;
return g.l(function(u){switch(u.J){case 1:n=[],b=g.N(V),E=b.next();case 2:if(E.done){u.OE(4);break}y=E.value;if(y.upToDate||C&&!y.shouldAutoSyncMetadata||!y.playlistId){u.OE(3);break}X={};switch(U){case "mainPlaylistEntity":G={nextAutoRefreshIntervalSeconds:y.checkInSeconds,autoSync:C};X={mainPlaylistEntityActionMetadata:G};break;case "musicPlaylist":Z={autoSync:C},X={musicPlaylistEntityActionMetadata:Z}}return g.v(u,ry(Y,[y.playlistId],U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X),6);case 6:(D=
u.Y)&&n.push.apply(n,g.P(D));case 3:E=b.next();u.OE(2);break;case 4:return u.return(n)}})},eEA=function(Y,V){var C;
return g.l(function(U){return V.length?(C=azW(),g.mu(C,TP,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Y.api.SL("qrd",{v:V.length}),U.return(ry(Y,V,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C))):U.return([])})},rFN=function(Y,V,C){this.Y=Y;
this.zy=V;this.S=C},Kir=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d;
return g.l(function(c){switch(c.J){case 1:return C=XX(V),U=g.nV(V.entityKey),n=U.entityId,b=[],g.Na(c,2),g.v(c,Fir(Y,n),4);case 4:b=c.Y;if(!(Y.zy.K("woffle_enable_main_downloads_library")&&((E=b)==null?0:E.length))){c.OE(5);break}return g.v(c,H7r(Y.Y,[V.entityKey]),5);case 5:g.Jx(c,3);break;case 2:return y=g.Po(c),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.We&&y.type==="QUOTA_EXCEEDED"?(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):nl("Playlist add error"),c.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,X,G));case 3:Z=[];if(!Y.zy.K("html5_offline_prevent_redownload_downloaded_video")){c.OE(7);break}return g.v(c,$$L(Y.Y,"mainVideoEntity",b),8);case 8:b=c.Y;case 7:if((D=b)==null?0:D.length)for(u=g.N(b),B=u.next();!B.done;B=u.next())if(A=B.value,O=A.offlineVideoData,k=void 0,(k=O)==null?0:k.videoId)q=void 0,d=Number(((q=V.actionMetadata)==null?void 0:q.priority)||
0)+1,Z.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O.videoId,"mainVideoEntity",d,FX,gfv(V,O,n)));return c.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,Z))}})},YvN=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv,xE,qa,US,J,zT,jJ,NH,cv,Gv,Iv,lb,hT,x,h,f,p,L,kE,VK,Ax,C0,hx,FS,kL,OB,wc,KX,tH,HF,k7,u2,TY,Rg,$K,rD,Fg,he,bo,YK,b$,vh,K_;
return g.l(function(u$){switch(u$.J){case 1:return C=XX(V),U=V.entityKey,n=g.nV(U).entityId,b=[],E=!1,n==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.v(u$,YR(Y.Y,"mainPlaylistEntity"),5)):g.v(u$,Hn(Y.Y,U,"mainPlaylistEntity"),4);case 4:(y=u$.Y)&&b.push(y);u$.OE(3);break;case 5:b=u$.Y;case 3:if((X=b)==null||!X.length)return u$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));G=g.I(V.actionMetadata,HjT);D=(Z=G)==null?void 0:Z.nextAutoRefreshIntervalSeconds;B=(u=G)==null?void 0:u.autoSync;A=[];k=O=
!0;q=!1;if(!E&&B===!1){u$.OE(6);break}g.Na(u$,7);return g.v(u$,ZKv(0,!!B,!0,b),9);case 9:A=u$.Y;g.Jx(u$,8);break;case 7:d=g.Po(u$);if(!(d instanceof Error&&d.message==="No data")){d instanceof Error&&d.message==="Empty response body"&&nl(d.message);u$.OE(8);break}return n==="!*$_ALL_ENTITIES_!*$"?g.v(u$,tmD(Y.Y,V,Y.S,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.v(u$,m$D(n,Y.Y,V,Y.S),8);case 8:if(!A.length||!E&&A[0].playlistId!==n)return u$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C));case 6:if(E){c=[];w=g.N(A);for(a=w.next();!a.done;a=w.next())t=a.value,t.upToDate||B&&!t.shouldAutoSyncMetadata||!t.playlistId||(S={nextAutoRefreshIntervalSeconds:t.checkInSeconds,autoSync:B},c.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"mainPlaylistEntity",0,FX,{mainPlaylistEntityActionMetadata:S})));return u$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,c))}A.length&&(H=A[0],q=!!H.upToDate,B&&(O=(UP=H.shouldAutoSyncMetadata)!=null?UP:!0,k=(ov=H.shouldAutoSyncVideos)!=
null?ov:!0,H.checkInSeconds&&(D=H.checkInSeconds)));if(q||!O)return u$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));bZ=[];F=b[0];if(!F.downloadState){Bo=void 0;u$.OE(15);break}return g.v(u$,Hn(Y.Y,F.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Bo=u$.Y;case 15:return dH=Bo,Wv=((lZ=dH)==null?0:lZ.addedTimestampMillis)?String(dH.addedTimestampMillis):void 0,g.Na(u$,17),g.v(u$,Fir(Y,n,Wv,D),19);case 19:bZ=u$.Y;g.Jx(u$,18);break;case 17:zv=g.Po(u$);if(!(zv instanceof
Error&&zv.message==="No data for playlist")){if(zv instanceof Error&&zv.message==="Empty response body for playlist")nl(zv.message);else return xE="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",qa="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",zv instanceof g.We&&zv.type==="QUOTA_EXCEEDED"&&(xE="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",qa="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,xE,qa));
u$.OE(18);break}return g.v(u$,m$D(n,Y.Y,V,Y.S),18);case 18:if(!k)return u$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));US=[];J=new Map;if((zT=bZ)==null?0:zT.length)for(jJ=g.N(bZ),NH=jJ.next();!NH.done;NH=jJ.next())cv=NH.value,Gv=cv.offlineVideoData,Iv=void 0,((Iv=Gv)==null?0:Iv.videoId)&&J.set(Gv.videoId,Gv);lb=new Map;hT=[];if((x=F)==null?0:(h=x.videos)==null?0:h.length)for(f=g.N(F.videos),p=f.next();!p.done;p=f.next())if(L=p.value,kE=JSON.parse(g.nV(L).entityId),VK=kE.videoId)J.has(VK)?
(lb.set(VK,J.get(VK)),J.delete(VK)):hT.push(VK);C0=Number(((Ax=V.actionMetadata)==null?void 0:Ax.priority)||0)+1;hx=g.N(J.entries());for(FS=hx.next();!FS.done;FS=hx.next())kL=FS.value,OB=g.N(kL),wc=OB.next().value,KX=OB.next().value,tH=wc,HF=KX,US.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",tH,"mainVideoEntity",C0,FX,gfv(V,HF,n)));k7=g.N(lb.entries());for(u2=k7.next();!u2.done;u2=k7.next())TY=u2.value,Rg=g.N(TY),$K=Rg.next().value,rD=Rg.next().value,Fg=$K,he=rD,US.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Fg,"mainVideoEntity",C0,FX,gfv(V,he,n)));bo=g.N(hT);for(YK=bo.next();!YK.done;YK=bo.next())b$=YK.value,vh={playlistId:n},K_={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:vh},US.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",b$,"mainVideoEntity",0,FX,K_));return u$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,US))}})},o_L=function(Y,V){var C,U,n,b;
return g.l(function(E){switch(E.J){case 1:return C=XX(V),g.Na(E,2),U=g.nV(V.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.v(E,tmD(Y.Y,V,Y.S,(n=V.actionMetadata)==null?void 0:(b=n.offlineLoggingData)==null?void 0:b.offlineDeleteReason),5):g.v(E,m$D(U,Y.Y,V,Y.S),6);case 6:if(!Y.zy.K("woffle_enable_main_downloads_library")){E.OE(5);break}return g.v(E,YyA(Y.Y,V.entityKey),5);case 5:g.Jx(E,3);break;case 2:return g.Po(E),E.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},Fir=function(Y,V,C,U){var n,b,E,y,X,G,Z;
return g.l(function(D){switch(D.J){case 1:return g.v(D,XhD([V]),2);case 2:return n=D.Y,g.v(D,VyJ(Y,n[0],C,U),3);case 3:return b=D.Y,E=b.mainPlaylistEntity,y=b.HMb,G=Q9v(E,(X=y)==null?void 0:X.avatar),g.Na(D,4),g.v(D,kR(G),6);case 6:g.Jx(D,5);break;case 4:Z=g.Po(D),Z instanceof Error&&Z.message==="Failed to fetch"&&nl(Z.message);case 5:return D.return(n[0].videos)}})},VyJ=function(Y,V,C,U){var n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w;
return g.l(function(a){switch(a.J){case 1:n=Date.now().toString();C||(C=n);b=V.videos;E=V.playlistId;y=[];X=[];if(b)for(G=g.N(b),Z=G.next();!Z.done;Z=G.next()){D=Z.value;u=D.offlineVideoData;if(!u||!u.videoId)throw nl("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");B=u.videoId;A={videoId:B,playlistId:E};O={id:g.bu(JSON.stringify(A),"mainPlaylistVideoEntity"),video:g.bu(B,"mainVideoEntity")};y.push(O);X.push(O.id)}q={key:g.bu(E,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:C,lastSyncedTimestampMillis:n};d={key:g.bu(E,"mainPlaylistEntity"),playlistId:E,videos:X,title:V.title,thumbnailStyleData:CNb(V),visibility:UXv(V),downloadState:q.key};V.channel&&(c=V.channel.offlineChannelData,k=n_r(g.bu(E,"ytMainChannelEntity"),c),d.channelOwner=k.id);((w=d)==null?0:w.entityMetadata)?(d.entityMetadata.offlineLastModifiedTimestampSeconds=V.lastModifiedTimestamp,U&&(d.entityMetadata.nextAutoRefreshIntervalSeconds=String(U))):d&&(d.entityMetadata={nextAutoRefreshIntervalSeconds:U?
String(U):void 0,offlineLastModifiedTimestampSeconds:V.lastModifiedTimestamp});g.Na(a,2);return g.v(a,g3(Y.Y,{mode:"readwrite",cM:!0},function(t){var S=tJ(t,d,"mainPlaylistEntity"),H=tJ(t,q,"mainPlaylistDownloadStateEntity");S=[S,H];H=g.N(y);for(var UP=H.next();!UP.done;UP=H.next())S.push(tJ(t,UP.value,"mainPlaylistVideoEntity"));k&&S.push(tJ(t,k,"ytMainChannelEntity"));return g.Pe.all(S)}),4);
case 4:g.Jx(a,3);break;case 2:throw g.Po(a),nl("PES failure for playlist"),Error("PES failure for playlist");case 3:return a.return({mainPlaylistEntity:d,HMb:k,cIs:y})}})},n_r=function(Y,V){return{id:Y,
channelId:V.channelId,title:V.title,avatar:V.thumbnail}},CNb=function(Y){var V=[],C=Y.videos;
C&&C.length>0&&V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:C[0].offlineVideoData.thumbnail}}});if((Y=Y.additionalMetadadatas)&&Y.length>0)for(Y=g.N(Y),C=Y.next();!C.done;C=Y.next()){var U=C.value.offlineBundleItemPlaylistData,n=void 0;C=(n=U)==null?void 0:n.style;n=void 0;U={collageThumbnail:{coverThumbnail:(n=U)==null?void 0:n.coverThumbnail}};switch(C){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:U});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:U});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:U});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:U})}}return V},UXv=function(Y){switch(Y.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},gfv=function(Y,V,C){V={offlineVideoData:V,
playlistId:C};if(Y=g.I(Y.actionMetadata,HjT))V.maximumDownloadQuality=Y.maximumDownloadQuality;return{mainVideoEntityActionMetadata:V}},b_W=function(Y,V,C){this.Y=Y;
this.zy=V;this.S=C},i_v=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A;
return g.l(function(O){switch(O.J){case 1:return C=XX(V),U=g.nV(V.entityKey),n=U.entityId,b=g.I(V.actionMetadata,gy),y=!((E=b)==null?0:E.playlistId),g.Na(O,2),g.v(O,E_J(Y,n,void 0,(X=b)==null?void 0:X.offlineVideoData,y),4);case 4:g.Jx(O,3);break;case 2:return G=g.Po(O),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.We&&G.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,Z,D));case 3:u=1;u=Number(((B=V.actionMetadata)==null?void 0:B.priority)||0)+1;var k=(k=g.I(V.actionMetadata,gy))?{playbackDataActionMetadata:{maximumDownloadQuality:k.maximumDownloadQuality}}:void 0;A=lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",n,"playbackData",u,zs8,k);return O.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,[A]))}})},yL8=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d;
return g.l(function(c){switch(c.J){case 1:return C=XX(V),U=g.nV(V.entityKey),n=U.entityId,g.v(c,Hn(Y.Y,V.entityKey,"mainVideoEntity"),2);case 2:b=c.Y;if(!b){E=void 0;c.OE(3);break}return g.v(c,Hn(Y.Y,b.downloadState,"mainVideoDownloadStateEntity"),4);case 4:E=c.Y;case 3:y=E;if(!b||!y)return c.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.Na(c,5);return g.v(c,E_J(Y,n,y.addedTimestampMillis,(G=g.I(V.actionMetadata,gy))==null?void 0:G.offlineVideoData),7);case 7:Z=1;Z=Number(((D=
V.actionMetadata)==null?void 0:D.priority)||0)+1;X=lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n,"playbackData",Z,zs8);g.Jx(c,6);break;case 5:u=g.Po(c);if(!(u instanceof Error&&u.message==="No data")){if(u instanceof Error&&u.message==="Empty response body")nl(u.message);else return B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.We&&u.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),c.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,B,A));c.OE(6);break}return g.v(c,q6(Y.Y,n),9);case 9:O=c.Y;k=g.I(V.actionMetadata,gy);if(d=(q=k)==null?void 0:q.playlistId)O.playlistId=d;O.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.v(c,Jk(n,Y.Y,V,Y.S,O),6);case 6:return c.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,X?[X]:void 0))}})},XpL=function(Y,V){var C,U,n,b,E,y,X,G,Z,D;
return g.l(function(u){switch(u.J){case 1:return C=XX(V),g.Na(u,2),U=g.nV(V.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.v(u,tmD(Y.Y,V,Y.S,(Z=V.actionMetadata)==null?void 0:(D=Z.offlineLoggingData)==null?void 0:D.offlineDeleteReason),5):g.v(u,q6(Y.Y,U),6);case 6:n=u.Y;b=g.I(V.actionMetadata,gy);if(y=(E=b)==null?void 0:E.playlistId)n.playlistId=y;n.offlineDeleteReason=(X=V.actionMetadata)==null?void 0:(G=X.offlineLoggingData)==null?void 0:G.offlineDeleteReason;return g.v(u,Jk(U,Y.Y,V,Y.S,n),7);
case 7:if(!Y.zy.K("woffle_enable_main_downloads_library")){u.OE(5);break}return g.v(u,YyA(Y.Y,V.entityKey),5);case 5:g.Jx(u,3);break;case 2:return g.Po(u),u.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return u.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},E_J=function(Y,V,C,U,n){var b,E,y,X,G,Z;
return g.l(function(D){switch(D.J){case 1:if(b=U){D.OE(2);break}return g.v(D,y4L([V]),3);case 3:E=D.Y,b=E[0];case 2:return g.v(D,GbT(Y,b,C,n),4);case 4:y=D.Y;X=y.mainVideoEntity;G=y.channelEntity;g.Na(D,5);var u=Ak(X.thumbnail),B=Ak(G.avatar);return g.v(D,kR(u.concat(B)),7);case 7:g.Jx(D,0);break;case 5:Z=g.Po(D),Z instanceof Error&&Z.message==="Failed to fetch"&&nl(Z.message),g.Wo(D)}})},GbT=function(Y,V,C,U){var n,b,E,y,X,G,Z,D,u,B,A,O,k;
return g.l(function(q){switch(q.J){case 1:C||(C=Date.now().toString());b=(n=V.channel)==null?void 0:n.offlineChannelData;E={id:g.bu(V.videoId,"ytMainChannelEntity"),channelId:b.channelId,title:b.title,avatar:b.thumbnail};y={key:g.bu(V.videoId,"mainVideoDownloadStateEntity"),playbackData:g.bu(V.videoId,"playbackData"),addedTimestampMillis:C,videoDownloadContextEntity:g.bu(V.videoId,"videoDownloadContextEntity")};X={key:g.bu(V.videoId,"videoPlaybackPositionEntity"),videoId:V.videoId,lastPlaybackPositionSeconds:"0"};
Y.zy.K("html5_offline_playback_position_sync")&&(G={playbackPosition:X.key});Z=g.bu(V.videoId,"mainVideoEntity");D={key:Z,videoId:V.videoId,title:V.title,thumbnail:V.thumbnail,localizedStrings:{viewCount:V.shortViewCountText},userState:G,lengthSeconds:V.lengthSeconds?Number(V.lengthSeconds):void 0,publishedTimestampMillis:V.publishedTimestamp?(Number(V.publishedTimestamp)*1E3).toString():void 0,formattedDescription:V.description,owner:E.id,downloadState:y.key};if(!Y.zy.K("woffle_enable_main_downloads_library")||
!U){q.OE(2);break}return g.v(q,KBD(Y.Y,[Z]),3);case 3:if(A=q.Y)u=A.mainDownloadsLibraryEntity,B=A.mainDownloadsListEntity;case 2:return k=T7v,O={key:g.bu(V.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.mu(y,k,O),g.v(q,g3(Y.Y,{mode:"readwrite",cM:!0},function(d){var c=tJ(d,E,"ytMainChannelEntity"),w=tJ(d,y,"mainVideoDownloadStateEntity"),a=tJ(d,D,"mainVideoEntity");c=[c,w,a];Y.zy.K("html5_offline_playback_position_sync")&&(w=tJ(d,X,"videoPlaybackPositionEntity"),
c.push(w));u&&(w=tJ(d,u,"mainDownloadsLibraryEntity"),c.push(w));B&&(w=tJ(d,B,"mainDownloadsListEntity"),c.push(w));O&&(d=tJ(d,O,"downloadStatusEntity"),c.push(d));return g.Pe.all(c)}),4);
case 4:return q.return({mainVideoEntity:D,channelEntity:E})}})},Z_W=function(Y,V,C){this.Y=Y;
this.zy=V;this.S=C},uhL=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F;
return g.l(function(Bo){switch(Bo.J){case 1:return C=XX(V),U=[],g.v(Bo,I7.getInstance(),2);case 2:n=Bo.Y;if(!n){Bo.OE(3);break}return g.v(Bo,n.get("sdois"),4);case 4:return b=Bo.Y,g.v(Bo,(y=n)==null?void 0:y.get("lmqf"),5);case 5:E=Bo.Y;case 3:g.Na(Bo,6);if(b===void 0)throw Error("prefStorage or opt-in state is undefined");X=[];if(b){Bo.OE(8);break}return g.v(Bo,gZR(Y.Y),9);case 9:X=Bo.Y,X.reverse();case 8:if(!X.length){Bo.OE(10);break}G=g.N(X);Z=G.next();case 11:if(Z.done){Bo.OE(10);break}D=Z.value;
if(!D){Bo.OE(12);break}u=g.nV(D).entityId;return g.v(Bo,q6(Y.Y,u),14);case 14:return B=Bo.Y,B.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.v(Bo,Jk(u,Y.Y,{entityKey:D,actionType:V.actionType},Y.S,B),12);case 12:Z=G.next();Bo.OE(11);break;case 10:return g.v(Bo,uOL(b,(A=E)!=null?A:"SD"),16);case 16:return O=Bo.Y,g.v(Bo,eKD(O),17);case 17:k=FBJ(O);if(!Y.zy.K("woffle_enable_main_downloads_library")){Bo.OE(18);break}if(b){Bo.OE(19);break}return g.v(Bo,YyA(Y.Y,g.$z),19);case 19:return g.v(Bo,
H7r(Y.Y,[g.$z]),18);case 18:if((q=k)==null?0:q.length)for(d=g.N(k),c=d.next();!c.done;c=d.next())if(a=w=c.value,t=a.actionType,S=a.entityKey,H=a.actionMetadata,t&&S&&H&&!g.I(H,DXL)){t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(H.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(UP=g.I(w.actionMetadata,gy))UP.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",w.actionMetadata=Object.assign({},w.actionMetadata,{mainVideoEntityActionMetadata:UP});U.push(w)}g.Jx(Bo,
7);break;case 6:return ov=g.Po(Bo),bZ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ov instanceof g.We&&ov.type==="QUOTA_EXCEEDED"&&(bZ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Bo.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,bZ,F));case 7:return Bo.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,U))}})},BnL=function(){eo.apply(this,
arguments);
this.L="mainVideoEntity"},sYJ=function(Y,V,C){V=V===void 0?43200:V;
C=C===void 0?!0:C;var U=U===void 0?!1:U;var n,b,E;return g.l(function(y){switch(y.J){case 1:if(!Y.D.dV())return y.return([]);n=[];g.Na(y,2);return g.v(y,ZKv(V,C,U),4);case 4:n=y.Y;g.Jx(y,3);break;case 2:b=g.Po(y),b instanceof Error&&b.message==="No data"||b instanceof Error&&b.message==="Empty response body"&&nl(b.message);case 3:return E=tjJ(Y,n,C,"mainPlaylistEntity"),y.return(E)}})},ALW=function(Y,V,C,U){U=U===void 0?!1:U;
var n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d;return g.l(function(c){switch(c.J){case 1:return n=[],g.v(c,DWv(),2);case 2:return(b=c.Y)||U?g.v(c,BYA(V,C),3):c.return([]);case 3:E=c.Y;if((y=E)==null||!y.length)return c.return([]);X={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};G=g.N(E);Z=G.next();case 4:if(Z.done){c.OE(6);break}u=D=Z.value;B=u.actionType;A=u.entityKey;O=u.actionMetadata;if(!(B&&A&&O)||g.I(O,DXL)){c.OE(5);break}B==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(O.offlineLoggingData=
X);k=g.nV(A);q=k.entityId;return g.v(c,ry(Y,[q],"mainVideoEntity",B,O),8);case 8:d=c.Y,n=n.concat(d);case 5:Z=G.next();c.OE(4);break;case 6:return c.return(n)}})},Rsb=function(Y,V){this.Y=Y;
this.S=V},NnT=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q;
return g.l(function(d){switch(d.J){case 1:return C=XX(V),U=g.nV(V.entityKey),n=U.entityId,b=[],g.Na(d,2),g.v(d,WEA(Y,n),4);case 4:b=d.Y;if((E=b)==null||!E.length){d.OE(5);break}return g.v(d,nBW(Y.Y,V.entityKey),5);case 5:g.Jx(d,3);break;case 2:return y=g.Po(d),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.We&&y.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
d.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,X,G));case 3:return Z=[],g.v(d,$$L(Y.Y,"musicTrack",b),7);case 7:b=d.Y;if(b.length)for(D=g.N(b),u=D.next();!u.done;u=D.next())if(B=u.value,A=B.offlineVideoData,O=void 0,(O=A)==null?0:O.videoId)k=void 0,q=Number(((k=V.actionMetadata)==null?void 0:k.priority)||0)+1,Z.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A.videoId,"musicTrack",q,Kl,hk(V,A,n)));return d.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,Z))}})},
O_R=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv,xE,qa,US,J,zT,jJ,NH,cv,Gv,Iv,lb,hT,x,h,f,p,L,kE,VK,Ax,C0,hx,FS,kL,OB,wc,KX;
return g.l(function(tH){switch(tH.J){case 1:return C=XX(V),U=V.entityKey,n=g.nV(U).entityId,b=[],E=!1,n==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.v(tH,YR(Y.Y,"musicAlbumRelease"),5)):g.v(tH,Hn(Y.Y,U,"musicAlbumRelease"),4);case 4:(y=tH.Y)&&b.push(y);tH.OE(3);break;case 5:b=tH.Y;case 3:if((X=b)==null||!X.length)return tH.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));if(E){G=[];Z=g.N(b);for(D=Z.next();!D.done;D=Z.next())u=D.value,B=g.nV(u.id).entityId,G.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
B,"musicAlbumRelease",0,Kl));return tH.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,G))}A=[];O=b[0];k=void 0;if(!O.downloadMetadata){tH.OE(6);break}return g.v(tH,Hn(Y.Y,O.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:q=tH.Y,k=Number((c=(d=q)==null?void 0:d.addedTimestampMillis)!=null?c:"0")/1E3;case 6:return g.Na(tH,8),g.v(tH,WEA(Y,n,(w=k)==null?void 0:w.toString()),10);case 10:A=tH.Y;g.Jx(tH,9);break;case 8:a=g.Po(tH);if(!(a instanceof Error&&a.message===
"No data")){if(a instanceof Error&&a.message==="Empty response body")nl(a.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.We&&a.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tH.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,t,S));tH.OE(9);break}return g.v(tH,xR(n,"musicAlbumRelease",Y.Y,
V,Y.S),9);case 9:H=[];UP=new Map;if((ov=A)==null?0:ov.length)for(bZ=g.N(A),F=bZ.next();!F.done;F=bZ.next())Bo=F.value,dH=Bo.offlineVideoData,lZ=void 0,((lZ=dH)==null?0:lZ.videoId)&&UP.set(dH.videoId,dH);Wv=new Map;zv=[];if((xE=O)==null?0:(qa=xE.tracks)==null?0:qa.length)for(US=g.N(O.tracks),J=US.next();!J.done;J=US.next())if(zT=J.value,jJ=g.nV(zT).entityId)UP.has(jJ)?(Wv.set(jJ,UP.get(jJ)),UP.delete(jJ)):zv.push(jJ);cv=Number(((NH=V.actionMetadata)==null?void 0:NH.priority)||0)+1;Gv=g.N(UP.entries());
for(Iv=Gv.next();!Iv.done;Iv=Gv.next())lb=Iv.value,hT=g.N(lb),x=hT.next().value,h=hT.next().value,f=x,p=h,H.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",f,"musicTrack",cv,Kl,hk(V,p)));L=g.N(Wv.entries());for(kE=L.next();!kE.done;kE=L.next())VK=kE.value,Ax=g.N(VK),C0=Ax.next().value,hx=Ax.next().value,FS=C0,kL=hx,H.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",FS,"musicTrack",cv,Kl,hk(V,kL)));OB=g.N(zv);for(wc=OB.next();!wc.done;wc=OB.next())KX=wc.value,H.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
KX,"musicTrack",0,Kl));return tH.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,H))}})},kbN=function(Y,V){var C,U;
return g.l(function(n){switch(n.J){case 1:return C=XX(V),g.Na(n,2),U=g.nV(V.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.v(n,cT(Y.Y,V,Y.S),5):g.v(n,xR(U,"musicAlbumRelease",Y.Y,V,Y.S),6);case 6:return g.v(n,bKv(Y.Y,V.entityKey),5);case 5:g.Jx(n,3);break;case 2:return g.Po(n),n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},WEA=function(Y,V,C){var U,n,b;
return g.l(function(E){switch(E.J){case 1:return g.v(E,XhD([V]),2);case 2:return U=E.Y,g.v(E,JLS(Y,U[0],C),3);case 3:return n=E.Y,b=Ak(n.thumbnailDetails),g.v(E,kR(b),4);case 4:return E.return(U[0].videos)}})},JLS=function(Y,V,C){var U,n,b,E,y,X,G,Z,D,u,B,A,O,k;
return g.l(function(q){if(q.J==1){U=V.additionalMetadadatas;n=void 0;if(U&&U.length>0)for(b=g.N(U),E=b.next();!E.done;E=b.next())if(y=E.value,y.offlineMusicPlaylistData){n=y.offlineMusicPlaylistData;break}X=V.playlistId;G=EBW(V);Z=G.Ev;D=G.oB;u=C?(Number(C)*1E3).toString():Date.now().toString();B=V.lastModifiedTimestamp?(Number(V.lastModifiedTimestamp)*1E3).toString():"0";A={id:g.bu(X,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:D,lastModifiedTimestampMillis:B,addedTimestampMillis:u,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};O={id:g.bu(X,"musicAlbumRelease"),title:V.title,audioPlaylistId:X,trackCount:V.totalVideoCount,tracks:Z,downloadMetadata:A.id};n&&(O.thumbnailDetails=(k=n.albumHqThumbnail)!=null?k:n.albumArtistThumbnail,O.artistDisplayName=n.albumArtistDisplayName,O.releaseDate=n.albumReleaseDate,O.contentRating={explicitType:n.albumReleaseExplicitType},O.releaseType=n.albumReleaseType);return g.v(q,g3(Y.Y,{mode:"readwrite",cM:!0},function(d){var c=tJ(d,O,"musicAlbumRelease");
d=tJ(d,A,"musicAlbumReleaseDownloadMetadataEntity");return g.Pe.all([c,d])}),2)}return q.return(O)})},dXD=function(Y,V){this.Y=Y;
this.S=V},PNJ=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q;
return g.l(function(d){switch(d.J){case 1:return C=XX(V),U=g.nV(V.entityKey),n=U.entityId,b=[],g.Na(d,2),g.v(d,qvW(Y,n),4);case 4:b=d.Y;if((E=b)==null||!E.length){d.OE(5);break}return g.v(d,nBW(Y.Y,V.entityKey),5);case 5:g.Jx(d,3);break;case 2:return y=g.Po(d),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.We&&y.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
d.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,X,G));case 3:return Z=[],g.v(d,$$L(Y.Y,"musicTrack",b),7);case 7:b=d.Y;if(b.length)for(D=g.N(b),u=D.next();!u.done;u=D.next())if(B=u.value,A=B.offlineVideoData,O=void 0,(O=A)==null?0:O.videoId)k=void 0,q=Number(((k=V.actionMetadata)==null?void 0:k.priority)||0)+1,Z.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A.videoId,"musicTrack",q,HT,hk(V,A,n)));return d.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,Z))}})},
xXW=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv,xE,qa,US,J,zT,jJ,NH,cv,Gv,Iv,lb,hT,x,h,f,p,L,kE,VK,Ax,C0,hx,FS,kL,OB,wc,KX,tH,HF,k7,u2,TY,Rg,$K,rD,Fg,he,bo,YK;
return g.l(function(b$){switch(b$.J){case 1:return C=XX(V),U=V.entityKey,n=g.nV(U).entityId,b=[],E=!1,n==="!*$_ALL_ENTITIES_!*$"?(E=!0,g.v(b$,YR(Y.Y,"musicPlaylist"),5)):g.v(b$,Hn(Y.Y,U,"musicPlaylist"),4);case 4:(y=b$.Y)&&b.push(y);b$.OE(3);break;case 5:b=b$.Y;case 3:if((X=b)==null||!X.length)return b$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));G=g.I(V.actionMetadata,z3N);D=(Z=G)==null?void 0:Z.autoSync;u=[];A=B=!0;O=!1;k=void 0;if(!E&&D===!1){b$.OE(6);break}g.Na(b$,7);return g.v(b$,
s5J(0,!!D,!0,b),9);case 9:u=b$.Y;g.Jx(b$,8);break;case 7:q=g.Po(b$);if(!(q instanceof Error&&q.message==="No data")){q instanceof Error&&q.message==="Empty response body"&&nl(q.message);b$.OE(8);break}return n==="!*$_ALL_ENTITIES_!*$"?g.v(b$,cT(Y.Y,V,Y.S),8):g.v(b$,xR(n,"musicPlaylist",Y.Y,V,Y.S),8);case 8:if(!u.length||!E&&u[0].playlistId!==n)return b$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));case 6:if(E){d=[];c=g.N(u);for(w=c.next();!w.done;w=c.next())a=w.value,a.upToDate||
D&&!a.shouldAutoSyncMetadata||!a.playlistId||(t={autoSync:D},d.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",a.playlistId,"musicPlaylist",0,HT,{musicPlaylistEntityActionMetadata:t})));return b$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,d))}u.length&&(S=u[0],O=!!S.upToDate,D&&(B=(H=S.shouldAutoSyncMetadata)!=null?H:!0,A=(UP=S.shouldAutoSyncVideos)!=null?UP:!0,S.checkInSeconds&&(k=S.checkInSeconds)));if(O||!B)return b$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C));ov=[];bZ=b[0];F=void 0;if(!bZ.downloadMetadata){b$.OE(15);break}return g.v(b$,Hn(Y.Y,bZ.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Bo=b$.Y,F=Number((lZ=(dH=Bo)==null?void 0:dH.addedTimestampMillis)!=null?lZ:"0")/1E3;case 15:return g.Na(b$,17),g.v(b$,qvW(Y,n,(Wv=F)==null?void 0:Wv.toString(),k),19);case 19:ov=b$.Y;g.Jx(b$,18);break;case 17:zv=g.Po(b$);if(!(zv instanceof Error&&zv.message==="No data")){if(zv instanceof Error&&zv.message==="Empty response body")nl(zv.message);
else return xE="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",qa="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",zv instanceof g.We&&zv.type==="QUOTA_EXCEEDED"&&(xE="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",qa="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),b$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,xE,qa));b$.OE(18);break}return g.v(b$,xR(n,"musicPlaylist",Y.Y,V,Y.S),18);case 18:if(!A)return b$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C));US=[];J=new Map;if((zT=ov)==null?0:zT.length)for(jJ=g.N(ov),NH=jJ.next();!NH.done;NH=jJ.next())cv=NH.value,Gv=cv.offlineVideoData,Iv=void 0,((Iv=Gv)==null?0:Iv.videoId)&&J.set(Gv.videoId,Gv);lb=new Map;hT=[];if((x=bZ)==null?0:(h=x.tracks)==null?0:h.length)for(f=g.N(bZ.tracks),p=f.next();!p.done;p=f.next())if(L=p.value,kE=g.nV(L).entityId)J.has(kE)?(lb.set(kE,J.get(kE)),J.delete(kE)):hT.push(kE);Ax=Number(((VK=V.actionMetadata)==null?void 0:VK.priority)||0)+1;C0=g.N(J.entries());for(hx=C0.next();!hx.done;hx=
C0.next())FS=hx.value,kL=g.N(FS),OB=kL.next().value,wc=kL.next().value,KX=OB,tH=wc,US.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",KX,"musicTrack",Ax,HT,hk(V,tH)));HF=g.N(lb.entries());for(k7=HF.next();!k7.done;k7=HF.next())u2=k7.value,TY=g.N(u2),Rg=TY.next().value,$K=TY.next().value,rD=Rg,Fg=$K,US.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",rD,"musicTrack",Ax,HT,hk(V,Fg)));he=g.N(hT);for(bo=he.next();!bo.done;bo=he.next())YK=bo.value,US.push(lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
YK,"musicTrack",0,HT));return b$.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,US))}})},cLA=function(Y,V){var C,U;
return g.l(function(n){switch(n.J){case 1:return C=XX(V),g.Na(n,2),U=g.nV(V.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.v(n,cT(Y.Y,V,Y.S),5):g.v(n,xR(U,"musicPlaylist",Y.Y,V,Y.S),6);case 6:return g.v(n,bKv(Y.Y,V.entityKey),5);case 5:g.Jx(n,3);break;case 2:return g.Po(n),n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},qvW=function(Y,V,C,U){var n,b,E;
return g.l(function(y){switch(y.J){case 1:return g.v(y,XhD([V]),2);case 2:return n=y.Y,g.v(y,hsS(Y,n[0],C,U),3);case 3:return b=y.Y,E=Ak(b.thumbnailDetails),g.v(y,kR(E),4);case 4:return y.return(n[0].videos)}})},hsS=function(Y,V,C,U){var n,b,E,y,X,G,Z,D,u;
return g.l(function(B){return B.J==1?(n=V.playlistId,b=EBW(V),E=b.Ev,y=b.oB,X=C?(Number(C)*1E3).toString():Date.now().toString(),G=V.lastModifiedTimestamp?(Number(V.lastModifiedTimestamp)*1E3).toString():"0",Z={id:g.bu(n,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:y,lastModifiedTimestampMillis:G,addedTimestampMillis:X,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},D={id:g.bu(n,"musicPlaylist"),title:V.title,playlistId:n,thumbnailDetails:V.thumbnail,visibility:fBJ(V),trackCount:V.totalVideoCount,
tracks:E,downloadMetadata:Z.id},U&&(((u=D)==null?0:u.entityMetadata)?D.entityMetadata.nextAutoRefreshIntervalSeconds=String(U):D&&(D.entityMetadata={nextAutoRefreshIntervalSeconds:String(U)})),g.v(B,g3(Y.Y,{mode:"readwrite",cM:!0},function(A){var O=tJ(A,D,"musicPlaylist");A=tJ(A,Z,"musicPlaylistDownloadMetadataEntity");return g.Pe.all([O,A])}),2)):B.return(D)})},fBJ=function(Y){switch(Y.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},v_8=function(Y,V){this.Y=Y;
this.S=V},TnA=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A;
return g.l(function(O){switch(O.J){case 1:return C=XX(V),U=g.nV(V.entityKey),n=U.entityId,b=g.I(V.actionMetadata,wp8),g.Na(O,2),g.v(O,lBR(Y,n,void 0,(E=b)==null?void 0:E.track,(y=b)==null?void 0:y.albumRelease),4);case 4:if((X=b)==null?0:X.playlistId){O.OE(5);break}return g.v(O,nBW(Y.Y,V.entityKey),5);case 5:g.Jx(O,3);break;case 2:return G=g.Po(O),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.We&&G.type==="QUOTA_EXCEEDED"&&
(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),O.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,Z,D));case 3:B=Number(((u=V.actionMetadata)==null?void 0:u.priority)||0)+1;var k=(k=g.I(V.actionMetadata,wp8))?{playbackDataActionMetadata:{maximumDownloadQuality:k.maximumDownloadQuality}}:void 0;A=lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",n,"playbackData",B,ppD,k);return O.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C,[A]))}})},$X8=function(Y,V){var C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k;
return g.l(function(q){switch(q.J){case 1:return C=XX(V),U=g.nV(V.entityKey),n=U.entityId,g.v(q,Hn(Y.Y,V.entityKey,"musicTrack"),2);case 2:b=q.Y;if(!b){E=void 0;q.OE(3);break}return g.v(q,Hn(Y.Y,b.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:E=q.Y;case 3:y=E;if(!b||!y)return q.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));G=g.I(V.actionMetadata,wp8);g.Na(q,5);return g.v(q,lBR(Y,n,y.addedTimestampMillis,(Z=G)==null?void 0:Z.track,(D=G)==null?void 0:D.albumRelease),
7);case 7:B=Number(((u=V.actionMetadata)==null?void 0:u.priority)||0)+1;X=lt("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n,"playbackData",B,ppD);g.Jx(q,6);break;case 5:A=g.Po(q);if(!(A instanceof Error&&A.message==="No data")){if(A instanceof Error&&A.message==="Empty response body")nl(A.message);else return O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",A instanceof g.We&&A.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),q.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,O,k));q.OE(6);break}return g.v(q,PT(n,Y.Y,V,Y.S),6);case 6:return q.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,X?[X]:void 0))}})},Myb=function(Y,V){var C,U;
return g.l(function(n){switch(n.J){case 1:return C=XX(V),g.Na(n,2),U=g.nV(V.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.v(n,cT(Y.Y,V,Y.S),5):g.v(n,PT(U,Y.Y,V,Y.S),6);case 6:return g.v(n,bKv(Y.Y,V.entityKey),5);case 5:g.Jx(n,3);break;case 2:return g.Po(n),n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new pl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},lBR=function(Y,V,C,U,n){var b,E,y,X,G,Z;
return g.l(function(D){switch(D.J){case 1:if(b=U){D.OE(2);break}return g.v(D,y4L([V]),3);case 3:E=D.Y,y=E[0],b=UWL(y);case 2:return g.v(D,aBD(Y,b,V,n,C),4);case 4:X=D.Y;G=X.musicTrackEntity;Z=X.Ge;var u=Ak(G.thumbnailDetails),B=[];Z&&(B=Ak(Z.thumbnailDetails));return g.v(D,kR(u.concat(B)),0)}})},aBD=function(Y,V,C,U,n){var b;
return g.l(function(E){return E.J==1?(n||(n=Date.now().toString()),b={id:g.bu(C,"musicTrackDownloadMetadataEntity"),playbackData:g.bu(C,"playbackData"),addedTimestampMillis:n,videoDownloadContextEntity:g.bu(C,"videoDownloadContextEntity")},U&&(V.albumRelease=U.id),g.v(E,g3(Y.Y,{mode:"readwrite",cM:!0},function(y){var X=[],G=tJ(y,b,"musicTrackDownloadMetadataEntity");X.push(G);G=tJ(y,V,"musicTrack");X.push(G);U&&(y=tJ(y,U,"musicAlbumRelease"),X.push(y));return g.Pe.all(X)}),2)):E.J!=3?g.v(E,ut(C,"musicTrackDownloadMetadataEntity",
Y.Y,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):E.return({musicTrackEntity:V,
Ge:U})})},YY=function(){eo.apply(this,arguments);
this.L="musicTrack"},IBA=function(Y,V,C){V=V===void 0?43200:V;
C=C===void 0?!0:C;var U=U===void 0?!1:U;var n,b;return g.l(function(E){switch(E.J){case 1:if(!Y.D.dV())return E.return([]);n=[];g.Na(E,2);return g.v(E,s5J(V,C,U),4);case 4:n=E.Y;g.Jx(E,3);break;case 2:g.Po(E);case 3:return b=tjJ(Y,n,C,"musicPlaylist"),E.return(b)}})},LER=function(){g.NG.apply(this,arguments);
var Y=this;this.events=new g.QI(this);this.zy=this.player.U();this.BC={J1x:function(){return Y.Y},
fz:function(){return Y.fz()},
jy:function(V){return Y.jy(V)}}},QYD=function(Y){var V;
Y=g.I((V=Y.getWatchNextResponse())==null?void 0:V.currentVideoEndpoint,g.bO);if(Y==null?0:Y.playlistId)var C=Y.playlistId;return C},Svv=function(Y,V){var C,U,n,b;
return g.l(function(E){if(E.J==1){C=V.clientPlaybackNonce;U={cpn:C,offlineSourceVisualElement:g.qR(V.eL||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};V.J&&(U.videoFmt=Number(V.J.itag));V.W&&(U.audioFmt=Number(V.W.itag));if((n=QYD(V))&&V.videoId){var y=V.videoId;y=n!=="PPSV"?Promise.resolve(!1):Y.Y.Oj(y);E=g.v(E,y,3)}else E=E.OE(2);return E}E.J!=2&&(b=E.Y)&&(U.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");Y.J=C;g.ZX("offlinePlaybackStarted",U);g.Wo(E)})};
g.vd.prototype.Ze=g.n0(51,function(Y){return this.app.Ze(Y)});
g.Rs.prototype.Ze=g.n0(50,function(Y){return g.EYR(this,9,Y)});
g.W(Ml,$M);g.EP.Object.defineProperties(Ml.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.Y.entityMetadata},
set:function(Y){this.Y.entityMetadata=Y}}});
g.W(lLL,Ml);lLL.prototype.J=function(){return[]};
g.W(pHR,Ml);pHR.prototype.J=function(){return[]};
g.W(TD8,Ml);TD8.prototype.J=function(){return[]};
g.W($7A,Ml);$7A.prototype.J=function(){return[]};
g.W(M08,Ml);M08.prototype.J=function(){var Y=[];this.Y.alternateChannel&&Y.push(this.Y.alternateChannel);this.Y.alternateChannelList&&Y.push.apply(Y,g.P(this.Y.alternateChannelList));this.Y.oneofChannelEntity&&Y.push(this.Y.oneofChannelEntity);return[].concat(g.P(new Set(Y)))};
g.W(aLD,Ml);aLD.prototype.J=function(){var Y=[];this.Y.entryCollection&&Y.push(this.Y.entryCollection);return[].concat(g.P(new Set(Y)))};
g.W(ILA,$M);ILA.prototype.J=function(){var Y=[];this.Y.video&&Y.push(this.Y.video);return[].concat(g.P(new Set(Y)))};
g.W(L8L,Ml);L8L.prototype.J=function(){var Y=[];this.Y.parentPlaylist&&Y.push(this.Y.parentPlaylist);if(this.Y.entries)for(var V=g.N(this.Y.entries),C=V.next();!C.done;C=V.next())Y.push.apply(Y,g.P((new ILA(C.value)).J()));return[].concat(g.P(new Set(Y)))};
g.W(QmD,Ml);QmD.prototype.J=function(){var Y=[];this.Y.descriptionEntity&&Y.push(this.Y.descriptionEntity);this.Y.creators&&Y.push.apply(Y,g.P(this.Y.creators));this.Y.theBiggestFan&&Y.push(this.Y.theBiggestFan);return[].concat(g.P(new Set(Y)))};
g.W(SLr,Ml);SLr.prototype.J=function(){return[]};
g.W(m7W,Ml);m7W.prototype.J=function(){return[]};
g.W(jmL,Ml);jmL.prototype.J=function(){return[]};
g.W(t0D,Ml);t0D.prototype.J=function(){return[]};
g.W(eyr,Ml);eyr.prototype.J=function(){return[]};
g.W(rGL,Ml);rGL.prototype.J=function(){return[]};
g.W(F8J,Ml);F8J.prototype.J=function(){return[]};
g.W(gHN,Ml);gHN.prototype.J=function(){return[]};
g.W(K8S,Ml);K8S.prototype.J=function(){return[]};
g.W(HEr,Ml);HEr.prototype.J=function(){var Y=[];this.Y.downloadsList&&Y.push(this.Y.downloadsList);this.Y.smartDownloadsList&&Y.push(this.Y.smartDownloadsList);this.Y.recommendedDownloadsList&&Y.push(this.Y.recommendedDownloadsList);this.Y.refresh&&Y.push(this.Y.refresh);return[].concat(g.P(new Set(Y)))};
g.W(YaJ,$M);YaJ.prototype.J=function(){var Y=[];this.Y.video&&Y.push(this.Y.video);this.Y.playlist&&Y.push(this.Y.playlist);this.Y.videoItem&&Y.push(this.Y.videoItem);this.Y.playlistItem&&Y.push(this.Y.playlistItem);return[].concat(g.P(new Set(Y)))};
g.W(oPr,Ml);oPr.prototype.J=function(){var Y=[];this.Y.refresh&&Y.push(this.Y.refresh);if(this.Y.downloads)for(var V=g.N(this.Y.downloads),C=V.next();!C.done;C=V.next())Y.push.apply(Y,g.P((new YaJ(C.value)).J()));return[].concat(g.P(new Set(Y)))};
g.W(VSL,Ml);VSL.prototype.J=function(){var Y=[];this.Y.localImageEntities&&Y.push.apply(Y,g.P(this.Y.localImageEntities));return[].concat(g.P(new Set(Y)))};
g.W(CUL,Ml);CUL.prototype.J=function(){var Y=[];this.Y.playbackData&&Y.push(this.Y.playbackData);this.Y.localImageEntities&&Y.push.apply(Y,g.P(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&Y.push(this.Y.videoDownloadContextEntity);return[].concat(g.P(new Set(Y)))};
g.W(Uhr,Ml);Uhr.prototype.J=function(){return[]};
g.W(nPJ,Ml);nPJ.prototype.J=function(){var Y=[];this.Y.fakeChildren&&Y.push.apply(Y,g.P(this.Y.fakeChildren));return[].concat(g.P(new Set(Y)))};
g.W(bgA,Ml);bgA.prototype.J=function(){var Y=[];this.Y.video&&Y.push(this.Y.video);this.Y.playbackData&&Y.push(this.Y.playbackData);this.Y.offlineVideoPolicy&&Y.push(this.Y.offlineVideoPolicy);return[].concat(g.P(new Set(Y)))};
g.W(EPW,Ml);EPW.prototype.J=function(){return[]};
g.W(zXL,Ml);zXL.prototype.J=function(){var Y=[];this.Y.channelOwner&&Y.push(this.Y.channelOwner);this.Y.videos&&Y.push.apply(Y,g.P(this.Y.videos));this.Y.collaboratorChannels&&Y.push.apply(Y,g.P(this.Y.collaboratorChannels));this.Y.downloadState&&Y.push(this.Y.downloadState);this.Y.refresh&&Y.push(this.Y.refresh);return[].concat(g.P(new Set(Y)))};
g.W(igN,Ml);igN.prototype.J=function(){var Y=[];this.Y.video&&Y.push(this.Y.video);this.Y.channelContributor&&Y.push(this.Y.channelContributor);return[].concat(g.P(new Set(Y)))};
g.W(yuT,$M);yuT.prototype.J=function(){var Y=[];this.Y.localImageEntities&&Y.push.apply(Y,g.P(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&Y.push(this.Y.videoDownloadContextEntity);return[].concat(g.P(new Set(Y)))};
g.W(XNT,$M);XNT.prototype.J=function(){var Y=[];this.Y.recommendedVideoMetadata&&Y.push.apply(Y,g.P((new yuT(this.Y.recommendedVideoMetadata)).J()));return[].concat(g.P(new Set(Y)))};
g.W(GDv,$M);GDv.prototype.J=function(){var Y=[];this.Y.playbackPosition&&Y.push(this.Y.playbackPosition);return[].concat(g.P(new Set(Y)))};
g.W(ZgD,Ml);ZgD.prototype.J=function(){var Y=[];this.Y.owner&&Y.push(this.Y.owner);this.Y.downloadState&&Y.push(this.Y.downloadState);this.Y.userState&&Y.push.apply(Y,g.P((new GDv(this.Y.userState)).J()));this.Y.additionalMetadata&&Y.push.apply(Y,g.P((new XNT(this.Y.additionalMetadata)).J()));return[].concat(g.P(new Set(Y)))};
g.W(Dhb,Ml);Dhb.prototype.J=function(){var Y=[];this.Y.userChannelDetails&&Y.push(this.Y.userChannelDetails);return[].concat(g.P(new Set(Y)))};
g.W(u0N,Ml);u0N.prototype.J=function(){var Y=[];this.Y.channelOwner&&Y.push(this.Y.channelOwner);this.Y.playbackPosition&&Y.push(this.Y.playbackPosition);this.Y.localImageEntities&&Y.push.apply(Y,g.P(this.Y.localImageEntities));this.Y.downloadStatus&&Y.push(this.Y.downloadStatus);return[].concat(g.P(new Set(Y)))};
g.W(BTN,Ml);BTN.prototype.J=function(){return[]};
g.W(sov,Ml);sov.prototype.J=function(){return[]};
g.W(AuD,Ml);AuD.prototype.J=function(){return[]};
g.W(RXR,Ml);RXR.prototype.J=function(){return[]};
g.W(WoL,Ml);WoL.prototype.J=function(){return[]};
g.W(NTN,Ml);NTN.prototype.J=function(){return[]};
g.W(OgL,Ml);OgL.prototype.J=function(){return[]};
g.W(kDA,Ml);kDA.prototype.J=function(){return[]};
g.W(Jub,Ml);Jub.prototype.J=function(){return[]};
g.W(dhv,Ml);dhv.prototype.J=function(){return[]};
g.W(qaJ,Ml);qaJ.prototype.J=function(){return[]};
g.W(PUT,Ml);PUT.prototype.J=function(){var Y=[];this.Y.trackDownloadMetadatas&&Y.push.apply(Y,g.P(this.Y.trackDownloadMetadatas));return[].concat(g.P(new Set(Y)))};
g.W(xhv,Ml);
xhv.prototype.J=function(){var Y=[];this.Y.downloadedTracks&&Y.push.apply(Y,g.P(this.Y.downloadedTracks));this.Y.smartDownloadedTracks&&Y.push.apply(Y,g.P(this.Y.smartDownloadedTracks));this.Y.downloadedEpisodes&&Y.push.apply(Y,g.P(this.Y.downloadedEpisodes));this.Y.downloadedAlbumReleases&&Y.push.apply(Y,g.P(this.Y.downloadedAlbumReleases));this.Y.smartDownloadedAlbumReleases&&Y.push.apply(Y,g.P(this.Y.smartDownloadedAlbumReleases));this.Y.downloadedPlaylists&&Y.push.apply(Y,g.P(this.Y.downloadedPlaylists));this.Y.smartDownloadedPlaylists&&
Y.push.apply(Y,g.P(this.Y.smartDownloadedPlaylists));this.Y.metadataOnlyTracks&&Y.push.apply(Y,g.P(this.Y.metadataOnlyTracks));return[].concat(g.P(new Set(Y)))};
g.W(cub,Ml);cub.prototype.J=function(){var Y=[];this.Y.trackDownloadMetadatas&&Y.push.apply(Y,g.P(this.Y.trackDownloadMetadatas));return[].concat(g.P(new Set(Y)))};
g.W(hXS,Ml);hXS.prototype.J=function(){var Y=[];this.Y.playbackData&&Y.push(this.Y.playbackData);this.Y.localImageEntities&&Y.push.apply(Y,g.P(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&Y.push(this.Y.videoDownloadContextEntity);return[].concat(g.P(new Set(Y)))};
g.W(fuL,Ml);fuL.prototype.J=function(){var Y=[];this.Y.musicLibraryStatusEntity&&Y.push(this.Y.musicLibraryStatusEntity);this.Y.primaryArtists&&Y.push.apply(Y,g.P(this.Y.primaryArtists));this.Y.details&&Y.push(this.Y.details);this.Y.userDetails&&Y.push(this.Y.userDetails);this.Y.tracks&&Y.push.apply(Y,g.P(this.Y.tracks));this.Y.share&&Y.push(this.Y.share);this.Y.downloadMetadata&&Y.push(this.Y.downloadMetadata);this.Y.refresh&&Y.push(this.Y.refresh);return[].concat(g.P(new Set(Y)))};
g.W(vPr,Ml);vPr.prototype.J=function(){var Y=[];this.Y.albumRelease&&Y.push(this.Y.albumRelease);this.Y.tracks&&Y.push.apply(Y,g.P(this.Y.tracks));return[].concat(g.P(new Set(Y)))};
g.W(wNL,Ml);wNL.prototype.J=function(){var Y=[];this.Y.albumRelease&&Y.push(this.Y.albumRelease);return[].concat(g.P(new Set(Y)))};
g.W(lu8,Ml);lu8.prototype.J=function(){var Y=[];this.Y.details&&Y.push(this.Y.details);this.Y.userDetails&&Y.push(this.Y.userDetails);return[].concat(g.P(new Set(Y)))};
g.W(pNN,Ml);pNN.prototype.J=function(){var Y=[];this.Y.parentArtist&&Y.push(this.Y.parentArtist);return[].concat(g.P(new Set(Y)))};
g.W(TTR,Ml);TTR.prototype.J=function(){var Y=[];this.Y.parentArtist&&Y.push(this.Y.parentArtist);return[].concat(g.P(new Set(Y)))};
g.W($hL,Ml);$hL.prototype.J=function(){return[]};
g.W(MSD,Ml);MSD.prototype.J=function(){return[]};
g.W(auJ,$M);auJ.prototype.J=function(){var Y=[];this.Y.creatorEntity&&Y.push(this.Y.creatorEntity);return[].concat(g.P(new Set(Y)))};
g.W(IuW,Ml);
IuW.prototype.J=function(){var Y=[];this.Y.tracks&&Y.push.apply(Y,g.P(this.Y.tracks));this.Y.refresh&&Y.push(this.Y.refresh);this.Y.musicLibraryStatusEntity&&Y.push(this.Y.musicLibraryStatusEntity);this.Y.details&&Y.push(this.Y.details);this.Y.downloadMetadata&&Y.push(this.Y.downloadMetadata);this.Y.sideloadMetadata&&Y.push(this.Y.sideloadMetadata);this.Y.userDetails&&Y.push(this.Y.userDetails);this.Y.entryCollection&&Y.push(this.Y.entryCollection);this.Y.share&&Y.push(this.Y.share);this.Y.podcastShowAdditionalMetadata&&Y.push.apply(Y,
g.P((new auJ(this.Y.podcastShowAdditionalMetadata)).J()));return[].concat(g.P(new Set(Y)))};
g.W(LoD,Ml);LoD.prototype.J=function(){return[]};
g.W(QoD,Ml);
QoD.prototype.J=function(){var Y=[];this.Y.musicLibraryStatusEntity&&Y.push(this.Y.musicLibraryStatusEntity);this.Y.artists&&Y.push.apply(Y,g.P(this.Y.artists));this.Y.audioModeVersion&&Y.push(this.Y.audioModeVersion);this.Y.videoModeVersion&&Y.push(this.Y.videoModeVersion);this.Y.userDetails&&Y.push(this.Y.userDetails);this.Y.details&&Y.push(this.Y.details);this.Y.albumRelease&&Y.push(this.Y.albumRelease);this.Y.share&&Y.push(this.Y.share);this.Y.libraryEdit&&Y.push(this.Y.libraryEdit);this.Y.downloadMetadata&&
Y.push(this.Y.downloadMetadata);this.Y.playbackPosition&&Y.push(this.Y.playbackPosition);this.Y.lyrics&&Y.push(this.Y.lyrics);return[].concat(g.P(new Set(Y)))};
g.W(SaD,Ml);SaD.prototype.J=function(){var Y=[];this.Y.parentTrack&&Y.push(this.Y.parentTrack);return[].concat(g.P(new Set(Y)))};
g.W(mhS,Ml);mhS.prototype.J=function(){var Y=[];this.Y.parentTrack&&Y.push(this.Y.parentTrack);return[].concat(g.P(new Set(Y)))};
g.W(joT,Ml);joT.prototype.J=function(){return[]};
g.W(tSL,Ml);tSL.prototype.J=function(){return[]};
g.W(eXv,Ml);eXv.prototype.J=function(){return[]};
g.W(ruA,Ml);ruA.prototype.J=function(){return[]};
g.W(Fob,Ml);Fob.prototype.J=function(){var Y=[];this.Y.transfer&&Y.push(this.Y.transfer);this.Y.adsPlaybackData&&Y.push.apply(Y,g.P(this.Y.adsPlaybackData));this.Y.drmLicense&&Y.push(this.Y.drmLicense);this.Y.offlineVideoPolicy&&Y.push(this.Y.offlineVideoPolicy);this.Y.videoDownloadContextEntity&&Y.push(this.Y.videoDownloadContextEntity);return[].concat(g.P(new Set(Y)))};
g.W(gPb,Ml);gPb.prototype.J=function(){return[]};
g.W(KoJ,Ml);KoJ.prototype.J=function(){var Y=[];this.Y.offlineVideoStreams&&Y.push.apply(Y,g.P(this.Y.offlineVideoStreams));this.Y.captionTrack&&Y.push.apply(Y,g.P(this.Y.captionTrack));return[].concat(g.P(new Set(Y)))};
g.W(Hgv,Ml);Hgv.prototype.J=function(){return[]};
g.W(Y6L,Ml);Y6L.prototype.J=function(){return[]};
g.W(obb,Ml);obb.prototype.J=function(){return[]};
g.W(V_L,Ml);V_L.prototype.J=function(){return[]};
g.W(Cdr,Ml);Cdr.prototype.J=function(){return[]};
g.W(UoA,Ml);UoA.prototype.J=function(){return[]};
g.W(nbb,Ml);nbb.prototype.J=function(){return[]};
g.W(b1v,Ml);b1v.prototype.J=function(){return[]};
g.W(EbL,Ml);EbL.prototype.J=function(){return[]};
g.W(z6S,Ml);z6S.prototype.J=function(){return[]};
g.W(i1T,Ml);i1T.prototype.J=function(){return[]};
g.W(yA8,Ml);yA8.prototype.J=function(){return[]};
g.W(XrW,Ml);XrW.prototype.J=function(){return[]};
g.W(GKN,Ml);GKN.prototype.J=function(){return[]};
g.W(Z1r,Ml);Z1r.prototype.J=function(){return[]};
g.W(DoL,Ml);DoL.prototype.J=function(){return[]};
g.W(utL,Ml);utL.prototype.J=function(){return[]};
g.W(BrL,Ml);BrL.prototype.J=function(){return[]};
g.W(sA8,Ml);sA8.prototype.J=function(){return[]};
g.W(AAD,Ml);AAD.prototype.J=function(){return[]};
g.W(R6b,Ml);R6b.prototype.J=function(){return[]};
var A4b=["browse","music/browse","unplugged/browse"],knR=["offline/playlist_sync_check"],iKJ=["offline"],R3v=["offline/offline_video_playback_position_sync"],NYL=["offline/get_playback_data_entity"],a7;I7.getInstance=function(){return g.l(function(Y){return Y.return(new Promise(function(V){g.oU().then(function(C){C?(I7.instance||(I7.instance=new I7(C)),V(I7.instance)):V(void 0)})}))})};
I7.prototype.get=function(Y){var V=this,C,U,n;return g.l(function(b){if(b.J==1)return g.v(b,kKb(V.token),2);if(b.J!=3)return C=b.Y,g.v(b,C.get("prefs",Y),3);U=b.Y;if(!U)return b.return();n=(0,g.Q)();return U.expirationTimestampMs<=n?b.return():b.return(U.value)})};
I7.prototype.set=function(Y,V,C){C=C===void 0?31536E3:C;var U=this,n,b,E;return g.l(function(y){if(y.J==1)return n=(0,g.Q)(),b={key:Y,value:V,expirationTimestampMs:n+C*1E3},g.v(y,kKb(U.token),2);E=y.Y;return g.v(y,g.Te(E,"prefs",b),0)})};
I7.prototype.remove=function(Y){var V=this,C;return g.l(function(U){if(U.J==1)return g.v(U,kKb(V.token),2);C=U.Y;return g.v(U,C.delete("prefs",Y),0)})};
g.W(L2,g.g1);g.W(Qc,xoD);Qc.prototype.S=function(Y,V){V=h6b(V);Y=(new TextEncoder).encode(JSON.stringify(Y));return this.Y.encrypt(Y,V)};
Qc.prototype.J=function(Y,V){if(!(Y instanceof Uint8Array))throw JAS(1);var C=new TextDecoder;V=h6b(V);Y=this.Y.decrypt(Y,V);return JSON.parse(C.decode(Y))};
var fkS={accountLinkStatusEntity:jmL,booleanEntity:TD8,buttonEntity:GKN,captionTrack:joT,channelHandle:lLL,chipEntity:nbb,commerceAcquisitionClientPayloadEntity:DoL,commerceCartListEntity:utL,contextNoteFeedEntityPayload:pHR,continuationTokenEntity:EPW,downloadQualityPickerEntity:F8J,downloadsPageRefreshTokenEntity:K8S,downloadsPageViewConfigurationEntity:BTN,downloadStatusEntity:gHN,dismissState:b1v,sfvAudioItemCurrentlyPlayingEntity:V_L,emojiFountainDataEntity:yA8,emojiCustomizationSetEntity:i1T,
fakeChannel:M08,fakePlaylist:aLD,fakePlaylistEntryCollection:L8L,fakeVideo:QmD,fakeVideoDescription:SLr,featuredProductsEntity:Jub,flowStateEntity:m7W,iconBadgeEntity:BrL,interstitialInteractionStateEntity:eyr,likeButtonAnimationEntity:sov,liveChatPollStateEntity:rGL,liveViewerLeaderboardChatEntryPointStateEntity:Y6L,liveViewerLeaderboardPointsEntity:obb,liveReactionsDataEntity:XrW,logoEntity:t0D,macroMarkerEntity:AuD,mainDownloadsLibraryEntity:HEr,mainDownloadsListEntity:oPr,mainPlaylistDownloadStateEntity:VSL,
mainPlaylistEntity:zXL,mainPlaylistVideoEntity:igN,mainVideoDownloadStateEntity:CUL,mainVideoEntity:ZgD,markersEngagementPanelSyncEntity:RXR,markersVisibilityOverrideEntity:WoL,musicAlbumReleaseDetail:vPr,musicAlbumReleaseDownloadMetadataEntity:PUT,musicAlbumRelease:fuL,musicAlbumReleaseUserDetail:wNL,musicArtistDetail:pNN,musicArtist:lu8,musicArtistUserDetail:TTR,musicDownloadsLibraryEntity:xhv,musicLibraryEdit:$hL,musicLibraryStatusEntity:MSD,musicPlaylist:IuW,musicPlaylistDownloadMetadataEntity:cub,
musicShare:LoD,musicTrackDetail:SaD,musicTrackDownloadMetadataEntity:hXS,musicTrack:QoD,musicTrackUserDetail:mhS,offlineOrchestrationActionWrapperEntity:tSL,offlineVideoPolicy:eXv,offlineVideoStreams:ruA,offlineabilityEntity:Uhr,orchestrationWebSamplingEntity:nPJ,pageHeaderEntity:EbL,pdpStateEntity:sA8,pinnedProductEntity:dhv,playbackData:Fob,playerStateEntity:NTN,quantityIncrementerEntity:AAD,refresh:gPb,saveToPlaylistListEntity:Cdr,settingEntity:UoA,stringEntity:$7A,suggestedFeedbackChipStateEntity:OgL,
transfer:KoJ,trendingOfferEntity:qaJ,videoDownloadContextEntity:Hgv,videoOverviewAsyncDataEntity:R6b,videoPlaybackPositionEntity:Z1r,votingEntity:z6S,ytMainChannelEntity:Dhb,youchatPendingResponseEntity:kDA,ytMainDownloadedVideoEntity:bgA,ytMainVideoEntity:u0N};g.W(r3,xoD);r3.prototype.S=function(Y){return Y};
r3.prototype.J=function(Y){if(Y instanceof Uint8Array)throw JAS(0);return Y};
g.W(Fa,g.T);Fa.prototype.observe=function(Y){var V=this;this.observers.push(Y);return function(){var C=V.observers.indexOf(Y);C>=0&&V.observers.splice(C,1)}};
Fa.prototype.J=function(Y){jAD(this,Y.data)};
Fa.prototype.u1=function(){this.channel.close()};
var gbJ,rzS=new g.hL("elementsCommand");var dy=new g.hL("entityBatchUpdate");var T7v=new g.hL("downloadStatusEntity");var HjT=new g.hL("mainPlaylistEntityActionMetadata");var gy=new g.hL("mainVideoEntityActionMetadata");var z3N=new g.hL("musicPlaylistEntityActionMetadata");var wp8=new g.hL("musicTrackEntityActionMetadata");var DXL=new g.hL("localImageEntityActionMetadata");var TP=new g.hL("playbackDataActionMetadata");var Fjr=new g.hL("transferEntityActionMetadata");var l1L=new g.hL("videoPlaybackPositionEntityActionMetadata");var Gmr;new g.Bt;new g.Bt;s9W.prototype.request=function(Y,V,C){V=V===void 0?{}:V;return this.locks.request(Y,V,function(U){return C(U)})};var U1=g.tx.caches,Cl,O78;Vu.prototype.open=function(Y){return U1.open(WBr(Y))};
Vu.prototype.has=function(Y){return U1.has(WBr(Y))};
Vu.prototype.delete=function(Y){return U1.delete(WBr(Y))};
Vu.prototype.match=function(Y,V){var C=this,U,n,b,E,y,X;return g.l(function(G){switch(G.J){case 1:return g.v(G,C.keys(),2);case 2:U=G.Y,n=g.N(U),b=n.next();case 3:if(b.done){G.OE(5);break}E=b.value;return g.v(G,C.open(E),6);case 6:return y=G.Y,g.v(G,y.match(Y,V),7);case 7:if(X=G.Y)return G.return(X);b=n.next();G.OE(3);break;case 5:return G.return()}})};
g.W(RKS,Vu);RKS.prototype.keys=function(){var Y,V,C,U,n,b,E,y,X;return g.l(function(G){if(G.J==1)return Y=[],V=g.KH("CacheStorage keys"),g.v(G,U1.keys(),2);C=G.Y;U=g.N(C);for(n=U.next();!n.done;n=U.next()){b=n.value;var Z=b.indexOf(":");E=Z===-1?{zG:b}:{zG:b.substring(0,Z),datasyncId:b.substring(Z+1)};y=E.zG;X=E.datasyncId;X===V&&Y.push(y)}return G.return(Y)})};g.W(bt,g.T);bt.prototype.S=function(Y){this.api.rT("onOfflineOperationFailure",Y.data)};
bt.prototype.W=function(Y){this.api.publish("offlinetransferpause",Y.data)};
bt.prototype.u1=function(){var Y;(Y=this.Y)==null||Y.close();var V;(V=this.J)==null||V.close()};d$D.prototype.tB=function(){this.Y&&zP(this)};
d$D.prototype.Kj=function(){this.J&&this.J.resolve();this.S=this.Y=!1;this.L()};var G7J=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var j9W="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var C4S="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.W(dWD,wy);dWD.prototype.J=function(Y){return GP(Y)?xWA(this,Y):Zo(Y)?f1D(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};g.W(vBL,wy);vBL.prototype.J=function(Y){return Zo(Y)?whJ(this,Y):ptL(Y)?phN(this,Y):Do(Y)?TYT(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};g.R=$W8.prototype;g.R.Jfy=function(Y){var V=this,C,U,n,b;return g.l(function(E){if(!g.e(Y.state,128))return E.OE(0);C=Y.state.fK;var y=(U=C)==null?void 0:U.errorCode,X=(n=C)==null?void 0:n.VZ;b=y==="net.connect"&&X===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(y==null?0:y.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.v(E,V.VL(V.player.getVideoData().videoId,b),0)})};
g.R.VL=function(Y,V){var C=this;return g.l(function(U){if(U.J==1){if(C.J)return U.return();C.J=!0;return V==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(aF(C,Y,!1,!0),U.OE(0)):g.v(U,M6(C,Y),3)}g.MN(Y,4);return g.v(U,C.Y.VL(V),0)})};
g.R.xs=function(Y){Y.status===2?(Y.status!==this.S&&(wDA(this.Y),g.MN(Y.videoId,2)),Y.jD&&Mjv(this.Y,Y.videoId,Y.jD)):Y.status===4?(M6(this,Y.videoId),this.VL(Y.videoId,Y.ev?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):Y.status===1&&$m8(this.Y);this.S=Y.status;this.api.rT("localmediachange",{videoId:Y.videoId,status:Y.status})};
g.R.NO=function(){var Y=this,V;return g.l(function(C){if(C.J==1){if(Y.J)return C.return();Y.J=!0;V=Y.player.getVideoData().videoId;return g.v(C,M6(Y,V),2)}return g.v(C,Y.Y.NO(),0)})};
g.R.Mc=function(Y){switch(Y){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.R.K=function(Y){return this.api.U().K(Y)};g.W(mWr,wy);mWr.prototype.J=function(Y){return GP(Y)?tCL(this,Y):Zo(Y)?e3R(this,Y):ptL(Y)?r4L(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};ofD.prototype.Y=function(Y,V){var C=Y.action.actionMetadata.priority-V.action.actionMetadata.priority;C===0&&(Y.Y<V.Y?C=-1:Y.Y>V.Y&&(C=1));return C};g.W(IF,g.T);IF.prototype.u1=function(){this.L&&this.L();g.T.prototype.u1.call(this)};
IF.prototype.createAction=function(Y,V){var C=g.nV(Y.entityKey).entityType,U=g.qP(16);return new RF(C,U,Y,V.actionId,V.rootActionId)};
IF.prototype.Jn=function(Y){var V=this,C,U,n,b,E,y,X,G,Z;return g.l(function(D){if(D.J==1){if(V.Vs())return D.return();U=(C=Y.offlineOrchestrationActionWrapperEntity)!=null?C:new Set;n=[];b=g.N(U);for(E=b.next();!E.done;E=b.next())y=E.value,X=g.nV(y),G=X.entityId,Umb(V.Y,G)||n.push(y);return g.v(D,ucW(V,n),2)}Z=D.Y;return g.v(D,DmW(V,Z),0)})};
IF.prototype.retry=function(){var Y=this;return g.l(function(V){return g.v(V,BVJ(Y),0)})};AFv.prototype.TN=function(Y,V){V=V===void 0?!0:V;var C=this,U,n,b,E,y,X,G,Z;return g.l(function(D){switch(D.J){case 1:if(!C.Y)return D.return();U=[];n=g.Ed(C.Y.J,V);b=[];for(E={GU:0};E.GU<n.length;E={GU:E.GU},E.GU++)y=n[E.GU],X=C.Y.EP(y,"json3"),G=g.wN(X,{withCredentials:!0,format:"RAW"},3,500).then(function(u){return function(B){B={metadata:g.kW(n[u.GU]),trackData:B.xhr.responseText};b.push(B)}}(E)).X3(function(u){nl("Caption fetch error",u)}),U.push(G);
return g.v(D,wHW(U),2);case 2:return g.Na(D,3),g.v(D,nZL(Y,b),5);case 5:g.Jx(D,0);break;case 3:Z=g.Po(D),nl("Caption DB transaction error",Z),g.Wo(D)}})};g.W(Ll,g.T);Ll.prototype.u1=function(){this.J&&this.J();g.T.prototype.u1.call(this)};
Ll.prototype.S=function(Y){var V=this,C,U,n,b,E,y,X,G;return g.l(function(Z){U=(C=Y.transfer)!=null?C:new Set;n=[];b=g.N(U);for(E=b.next();!E.done;E=b.next())y=E.value,X=g.nV(y),G=X.entityId,n.push(G);return n.length===0?Z.return():g.v(Z,NV8(V,n),0)})};g.W(q58,g.T);g.R=q58.prototype;g.R.u1=function(){this.jL&&this.jL();this.dT.dispose();this.W.dispose();this.eL&&g.U6(this.D.Sm,this.eL);this.F8&&g.U6(this.D.Sm,this.F8);g.T.prototype.u1.call(this)};
g.R.T88=function(Y){var V=this,C,U,n;return g.l(function(b){switch(b.J){case 1:C=g.bu(Y,"transfer");if(V.Y&&C===V.Y.key){aF(V.C,V.V,!0);V.W.stop();b.OE(0);break}return g.v(b,g3(V.J,{mode:"readwrite",cM:!0},function(E){return S5(E,C,"transfer").then(function(y){if(y&&y.transferState!=="TRANSFER_STATE_COMPLETE"&&y.transferState!=="TRANSFER_STATE_FAILED")return y.transferState="TRANSFER_STATE_PAUSED_BY_USER",tJ(E,y,"transfer").then(function(){return y})})}),3);
case 3:U=b.Y;if(!U){b.OE(0);break}if(!Y||!V.S){b.OE(5);break}return g.v(b,ut(Y,V.S,V.J,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.v(b,mC(V,Y),7);case 7:n=b.Y,wtv({videoId:Y,ZD:U,offlineModeType:n}),g.Wo(b)}})};
g.R.Qmt=function(){var Y=this;if(this.Y&&this.V){aF(this.C,this.V,!1);var V=this.Y,C=(V==null?0:V.key)?g.nV(V.key).entityId:"";C&&this.S&&(new Promise(function(U,n){ut(C,Y.S,Y.J,"DOWNLOAD_STATE_PAUSED").catch(function(b){n(b)})})).catch(function(U){nl("Download state setting error",U)})}this.W.stop()};
g.R.ZO=function(){this.Y?cFv(this,this.Y):So(this)};
g.R.eJ=function(Y){var V=this;return g.l(function(C){switch(C.J){case 1:if(!V.Y){C.OE(2);break}if(V.Y.transferState==="TRANSFER_STATE_COMPLETE"||V.Y.transferState==="TRANSFER_STATE_FAILED"||!Y.transfer||!Y.transfer.has(V.Y.key)){C.OE(3);break}return g.v(C,Hn(V.J,V.Y.key,"transfer"),4);case 4:V.Y=C.Y;if(V.Y){C.OE(3);break}return g.v(C,hED(V),3);case 3:if(V.Y)return C.return();case 2:return g.v(C,So(V),0)}})};
g.R.VL=function(Y,V){var C=this,U,n,b,E,y;return g.l(function(X){switch(X.J){case 1:if(!C.Y){jo(C,"onTransferFailure: "+Y);X.OE(2);break}U=C.Y;b=((n=U)==null?0:n.key)?g.nV(U.key).entityId:"";a:switch(Y){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var G=!1;break a;default:G=!0}return G&&a9R(C)?g.v(X,tk(C,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.v(X,
I9L(C,Y),5);case 5:if(!b||!C.S){X.OE(2);break}return g.v(X,ut(b,C.S,C.J,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.v(X,mC(C,b),9);case 9:E=X.Y;yu({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:b,ZD:U,offlineModeType:E});if(!b||!C.S){X.OE(2);break}return g.v(X,ut(b,C.S,C.J,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Qu(C),y=So(C,!0),V&&V(y),g.Wo(X)}})};
g.R.NO=function(Y){var V=this,C,U,n,b,E,y,X,G,Z,D,u,B;return g.l(function(A){switch(A.J){case 1:if(!V.Y){jo(V,"onMaybeTransferStreamsExpired");A.OE(2);break}return a9R(V)?g.v(A,tk(V,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.v(A,I9L(V,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!V.S){A.OE(2);break}C=V.Y;n=((U=C)==null?0:U.key)?g.nV(C.key).entityId:"";if(!n){A.OE(2);break}return g.v(A,ut(n,V.S,V.J,"DOWNLOAD_STATE_FAILED"),2);case 9:return V.Y||jo(V,"onMaybeTransferStreamsExpiredRetryAttempting"),
b=V.Y,y=((E=b)==null?0:E.key)?g.nV(b.key).entityId:"",g.v(A,mC(V,y),10);case 10:return X=A.Y,yu({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:y,ZD:b,offlineModeType:X}),G=azW(),g.mu(G,TP,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Z=g.bu(y,"playbackData"),D={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:Z,actionMetadata:G},u=N6(new RF("playbackData",y,D)),g.v(A,K2(V.J,u,"offlineOrchestrationActionWrapperEntity"),2);case 2:Qu(V),B=So(V,!0),
Y&&Y(B),g.Wo(A)}})};
var mXv={},LiJ=(mXv.TRANSFER_STATE_TRANSFERRING=1,mXv.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,mXv);g.R=eo.prototype;g.R.Xb=function(){return this.V.promise};
g.R.JG=function(){if(this.J&&this.C)return this.V.promise;mmJ(this).then(this.V.resolve).catch(this.V.reject);return this.V.promise};
g.R.kO=function(Y){var V={};return V.playbackData=new dWD(Y,this.zy,this.Y),V.transfer=new mWr(Y,this.zy),V.videoPlaybackPositionEntity=new vBL(Y,this.zy),V};
g.R.eQ=function(){var Y=this;return g.l(function(V){return Y.J?g.v(V,Pp8(Y.J),0):V.OE(0)})};
g.R.po=function(){var Y=this,V,C;return g.l(function(U){if(U.J==1)return Y.J||Y.C?g.v(U,Y.Xb(),2):U.return();Y.X!==void 0&&(g.OG(Y.X),Y.X=void 0);Y.W!==void 0&&(g.OG(Y.W),Y.W=void 0);(V=Y.J)==null||V.dispose();Y.J=void 0;(C=Y.C)==null||C.dispose();Y.C=void 0;Y.api.rT("onOrchestrationLostLeader");Y.V=new g.Bt;g.Wo(U)})};
g.R.isOrchestrationLeader=function(){return this.S.Y};
g.R.Oj=function(){return g.l(function(Y){return Y.return(!1)})};
g.R.Mx=function(Y){var V=this.Y;V.api.publish("offlinetransferpause",Y);var C;(C=V.J)==null||C.postMessage(Y)};
g.R.ZO=function(Y){var V,C;return g.l(function(U){if(U.J==1)return g.v(U,oF(),2);V=U.Y;if(!V)return U.return();C=g.bu(Y,"transfer");return g.v(U,g3(V,{mode:"readwrite",cM:!0},function(n){var b=S5(n,C,"transfer"),E=S5(n,g.bu(Y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Pe.all([b,E]).then(function(y){y=g.N(y);var X=y.next().value;var G=y.next().value;return X&&X.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(X.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",tJ(n,X,"transfer").then(function(){yu({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:Y,ZD:X,offlineModeType:G==null?void 0:G.offlineModeType});return g.Pe.resolve(null)})):g.Pe.resolve(null)})}),0)})};
g.R.tN=function(Y){Y=Y===void 0?43200:Y;var V=this,C,U,n,b,E,y,X,G;return g.l(function(Z){if(Z.J==1)return V.D.dV()?g.v(Z,oF(),2):Z.return(jzv());if(Z.J!=3){C=Z.Y;if(!C)return Z.return([]);U=Date.now()/1E3;return g.v(Z,YR(C,"offlineVideoPolicy"),3)}n=Z.Y;b=[];E=g.N(n);for(y=E.next();!y.done;y=E.next())X=y.value,Number(X.lastUpdatedTimestampSeconds)+Y<=U&&(G=g.nV(X.key).entityId,b.push(G));return b.length?Z.return(ry(V,b,V.L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):Z.return([])})};
g.R.deleteAll=function(){return ry(this,["!*$_ALL_ENTITIES_!*$"],this.L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.R.refreshAllStaleEntities=function(Y){var V=this;return g.l(function(C){return C.J==1?g.v(C,V.tN(Y),2):C.return(C.Y)})};
g.R.setUpPositionSyncInterval=function(Y){var V=this;this.W!==void 0&&(g.OG(this.W),this.W=void 0);var C=Y!=null?Y:864E5;this.W=g.Ww(function(){V.DQ(C)},C)};
g.R.DQ=function(Y){var V=this,C,U,n,b,E,y;return g.l(function(X){switch(X.J){case 1:return g.Na(X,2),g.v(X,I7.getInstance(),4);case 4:C=X.Y;if(!C)throw Error("prefStorage is undefined");return g.v(X,C.get("psi"),5);case 5:U=X.Y;b=((n=U)==null?0:n.J3)?Number(U.J3)/1E3:0;E=Date.now();if(!(b+Y<=E)){X.OE(6);break}return g.v(X,ry(V,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Jx(X,0);break;case 2:y=g.Po(X),nl("Offline manager error",y),
g.Wo(X)}})};
g.R.aU=function(){var Y=this,V,C,U,n,b,E,y;return g.l(function(X){if(X.J==1)return g.v(X,oF(),2);if(X.J!=3)return(V=X.Y)?g.v(X,YR(V,"transfer"),3):X.return([]);C=X.Y;U=[];n=g.N(C);for(b=n.next();!b.done;b=n.next())E=b.value,E.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&E.key&&(y=g.nV(E.key).entityId,U.push(y));return X.return(eEA(Y,U))})};
g.R.hL=function(){return g.l(function(Y){return Y.return([])})};
g.R.ai=function(){return g.l(function(Y){g.Wo(Y)})};
g.R.Cf=function(){return g.l(function(Y){g.Wo(Y)})};g.W(rFN,wy);rFN.prototype.J=function(Y){return GP(Y)?Kir(this,Y):Zo(Y)?YvN(this,Y):Do(Y)?o_L(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var FX=[10];g.W(b_W,wy);b_W.prototype.J=function(Y){return GP(Y)?i_v(this,Y):Zo(Y)?yL8(this,Y):Do(Y)?XpL(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var zs8=[10];g.W(Z_W,wy);Z_W.prototype.J=function(Y){return Zo(Y)?uhL(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};g.W(BnL,eo);g.R=BnL.prototype;g.R.kO=function(Y){var V=eo.prototype.kO.call(this,Y);V.mainVideoEntity=new b_W(Y,this.zy,this.Y);V.mainPlaylistEntity=new rFN(Y,this.zy,this.Y);V.mainDownloadsListEntity=new Z_W(Y,this.zy,this.Y);return V};
g.R.refreshAllStaleEntities=function(Y,V){var C=this,U,n,b,E,y,X,G,Z,D,u,B;return g.l(function(A){switch(A.J){case 1:U=[];if(!C.zy.K("web_player_offline_playlist_auto_refresh")){A.OE(2);break}return g.v(A,sYJ(C,Y,V),3);case 3:U=A.Y;case 2:return g.v(A,I7.getInstance(),4);case 4:return n=A.Y,g.v(A,(b=n)==null?void 0:b.get("sdois"),5);case 5:return E=A.Y,g.v(A,(y=n)==null?void 0:y.get("lmqf"),6);case 6:X=A.Y;if(!E){A.OE(7);break}Z=U;D=Z.concat;return g.v(A,ALW(C,E,(G=X)!=null?G:"SD",Y===0),8);case 8:U=
D.call(Z,A.Y);case 7:return u=U,B=u.concat,g.v(A,eo.prototype.refreshAllStaleEntities.call(C,Y,V),9);case 9:return U=B.call(u,A.Y),A.return(U)}})};
g.R.Oj=function(Y){var V,C,U,n,b,E,y,X;return g.l(function(G){if(G.J==1)return g.v(G,oF(),2);if(G.J!=3)return(V=G.Y)?g.v(G,Hn(V,g.$z,"mainDownloadsListEntity"),3):G.return(!1);C=G.Y;if((U=C)==null?0:(n=U.downloads)==null?0:n.length)for(b=g.bu(Y,"mainVideoEntity"),E=g.N(C.downloads),y=E.next();!y.done;y=E.next())if(X=y.value,X.videoItem===b)return G.return(!0);return G.return(!1)})};
g.R.hL=function(){var Y=this,V,C,U,n,b,E,y,X;return g.l(function(G){if(G.J==1)return g.v(G,oF(),2);if(G.J!=3)return(V=G.Y)?g.v(G,YR(V,"downloadStatusEntity"),3):G.return([]);C=G.Y;U=[];n=g.N(C);for(b=n.next();!b.done;b=n.next())E=b.value,E.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&E.key&&(y=g.nV(E.key).entityId,U.push(y));return U.length?(X={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},G.return(ry(Y,U,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
X))):G.return([])})};
g.R.Cf=function(){var Y;return g.l(function(V){return V.J==1?g.v(V,oF(),2):(Y=V.Y)?g.v(V,g3(Y,{mode:"readwrite",cM:!0},function(C){return mU(C,"mainVideoEntity").then(function(U){var n=[];U=g.N(U);for(var b=U.next();!b.done;b=U.next()){b=b.value;var E=void 0;(E=b.userState)!=null&&E.playbackPosition||(E=g.nV(b.key).entityId,E={key:g.bu(E,"videoPlaybackPositionEntity"),videoId:E,lastPlaybackPositionSeconds:"0"},n.push(tJ(C,E,"videoPlaybackPositionEntity")),b.userState={playbackPosition:E.key},n.push(tJ(C,
b,"mainVideoEntity")))}return g.Pe.all(n)})}),0):V.return()})};
g.R.ai=function(){var Y,V,C,U,n,b,E,y,X,G,Z,D,u,B,A,O,k,q,d,c,w,a,t,S,H,UP,ov,bZ,F,Bo,dH,lZ,Wv,zv,xE,qa,US,J;return g.l(function(zT){if(zT.J==1)return g.v(zT,oF(),2);if(zT.J!=3){Y=zT.Y;if(!Y)return zT.return();V=g.bu("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.v(zT,g3(Y,{mode:"readonly",cM:!0},function(jJ){return g.Pe.all([S5(jJ,V,"mainDownloadsListEntity"),S5(jJ,g.$z,"mainDownloadsListEntity"),mU(jJ,"mainVideoEntity"),mU(jJ,"mainPlaylistEntity")])}),3)}C=zT.Y;
U=g.N(C);n=U.next().value;b=U.next().value;E=U.next().value;y=U.next().value;X=n;G=b;Z=E;D=y;u=new Set;if((B=X)==null?0:(A=B.downloads)==null?0:A.length)for(O=g.N(X.downloads),k=O.next();!k.done;k=O.next())q=k.value,d=void 0,(c=(d=q.videoItem)!=null?d:q.playlistItem)&&u.add(c);if((w=G)==null?0:(a=w.downloads)==null?0:a.length)for(t=g.N(G.downloads),S=t.next();!S.done;S=t.next())H=S.value,H.videoItem&&u.add(H.videoItem);UP=new Set;ov=[];bZ=g.N(D);for(F=bZ.next();!F.done;F=bZ.next()){Bo=F.value;if(Bo.videos)for(dH=
g.N(Bo.videos),lZ=dH.next();!lZ.done;lZ=dH.next())Wv=lZ.value,(zv=JSON.parse(g.nV(Wv).entityId).videoId)&&UP.add(zv);Bo.key&&!u.has(Bo.key)&&ov.push(Bo.key)}xE=g.N(Z);for(qa=xE.next();!qa.done;qa=xE.next())US=qa.value,US.key&&!u.has(US.key)&&(J=g.nV(US.key).entityId,UP.has(J)||ov.push(US.key));return ov.length?g.v(zT,H7r(Y,ov),0):zT.OE(0)})};g.W(Rsb,wy);Rsb.prototype.J=function(Y){return GP(Y)?NnT(this,Y):Zo(Y)?O_R(this,Y):Do(Y)?kbN(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var Kl=[10];g.W(dXD,wy);dXD.prototype.J=function(Y){return GP(Y)?PNJ(this,Y):Zo(Y)?xXW(this,Y):Do(Y)?cLA(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var HT=[10];g.W(v_8,wy);v_8.prototype.J=function(Y){return GP(Y)?TnA(this,Y):Zo(Y)?$X8(this,Y):Do(Y)?Myb(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var ppD=[10];g.W(YY,eo);YY.prototype.kO=function(Y){var V=eo.prototype.kO.call(this,Y);V.musicTrack=new v_8(Y,this.Y);V.musicPlaylist=new dXD(Y,this.Y);V.musicAlbumRelease=new Rsb(Y,this.Y);return V};
YY.prototype.refreshAllStaleEntities=function(Y,V){var C=this,U,n,b;return g.l(function(E){if(E.J==1)return g.v(E,IBA(C,Y,V),2);if(E.J!=3)return n=U=E.Y,b=n.concat,g.v(E,eo.prototype.refreshAllStaleEntities.call(C,Y,V),3);U=b.call(n,E.Y);return E.return(U)})};g.W(LER,g.NG);g.R=LER.prototype;g.R.create=function(){var Y=this;g.M(this,this.events);if(g.Uh(this.zy))this.Y=new BnL(this.zy,this.player);else if(g.m3(this.zy)||g.z1(this.zy)==="WEB_MUSIC_INTEGRATIONS")this.Y=new YY(this.zy,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){Y.fz()});
this.events.Z(this.player,"videodatachange",function(){Y.fz()});
this.zy.K("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.jy)};
g.R.M_=function(){return!1};
g.R.mz=function(Y,V,C,U){var n=this;return g.l(function(b){return n.Y?b.return(ry(n.Y,Y,V,C,U)):b.return(Promise.reject())})};
g.R.deleteAll=function(){return this.Y.deleteAll()};
g.R.tN=function(Y){return this.Y.tN(Y)};
g.R.refreshAllStaleEntities=function(Y){return this.Y.refreshAllStaleEntities(Y)};
g.R.setUpPositionSyncInterval=function(Y){this.Y.setUpPositionSyncInterval(Y)};
g.R.Mx=function(Y){this.Y.Mx(Y)};
g.R.ZO=function(Y){return this.Y.ZO(Y)};
g.R.fz=function(){var Y=this,V;return g.l(function(C){V=Y.player.getVideoData();return g.H$(V)?QYD(V)&&Y.J!==V.clientPlaybackNonce?g.v(C,Svv(Y,V),0):C.OE(0):C.return()})};
g.R.jy=function(Y){var V=this,C,U,n,b,E,y,X;return g.l(function(G){if(G.J==1)return C=V.player.getVideoData(),U=C.mZ,g.Oi(Y,2)||g.Oi(Y,512)?g.v(G,oF(),2):G.return();if(G.J!=3){n=G.Y;if(!n)return nl("PES is undefined"),G.return();b=C.videoId;return g.v(G,Hn(n,g.bu(b,"mainVideoEntity"),"mainVideoEntity"),3)}E=G.Y;if(!E)return G.return();y=Math.floor(U).toString();X={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:y}};return g.v(G,V.mz([b],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
X),0)})};
g.R.isOrchestrationLeader=function(){return this.Y.isOrchestrationLeader()};
g.R.updateDownloadState=function(Y,V){var C,U,n,b;return g.l(function(E){if(E.J==1)return g.v(E,oF(),2);C=E.Y;if(!C)return nl("PES is undefined"),E.return();U=g.nV(Y);n=U.entityType;b=U.entityId;return g.v(E,ut(b,n,C,V,!0),0)})};g.WU("offline",LER);})(_yt_player);
